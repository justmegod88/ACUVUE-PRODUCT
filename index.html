<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ì œí’ˆ ìŠ¤ìº” MVP | ì•„íë¸Œ ë§¥ìŠ¤ ì˜¤ì•„ì‹œìŠ¤ ì›ë°ì´</title>
<style>

    :root{

      --bg:#ffffff;

      --text:#0b1220;

      --muted:#5b6475;

      --brand:#0b4aa2;     /* ì•„íë¸Œ ëŠë‚Œì˜ ë¸”ë£¨ í†¤(ì„ì˜) */

      --card:#f5f7fb;

      --line:#e6e9f2;

      --btn:#0b4aa2;

      --btnText:#ffffff;

      --danger:#d92d20;

      --ok:#067647;

      --shadow: 0 8px 24px rgba(16, 24, 40, 0.08);

      --radius: 16px;

      --radiusSm: 12px;

      --max: 720px;

    }

    *{box-sizing:border-box}

    body{

      margin:0;

      background:var(--bg);

      color:var(--text);

      font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic", Arial, sans-serif;

      line-height:1.35;

    }

    .wrap{

      max-width: var(--max);

      margin:0 auto;

      padding: 18px 16px 40px;

    }

    header{

      display:flex;

      align-items:center;

      justify-content:space-between;

      gap:12px;

      padding: 10px 2px 14px;

    }

    .brand{

      display:flex;

      flex-direction:column;

      gap:2px;

    }

    .brand .title{

      font-weight:800;

      letter-spacing:-0.3px;

      font-size:16px;

    }

    .brand .sub{

      font-size:12px;

      color:var(--muted);

    }

    .pill{

      font-size:12px;

      padding:8px 10px;

      border:1px solid var(--line);

      border-radius: 999px;

      color:var(--muted);

      background:#fff;

    }

    .card{

      background: var(--card);

      border: 1px solid var(--line);

      border-radius: var(--radius);

      padding: 16px;

      box-shadow: var(--shadow);

    }

    .card + .card{ margin-top: 12px; }

    .h1{

      font-size: 22px;

      font-weight: 900;

      letter-spacing:-0.6px;

      margin:0 0 8px;

    }

    .p{

      margin:0;

      color: var(--muted);

      font-size: 14px;

      line-height:1.45;

    }

    .btn{

      width:100%;

      border:0;

      border-radius: 14px;

      padding: 14px 14px;

      font-size: 16px;

      font-weight: 800;

      background: var(--btn);

      color: var(--btnText);

      cursor:pointer;

    }

    .btn:active{ transform: translateY(1px); }

    .btn.secondary{

      background:#fff;

      color: var(--text);

      border:1px solid var(--line);

      font-weight: 800;

    }

    .btnRow{

      display:grid;

      grid-template-columns: 1fr;

      gap:10px;

      margin-top: 14px;

    }

    .trust{

      margin-top: 12px;

      font-size: 12px;

      color: var(--muted);

      display:flex;

      align-items:flex-start;

      gap:8px;

    }

    .trust .dot{

      width:8px; height:8px;

      margin-top: 5px;

      border-radius: 999px;

      background: var(--ok);

      flex:0 0 auto;

    }

    /* Scanner modal */

    .modal{

      position: fixed;

      inset:0;

      background: rgba(0,0,0,0.55);

      display:none;

      align-items:center;

      justify-content:center;

      padding: 16px;

      z-index: 50;

    }

    .modal.open{ display:flex; }

    .modalBox{

      width:100%;

      max-width: 520px;

      background:#fff;

      border-radius: var(--radius);

      overflow:hidden;

      border: 1px solid var(--line);

      box-shadow: var(--shadow);

    }

    .modalTop{

      padding: 12px 14px;

      display:flex;

      align-items:center;

      justify-content:space-between;

      gap:10px;

      border-bottom: 1px solid var(--line);

    }

    .modalTop .t{

      font-weight:900;

      letter-spacing:-0.3px;

    }

    .x{

      border:0;

      background:#fff;

      font-size:18px;

      cursor:pointer;

      padding: 8px 10px;

      border-radius: 10px;

      border: 1px solid var(--line);

    }

    .videoWrap{

      position: relative;

      background:#000;

      width:100%;

      aspect-ratio: 3 / 4; /* ëª¨ë°”ì¼ ì¹´ë©”ë¼ ëŠë‚Œ */

    }

    video{

      width:100%;

      height:100%;

      object-fit: cover;

      display:block;

    }

    .scanFrame{

      position:absolute;

      inset: 14% 10%;

      border: 2px solid rgba(255,255,255,0.85);

      border-radius: 14px;

      box-shadow: 0 0 0 999px rgba(0,0,0,0.15);

      pointer-events:none;

    }

    .scanHint{

      position:absolute;

      bottom: 10px;

      left: 10px;

      right: 10px;

      background: rgba(255,255,255,0.92);

      border-radius: 12px;

      padding: 10px 10px;

      font-size: 13px;

      color: var(--text);

    }

    .modalBottom{

      padding: 12px 14px 14px;

      border-top: 1px solid var(--line);

      display:grid;

      gap: 10px;

    }

    .status{

      font-size: 13px;

      color: var(--muted);

      display:flex;

      align-items:center;

      justify-content:space-between;

      gap:10px;

    }

    .status b{ color: var(--text); }

    .inputRow{

      display:flex;

      gap:8px;

      align-items:center;

    }

    input[type="text"]{

      width:100%;

      padding: 12px 12px;

      border-radius: 12px;

      border: 1px solid var(--line);

      font-size: 14px;

    }

    /* Result page blocks */

    .hero{

      padding: 18px 16px;

      border-radius: var(--radius);

      background: linear-gradient(180deg, rgba(11,74,162,0.10), rgba(11,74,162,0.02));

      border: 1px solid var(--line);

    }

    .hero h2{

      margin:0 0 8px;

      font-size: 22px;

      letter-spacing:-0.6px;

      font-weight: 950;

    }

    .hero p{ margin:0; color: var(--muted); font-size: 14px; line-height:1.45; }

    .kcards{

      display:grid;

      gap:10px;

      margin-top: 12px;

    }

    .kcard{

      background:#fff;

      border: 1px solid var(--line);

      border-radius: var(--radiusSm);

      padding: 14px;

    }

    .kcard .khead{

      display:flex;

      gap:10px;

      align-items:center;

      margin-bottom: 6px;

      font-weight: 900;

      letter-spacing:-0.3px;

    }

    .kcard .ico{

      width:30px; height:30px;

      display:grid; place-items:center;

      border-radius: 10px;

      background: rgba(11,74,162,0.10);

      border: 1px solid rgba(11,74,162,0.18);

      font-size: 16px;

    }

    .kcard .kbody{

      color: var(--muted);

      font-size: 14px;

      line-height:1.45;

    }

    .grid2{

      display:grid;

      grid-template-columns: 1fr;

      gap:10px;

      margin-top: 12px;

    }

    .list{

      margin:0;

      padding: 0;

      list-style:none;

      display:grid;

      gap:8px;

      font-size: 14px;

    }

    .li{

      display:flex;

      justify-content:space-between;

      gap:10px;

      padding: 10px 12px;

      background:#fff;

      border: 1px solid var(--line);

      border-radius: 12px;

    }

    .li span{ color: var(--muted); }

    .li b{ color: var(--text); }

    .quote{

      margin-top: 12px;

      padding: 14px 14px;

      border-radius: var(--radiusSm);

      background: rgba(217, 237, 255, 0.55);

      border: 1px solid rgba(11,74,162,0.20);

      color: var(--text);

      font-size: 14px;

      line-height:1.5;

    }

    .quote b{ font-weight: 950; }

    .foot{

      margin-top: 12px;

      color: var(--muted);

      font-size: 12px;

      line-height:1.45;

      border-top: 1px solid var(--line);

      padding-top: 12px;

    }

    .hide{ display:none !important; }

    @media (min-width: 720px){

      .wrap{ padding: 20px 18px 60px; }

      .btnRow{ grid-template-columns: 1fr 1fr; }

    }
</style>
</head>
<body>
<div class="wrap">
<header>
<div class="brand">
<div class="title">ì œí’ˆ ìŠ¤ìº” í…ŒìŠ¤íŠ¸ (MVP)</div>
<div class="sub">ì•„íë¸Œ ë§¥ìŠ¤ ì˜¤ì•„ì‹œìŠ¤ ì›ë°ì´</div>
</div>
<div class="pill" id="envPill">Web</div>
</header>
<!-- ENTRY VIEW -->
<section id="viewEntry">
<div class="card">
<h1 class="h1">ğŸ“· ë‚´ê°€ ì“°ëŠ” ë Œì¦ˆ,<br>ì™œ ì¢‹ì€ì§€ ì•Œì•„ë³´ê¸°</h1>
<p class="p">ì•ˆê²½ì‚¬ ìƒë‹´ì„ ë” ì˜ ì´í•´í•  ìˆ˜ ìˆì–´ìš”</p>
<div class="btnRow">
<button class="btn" id="btnOpenScan">ì¹´ë©”ë¼ë¡œ ìŠ¤ìº”í•˜ê¸°</button>
<button class="btn secondary" id="btnGoManual">í…ŒìŠ¤íŠ¸ìš© ì½”ë“œ ì…ë ¥</button>
</div>
<div class="trust">
<div class="dot"></div>
<div>ì œì¡°ì‚¬ ê³µì‹ ì •ë³´ ê¸°ë°˜ (í…ŒìŠ¤íŠ¸ í™”ë©´)</div>
</div>
</div>
</section>
<!-- RESULT VIEW -->
<section id="viewResult" class="hide">
<div class="hero">
<h2 id="heroTitle">ëˆˆì˜ í”¼ë¡œê¹Œì§€ ê³ ë ¤í•´ ì„¤ê³„ëœ ì›ë°ì´ ë Œì¦ˆ</h2>
<p id="heroSub">ì¥ì‹œê°„ ë””ì§€í„¸ í™˜ê²½ì—ì„œë„ í¸ì•ˆí•œ ì°©ìš©ì„ ëª©í‘œë¡œ ê°œë°œë˜ì—ˆìŠµë‹ˆë‹¤</p>
</div>
<div class="kcards" id="keyCards"></div>
<div class="grid2">
<div class="card">
<div style="font-weight:950; letter-spacing:-0.3px; margin-bottom:10px;">í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ ë Œì¦ˆ</div>
<ul class="list" id="productFacts"></ul>
<div style="margin-top:10px; color:var(--muted); font-size:14px; line-height:1.45;" id="targetLine">

            ì´ ë Œì¦ˆëŠ” ìŠ¤ë§ˆíŠ¸í°Â·PC ì‚¬ìš© ì‹œê°„ì´ ê¸´ ë¼ì´í”„ìŠ¤íƒ€ì¼ì„ ê³ ë ¤í•´ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤
</div>
</div>
<div class="quote" id="defenseCopy">

          ğŸ’¬ <b>ë‹¤ë¥¸ ë Œì¦ˆë¥¼ ì¶”ì²œë°›ìœ¼ì…”ë„,</b><br>

          ì§€ê¸ˆ ì‚¬ìš© ì¤‘ì¸ ë Œì¦ˆê°€<br>
<b>ì‹œì•¼ ì•ˆì •ì„±ê³¼ ëˆˆì˜ í”¼ë¡œë¥¼ ê³ ë ¤í•´ ì„¤ê³„ëœ ì œí’ˆì¸ì§€</b><br>

          ë¹„êµí•´ë³´ì„¸ìš”.
</div>
<button class="btn secondary" id="btnAR">

          ğŸ” ë Œì¦ˆ ì„¤ê³„ í¬ì¸íŠ¸ë¥¼ í•œëˆˆì— ë³´ê¸°
</button>
<div class="card">
<div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
<div style="font-weight:950; letter-spacing:-0.3px;">ì¸ì‹ ê²°ê³¼</div>
<div class="pill" id="scanBadge">TEST</div>
</div>
<p class="p" style="margin-top:8px;" id="scanInfo">

            ì œí’ˆì„ ì¸ì‹í–ˆìŠµë‹ˆë‹¤.
</p>
<div class="btnRow" style="margin-top:12px;">
<button class="btn" id="btnRescan">ë‹¤ì‹œ ìŠ¤ìº”í•˜ê¸°</button>
<button class="btn secondary" id="btnBackHome">ì²˜ìŒìœ¼ë¡œ</button>
</div>
<div class="foot">

            ë³¸ ì •ë³´ëŠ” ì œì¡°ì‚¬ ê³µì‹ ìë£Œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì œê³µë©ë‹ˆë‹¤.<br>

            ê°œì¸ ì°©ìš© ìƒë‹´ì€ ì•ˆê²½ì‚¬ì™€ ìƒë‹´í•´ì£¼ì„¸ìš”.
</div>
</div>
</div>
</section>
</div>
<!-- SCANNER MODAL -->
<div class="modal" id="scanModal" aria-hidden="true">
<div class="modalBox">
<div class="modalTop">
<div class="t">ì¹´ë©”ë¼ë¡œ ìŠ¤ìº”</div>
<button class="x" id="btnCloseScan" aria-label="ë‹«ê¸°">ë‹«ê¸°</button>
</div>
<div class="videoWrap">
<video id="video" playsinline muted></video>
<div class="scanFrame"></div>
<div class="scanHint">

          ì œí’ˆ ë°•ìŠ¤ì˜ <b>ë°”ì½”ë“œ</b>ê°€ í”„ë ˆì„ ì•ˆì— ì˜¤ë„ë¡ ë§ì¶°ì£¼ì„¸ìš”.<br>

          ë°˜ì‚¬ë˜ë©´ ê°ë„ë¥¼ ì‚´ì§ ë°”ê¿”ì£¼ì„¸ìš”.
</div>
</div>
<div class="modalBottom">
<div class="status">
<span id="scanStatus">ìƒíƒœ: <b>ëŒ€ê¸°</b></span>
<span id="scanTech">ì¸ì‹: <b>ìë™</b></span>
</div>
<div class="inputRow">
<input id="manualCode" type="text" inputmode="numeric" placeholder="í…ŒìŠ¤íŠ¸ìš© ì½”ë“œ ì…ë ¥ (ì˜ˆ: 1234567890123)" />
<button class="btn secondary" id="btnUseManual" style="width:auto; padding:12px 12px; border-radius:12px;">í™•ì¸</button>
</div>
<button class="btn" id="btnStart">ìŠ¤ìº” ì‹œì‘</button>
</div>
</div>
</div>
<script>

    // =========================

    // 1) í…ŒìŠ¤íŠ¸ìš© ì œí’ˆ DB

    // =========================

    // TODO: ì‹¤ì œë¡œëŠ” barcode -> ì œí’ˆ ë§¤í•‘ì„ ëŠ˜ë¦¬ë©´ ë¨.

    // ì•„ë˜ barcodeëŠ” "ì˜ˆì‹œ"ì•¼. ì‹¤ì œ ë°”ì½”ë“œ ê°’ìœ¼ë¡œ êµì²´í•´ì¤˜.

    const PRODUCT_DB = {

      // ì˜ˆì‹œ ë°”ì½”ë“œ(ì„ì‹œ)

      "1234567890123": {

        product_name: "ì•„íë¸Œ ë§¥ìŠ¤ ì˜¤ì•„ì‹œìŠ¤ ì›ë°ì´",

        hero_title: "ëˆˆì˜ í”¼ë¡œê¹Œì§€ ê³ ë ¤í•´ ì„¤ê³„ëœ ì›ë°ì´ ë Œì¦ˆ",

        hero_sub: "ì¥ì‹œê°„ ë””ì§€í„¸ í™˜ê²½ì—ì„œë„ í¸ì•ˆí•œ ì°©ìš©ì„ ëª©í‘œë¡œ ê°œë°œë˜ì—ˆìŠµë‹ˆë‹¤",

        key_cards: [

          { icon: "ğŸ’¡", title: "ì„ ëª…í•œ ì‹œì•¼ë¥¼ ê³ ë ¤í•œ ì„¤ê³„", body: "ë””ì§€í„¸ ê¸°ê¸° ì‚¬ìš© ì‹œì—ë„ ì‹œì•¼ê°€ ì•ˆì •ì ìœ¼ë¡œ ìœ ì§€ë˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤" },

          { icon: "ğŸ’§", title: "ì¥ì‹œê°„ ì´‰ì´‰í•¨ì„ ìœ„í•œ êµ¬ì¡°", body: "ìˆ˜ë¶„ ìœ ì§€ ê¸°ìˆ ì„ ì ìš©í•´ í•˜ë£¨ ì¢…ì¼ í¸ì•ˆí•œ ì°©ìš©ì„ ë•ìŠµë‹ˆë‹¤" },

          { icon: "ğŸ‘", title: "ëˆˆì˜ í”¼ë¡œë¥¼ ê³ ë ¤í•œ ë””ìì¸", body: "ëˆˆ ê¹œë¹¡ì„ê³¼ ì‹œì„  ë³€í™”ë¥¼ ê³ ë ¤í•´ ë¶€ë‹´ì„ ì¤„ì´ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤" }

        ],

        facts: [

          { k: "ì°©ìš© ì£¼ê¸°", v: "ì›ë°ì´" },

          { k: "ë Œì¦ˆ íƒ€ì…", v: "ì†Œí”„íŠ¸ ì½˜íƒíŠ¸ë Œì¦ˆ" },

          { k: "ì„¤ê³„ í¬ì¸íŠ¸", v: "ë””ì§€í„¸ í™˜ê²½ ê³ ë ¤" }

        ],

        target_line: "ì´ ë Œì¦ˆëŠ” ìŠ¤ë§ˆíŠ¸í°Â·PC ì‚¬ìš© ì‹œê°„ì´ ê¸´ ë¼ì´í”„ìŠ¤íƒ€ì¼ì„ ê³ ë ¤í•´ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤",

        defense_copy_html: `ğŸ’¬ <b>ë‹¤ë¥¸ ë Œì¦ˆë¥¼ ì¶”ì²œë°›ìœ¼ì…”ë„,</b><br>

          ì§€ê¸ˆ ì‚¬ìš© ì¤‘ì¸ ë Œì¦ˆê°€<br>
<b>ì‹œì•¼ ì•ˆì •ì„±ê³¼ ëˆˆì˜ í”¼ë¡œë¥¼ ê³ ë ¤í•´ ì„¤ê³„ëœ ì œí’ˆì¸ì§€</b><br>

          ë¹„êµí•´ë³´ì„¸ìš”.`

      }

    };

    // =========================

    // 2) DOM

    // =========================

    const viewEntry = document.getElementById('viewEntry');

    const viewResult = document.getElementById('viewResult');

    const btnOpenScan = document.getElementById('btnOpenScan');

    const btnGoManual = document.getElementById('btnGoManual');

    const btnRescan = document.getElementById('btnRescan');

    const btnBackHome = document.getElementById('btnBackHome');

    const btnAR = document.getElementById('btnAR');

    const scanModal = document.getElementById('scanModal');

    const btnCloseScan = document.getElementById('btnCloseScan');

    const btnStart = document.getElementById('btnStart');

    const btnUseManual = document.getElementById('btnUseManual');

    const manualCode = document.getElementById('manualCode');

    const video = document.getElementById('video');

    const scanStatus = document.getElementById('scanStatus');

    const scanTech = document.getElementById('scanTech');

    const heroTitle = document.getElementById('heroTitle');

    const heroSub = document.getElementById('heroSub');

    const keyCards = document.getElementById('keyCards');

    const productFacts = document.getElementById('productFacts');

    const targetLine = document.getElementById('targetLine');

    const defenseCopy = document.getElementById('defenseCopy');

    const scanInfo = document.getElementById('scanInfo');

    const scanBadge = document.getElementById('scanBadge');

    const envPill = document.getElementById('envPill');

    // =========================

    // 3) ìƒíƒœ

    // =========================

    let stream = null;

    let scanning = false;

    let detector = null;

    let rafId = null;

    // =========================

    // 4) ìœ í‹¸

    // =========================

    function setStatus(text, boldText){

      scanStatus.innerHTML = `ìƒíƒœ: <b>${boldText || ""}</b> ${text ? "Â· " + text : ""}`.trim();

    }

    function openModal(){

      scanModal.classList.add('open');

      scanModal.setAttribute('aria-hidden', 'false');

      manualCode.value = "";

      setStatus("", "ëŒ€ê¸°");

      updateDetectorSupport();

    }

    function closeModal(){

      stopScan();

      scanModal.classList.remove('open');

      scanModal.setAttribute('aria-hidden', 'true');

    }

    function showResult(product, meta){

      viewEntry.classList.add('hide');

      viewResult.classList.remove('hide');

      heroTitle.textContent = product.hero_title;

      heroSub.textContent = product.hero_sub;

      // key cards

      keyCards.innerHTML = "";

      product.key_cards.forEach(c => {

        const el = document.createElement('div');

        el.className = "kcard";

        el.innerHTML = `
<div class="khead">
<div class="ico">${c.icon}</div>
<div>${c.title}</div>
</div>
<div class="kbody">${c.body}</div>

        `;

        keyCards.appendChild(el);

      });

      // facts

      productFacts.innerHTML = "";

      product.facts.forEach(f => {

        const li = document.createElement('li');

        li.className = "li";

        li.innerHTML = `<span>${f.k}</span><b>${f.v}</b>`;

        productFacts.appendChild(li);

      });

      targetLine.textContent = product.target_line;

      defenseCopy.innerHTML = product.defense_copy_html;

      // scan meta

      scanBadge.textContent = meta?.method || "TEST";

      scanInfo.textContent = meta?.message || "ì œí’ˆì„ ì¸ì‹í–ˆìŠµë‹ˆë‹¤.";

    }

    function backHome(){

      viewResult.classList.add('hide');

      viewEntry.classList.remove('hide');

    }

    function lookupProduct(code){

      return PRODUCT_DB[String(code || "").trim()] || null;

    }

    function updateDetectorSupport(){

      const supported = 'BarcodeDetector' in window;

      envPill.textContent = supported ? "BarcodeDetector ì§€ì›" : "ìˆ˜ë™ ì…ë ¥ ê¶Œì¥";

      scanTech.innerHTML = `ì¸ì‹: <b>${supported ? "ìë™ ê°€ëŠ¥" : "ìˆ˜ë™ ì…ë ¥"}</b>`;

    }

    // =========================

    // 5) ì¹´ë©”ë¼/ìŠ¤ìº”

    // =========================

    async function startCamera(){

      // í›„ë©´ ì¹´ë©”ë¼ ìš°ì„ 

      const constraints = {

        video: {

          facingMode: { ideal: "environment" },

          width: { ideal: 1280 },

          height: { ideal: 720 }

        },

        audio: false

      };

      stream = await navigator.mediaDevices.getUserMedia(constraints);

      video.srcObject = stream;

      await video.play();

    }

    function stopCamera(){

      if(stream){

        stream.getTracks().forEach(t => t.stop());

        stream = null;

      }

      if(video){

        video.pause();

        video.srcObject = null;

      }

    }

    function initDetector(){

      if(!('BarcodeDetector' in window)) return null;

      try{

        // ëŒ€ë¶€ë¶„ EAN_13, EAN_8, CODE_128ë¡œ ì»¤ë²„

        return new BarcodeDetector({ formats: ["ean_13","ean_8","code_128","qr_code"] });

      }catch(e){

        return null;

      }

    }

    async function scanLoop(){

      if(!scanning || !detector) return;

      try{

        const barcodes = await detector.detect(video);

        if(barcodes && barcodes.length){

          const code = barcodes[0].rawValue;

          handleScanSuccess(code, "ì¹´ë©”ë¼(ìë™)");

          return;

        }

      }catch(e){

        // detect ì‹¤íŒ¨ ì‹œ ë£¨í”„ ê³„ì†

      }

      rafId = requestAnimationFrame(scanLoop);

    }

    async function startScan(){

      try{

        if(!navigator.mediaDevices?.getUserMedia){

          setStatus("ì´ ê¸°ê¸°ëŠ” ì¹´ë©”ë¼ ì ‘ê·¼ì„ ì§€ì›í•˜ì§€ ì•Šì•„ìš”.", "ì‹¤íŒ¨");

          return;

        }

        setStatus("ì¹´ë©”ë¼ ì¤€ë¹„ ì¤‘â€¦", "ì§„í–‰");

        await startCamera();

        detector = initDetector();

        if(detector){

          scanning = true;

          setStatus("ë°”ì½”ë“œë¥¼ í”„ë ˆì„ì— ë§ì¶°ì£¼ì„¸ìš”", "ìŠ¤ìº” ì¤‘");

          rafId = requestAnimationFrame(scanLoop);

        }else{

          setStatus("ìë™ ì¸ì‹ ë¯¸ì§€ì› â†’ ì•„ë˜ì— ì½”ë“œ ì…ë ¥í•´ì£¼ì„¸ìš”", "ì•ˆë‚´");

        }

      }catch(err){

        setStatus("ì¹´ë©”ë¼ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.", "ì‹¤íŒ¨");

      }

    }

    function stopScan(){

      scanning = false;

      if(rafId) cancelAnimationFrame(rafId);

      rafId = null;

      detector = null;

      stopCamera();

      setStatus("", "ëŒ€ê¸°");

    }

    function handleScanSuccess(code, method){

      const product = lookupProduct(code);

      closeModal();

      if(product){

        showResult(product, {

          method: method,

          message: `ì œí’ˆì„ ì¸ì‹í–ˆìŠµë‹ˆë‹¤. (ì½”ë“œ: ${code})`

        });

      }else{

        // ì¸ì‹ì€ í–ˆì§€ë§Œ DBì— ì—†ì„ ë•Œ: í…ŒìŠ¤íŠ¸ì—ì„œëŠ” ì•ˆë‚´ë§Œ

        alert(`ì¸ì‹ëœ ì½”ë“œ(${code})ê°€ í…ŒìŠ¤íŠ¸ DBì— ì—†ìŠµë‹ˆë‹¤.\nPRODUCT_DBì— ë°”ì½”ë“œë¥¼ ì¶”ê°€í•´ ì£¼ì„¸ìš”.`);

        backHome();

      }

    }

    // =========================

    // 6) ì´ë²¤íŠ¸

    // =========================

    btnOpenScan.addEventListener('click', () => openModal());

    btnCloseScan.addEventListener('click', () => closeModal());

    btnStart.addEventListener('click', () => startScan());

    btnUseManual.addEventListener('click', () => {

      const code = manualCode.value.trim();

      if(!code){

        alert("í…ŒìŠ¤íŠ¸ìš© ì½”ë“œë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”. ì˜ˆ: 1234567890123");

        return;

      }

      handleScanSuccess(code, "ìˆ˜ë™ ì…ë ¥");

    });

    btnGoManual.addEventListener('click', () => {

      openModal();

      setStatus("í…ŒìŠ¤íŠ¸ìš© ì½”ë“œ ì…ë ¥ ê°€ëŠ¥", "ì•ˆë‚´");

      manualCode.focus();

    });

    btnRescan.addEventListener('click', () => openModal());

    btnBackHome.addEventListener('click', () => backHome());

    btnAR.addEventListener('click', () => {

      alert("í…ŒìŠ¤íŠ¸ ë‹¨ê³„: ARì€ ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì—°ê²°í•©ë‹ˆë‹¤.\n(ì§€ê¸ˆì€ ë²„íŠ¼/ë™ì„ ë§Œ ê²€ì¦)");

    });

    // ë‹«ê¸°: ë°°ê²½ í´ë¦­

    scanModal.addEventListener('click', (e) => {

      if(e.target === scanModal) closeModal();

    });

    // ì´ˆê¸° í™˜ê²½ í‘œì‹œ

    updateDetectorSupport();
</script>
</body>
</html>
