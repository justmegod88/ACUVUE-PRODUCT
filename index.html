<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ì œí’ˆ í´ë¦­ â†’ 3D í”„ë¦¬ë·°(í…ŒìŠ¤íŠ¸)</title>
  <style>
    :root{
      --bg:#f6f8fc;
      --surface:#ffffff;
      --text:#0b1220;
      --muted:#5b6475;

      --brand:#0b4aa2;
      --brand2:#1e78ff;

      --line:#e6e9f2;
      --shadow: 0 10px 28px rgba(16,24,40,0.10);
      --shadow2: 0 6px 16px rgba(16,24,40,0.08);

      --radius: 18px;

      --green:#18a85b;
      --green2:#0f8b49;

      --max: 760px;
      --safeTop: env(safe-area-inset-top, 0px);
      --safeBottom: env(safe-area-inset-bottom, 0px);
    }

    *{box-sizing:border-box}
    html, body{height:100%}
    body{
      margin:0;
      color:var(--text);
      font-family:-apple-system,BlinkMacSystemFont,"Apple SD Gothic Neo","Noto Sans KR","Malgun Gothic",Arial,sans-serif;
      line-height:1.35;
      background:
        radial-gradient(1200px 500px at 20% -10%, rgba(30,120,255,0.12), transparent 60%),
        radial-gradient(900px 450px at 90% 0%, rgba(11,74,162,0.10), transparent 55%),
        var(--bg);
    }

    .wrap{ max-width: var(--max); margin:0 auto; padding: 18px 16px calc(44px + var(--safeBottom)); }

    header{
      position: sticky; top: 0; z-index: 5;
      padding: calc(10px + var(--safeTop)) 0 10px;
      backdrop-filter: blur(10px);
      background: rgba(246,248,252,0.72);
      border-bottom: 1px solid rgba(230,233,242,0.75);
    }
    .headRow{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
    .brandBox{ display:flex; flex-direction:column; gap:2px; min-width:0; }
    .brandBox .title{ font-weight:950; letter-spacing:-0.45px; font-size:16px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .brandBox .sub{ font-size:12px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

    .pill{
      font-size:12px; padding:8px 10px;
      border:1px solid var(--line);
      border-radius:999px;
      color:var(--muted);
      background: rgba(255,255,255,0.9);
      box-shadow: 0 2px 10px rgba(16,24,40,0.06);
      flex: 0 0 auto;
    }

    .card{
      background: var(--surface);
      border: 1px solid rgba(230,233,242,0.9);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: var(--shadow);
    }

    .listTitle{
      font-size:18px;
      font-weight:980;
      letter-spacing:-0.6px;
      margin: 8px 0 12px;
    }
    .hint{ font-size:12px; color:var(--muted); margin-top:10px; line-height:1.45; }

    /* ===== ì œí’ˆ ì¹´ë“œ ===== */
    .productCard{
      border: 1px solid rgba(230,233,242,0.95);
      border-radius: 16px;
      padding: 14px;
      display:flex;
      gap:12px;
      align-items:center;
      box-shadow: var(--shadow2);
      background: rgba(255,255,255,0.96);
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .productCard:active{ transform: scale(0.99); }
    .productCard:hover{ box-shadow: 0 12px 26px rgba(16,24,40,0.10); }

    .pThumb{
      width: 92px;
      height: 56px;
      border-radius: 12px;
      border: 1px solid rgba(230,233,242,0.95);
      background:
        radial-gradient(120px 60px at 30% 30%, rgba(30,120,255,0.22), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,0.92), rgba(255,255,255,0.72));
      display:grid;
      place-items:center;
      font-weight:950;
      color: rgba(11,74,162,0.9);
      letter-spacing:-0.2px;
      flex: 0 0 auto;
      text-align:center;
      font-size:12px;
      line-height:1.1;
    }

    .pInfo{ min-width:0; flex:1; }
    .pName{ font-weight:980; letter-spacing:-0.4px; font-size:15px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .pDesc{ margin-top:4px; font-size:12px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .chips{ margin-top:8px; display:flex; gap:8px; flex-wrap:wrap; }
    .chip{
      font-size:12px;
      padding:7px 10px;
      border-radius: 999px;
      background: rgba(11,74,162,0.06);
      border: 1px solid rgba(11,74,162,0.10);
      color: rgba(11,74,162,0.95);
      font-weight: 900;
      letter-spacing:-0.2px;
    }

    .arrow{
      width: 34px; height: 34px;
      border-radius: 12px;
      border: 1px solid rgba(230,233,242,0.95);
      background: rgba(255,255,255,0.92);
      display:grid;
      place-items:center;
      color: rgba(11,74,162,0.9);
      font-weight: 950;
      box-shadow: var(--shadow2);
      flex: 0 0 auto;
    }

    .gap{ height: 12px; }

    /* ========== MODAL ========== */
    .modal{
      position: fixed; inset:0;
      background: rgba(0,0,0,0.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 12px;
      z-index: 50;
    }
    .modal.open{ display:flex; }

    .modalBox{
      width:100%;
      max-width: 720px;
      background:#fff;
      border-radius: var(--radius);
      overflow:hidden;
      border: 1px solid rgba(230,233,242,0.95);
      box-shadow: var(--shadow);
      transform: translateY(6px) scale(0.99);
      opacity: 0;
      transition: transform .18s ease, opacity .18s ease;
    }
    .modal.open .modalBox{
      transform: translateY(0) scale(1);
      opacity: 1;
    }

    .modalTop{
      padding: 12px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom: 1px solid rgba(230,233,242,0.95);
      background: rgba(255,255,255,0.92);
      backdrop-filter: blur(10px);
    }
    .modalTop .t{ font-weight: 980; letter-spacing:-0.3px; }

    .x{
      border:1px solid rgba(230,233,242,0.95);
      background:#fff;
      font-size:14px;
      font-weight:950;
      cursor:pointer;
      padding: 10px 12px;
      border-radius: 12px;
      box-shadow: var(--shadow2);
    }

    /* ===== 3D Stage ===== */
    .stage{
      position: relative;
      width:100%;
      aspect-ratio: 3 / 4;
      background:
        radial-gradient(720px 360px at 50% 8%, rgba(30,120,255,0.22), transparent 62%),
        radial-gradient(660px 360px at 0% 40%, rgba(11,74,162,0.12), transparent 60%),
        linear-gradient(180deg, #1a2636 0%, #0f1726 100%);
      overflow:hidden;
      touch-action: none;
    }

    /* ìƒë‹¨ ì œí’ˆëª… ë°” */
    .headerBar{
      position:absolute;
      left:10px; right:10px; top:10px;
      background: rgba(255,255,255,0.92);
      border: 1px solid rgba(230,233,242,0.9);
      border-radius: 16px;
      padding: 10px 12px;
      box-shadow: var(--shadow2);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      backdrop-filter: blur(10px);
      pointer-events:none;
    }
    .headerBar .name{
      font-weight:980; letter-spacing:-0.2px; font-size:13px;
      color: var(--text);
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }

    /* ìš°ì¸¡ í•«ìŠ¤íŒŸ + ê¸°ëŠ¥ ë²„íŠ¼ */
    .rail{
      position:absolute;
      right: 10px;
      top: 56px;
      display:flex;
      flex-direction:column;
      gap:10px;
      pointer-events:auto;
    }
    .railGroupTitle{
      font-size:11px;
      color: rgba(255,255,255,0.70);
      letter-spacing:-0.1px;
      margin: 4px 0 -4px;
      text-align:center;
      user-select:none;
    }
    .ptBtn{
      width: 46px; height: 46px;
      border-radius: 999px;
      border: 1px solid rgba(230,233,242,0.95);
      background: rgba(255,255,255,0.92);
      box-shadow: var(--shadow2);
      display:grid;
      place-items:center;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;
    }
    .ptBtn:active{ transform: translateY(1px) scale(0.99); }
    .ptBtn.active{
      border-color: rgba(11,74,162,0.35);
      box-shadow: 0 10px 24px rgba(11,74,162,0.18);
      transform: translateY(-1px);
    }
    .ptIcon{
      width: 28px; height: 28px;
      border-radius: 999px;
      display:grid;
      place-items:center;
      font-size: 13px;
      background: rgba(11,74,162,0.10);
      border: 1px solid rgba(11,74,162,0.16);
      font-weight: 950;
    }

    /* ì¤‘ì•™ ë Œì¦ˆ ìº”ë²„ìŠ¤ */
    #lens3d{
      position:absolute;
      left: 50%;
      top: 38%;
      transform: translate(-50%, -50%);
      width: min(84vw, 430px);
      height: min(84vw, 430px);
      pointer-events:auto;
      filter: drop-shadow(0 26px 34px rgba(0,0,0,0.22));
      touch-action: none;
    }

    /* "ìš°ì•„í•œ" ê´‘ì› íŒŒí‹°í´ */
    .glowDust{
      position:absolute; inset:-30px;
      background:
        radial-gradient(8px 8px at 20% 30%, rgba(255,255,255,0.18), transparent 60%),
        radial-gradient(10px 10px at 70% 20%, rgba(120,210,255,0.14), transparent 60%),
        radial-gradient(9px 9px at 55% 60%, rgba(255,255,255,0.10), transparent 60%),
        radial-gradient(12px 12px at 35% 75%, rgba(30,120,255,0.10), transparent 60%);
      mix-blend-mode: screen;
      opacity: 0.75;
      animation: floatDust 6.5s ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes floatDust{
      0%{ transform: translateY(0) }
      50%{ transform: translateY(-10px) }
      100%{ transform: translateY(0) }
    }

    /* í•˜ë‹¨ ì„¤ëª… ì¹´ë“œ */
    .infoCard{
      position:absolute;
      left:10px; right:10px;
      bottom: calc(64px + var(--safeBottom));
      border-radius: 16px;
      background: rgba(19, 27, 44, 0.58);
      border: 1px solid rgba(255,255,255,0.12);
      backdrop-filter: blur(14px);
      box-shadow: 0 12px 30px rgba(0,0,0,0.22);
      color:#fff;
      padding: 12px 12px;
      pointer-events:auto;
      overflow:hidden;
    }
    .infoTopRow{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
    }
    .infoTitle{
      font-weight:980;
      letter-spacing:-0.35px;
      font-size: 14px;
      line-height:1.2;
      margin:0 0 6px;
    }
    .infoBody{
      font-size: 12.5px;
      line-height:1.45;
      opacity: 0.96;
      margin:0;
    }
    .miniPills{
      display:flex;
      gap:6px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .miniPill{
      font-size:11px;
      padding:6px 9px;
      border-radius:999px;
      background: rgba(255,255,255,0.10);
      border: 1px solid rgba(255,255,255,0.14);
      color: rgba(255,255,255,0.92);
      font-weight: 900;
      letter-spacing:-0.15px;
    }
    .infoActions{
      display:flex;
      gap:8px;
      margin-top:10px;
    }
    .ghostBtn{
      border:1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.08);
      color:#fff;
      font-weight:950;
      font-size:12px;
      padding: 9px 10px;
      border-radius: 12px;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
    }
    .ghostBtn:active{ transform: translateY(1px); }

    /* í™•ì¥ íŒ¨ë„(íƒ­/í€´ì¦ˆ) */
    .sheet{
      position:absolute;
      left:10px; right:10px;
      bottom: calc(64px + var(--safeBottom));
      transform: translateY(120%);
      opacity: 0;
      transition: transform .22s ease, opacity .22s ease;
      pointer-events:none;
    }
    .sheet.open{
      transform: translateY(0);
      opacity: 1;
      pointer-events:auto;
    }
    .sheetBox{
      border-radius: 16px;
      background: rgba(255,255,255,0.94);
      border: 1px solid rgba(230,233,242,0.95);
      box-shadow: 0 18px 40px rgba(0,0,0,0.22);
      overflow:hidden;
    }
    .sheetTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      padding: 10px 12px;
      background: rgba(255,255,255,0.96);
      border-bottom: 1px solid rgba(230,233,242,0.95);
    }
    .sheetTop .st{
      font-weight:980; letter-spacing:-0.2px; font-size:13px;
    }
    .tabs{
      display:flex;
      gap:6px;
      padding: 10px 12px 0;
      flex-wrap:wrap;
    }
    .tab{
      font-size:12px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(230,233,242,0.95);
      background:#fff;
      color: var(--text);
      font-weight: 950;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
    }
    .tab.active{
      border-color: rgba(11,74,162,0.26);
      background: rgba(11,74,162,0.06);
      color: rgba(11,74,162,0.95);
    }
    .tabBody{
      padding: 12px;
      color: var(--text);
      font-size: 12.5px;
      line-height: 1.55;
    }
    .check{
      margin: 8px 0 0;
      padding-left: 18px;
      color: rgba(11,18,32,0.92);
    }
    .check li{ margin: 6px 0; }
    .smallNote{
      margin-top:10px;
      font-size:12px;
      color: var(--muted);
      line-height:1.45;
    }

    /* í•˜ë‹¨ ë°”(ìƒíƒœ/CTA) */
    .modalBottom{
      padding: 12px 14px calc(14px + var(--safeBottom));
      border-top: 1px solid rgba(230,233,242,0.95);
      display:grid;
      gap: 10px;
      background: rgba(255,255,255,0.98);
    }
    .status{
      font-size: 13px;
      color: var(--muted);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .status b{ color: var(--text); }

    .actionRow{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      align-items:stretch;
    }
    .btn{
      width:100%;
      border:0;
      border-radius: 14px;
      padding: 14px 14px;
      font-size: 15px;
      font-weight: 950;
      background: linear-gradient(180deg, var(--brand2), var(--brand));
      color: #fff;
      cursor:pointer;
      box-shadow: 0 10px 22px rgba(11,74,162,0.22);
    }
    .btn:active{ transform: translateY(1px); }
    .btn.secondary{
      background: rgba(255,255,255,0.96);
      color: var(--text);
      border:1px solid var(--line);
      font-weight: 950;
      box-shadow: var(--shadow2);
    }
    .surveyBtn{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      text-decoration:none;
      padding: 12px 12px;
    }
    .surveyText{
      display:flex;
      flex-direction:column;
      gap:2px;
      min-width:0;
    }
    .surveyText .t1{ font-weight:980; font-size:14px; color: var(--text); line-height:1.2; }
    .surveyText .t2{ font-size:12px; color: var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .surveyThumb{
      width: 44px; height: 44px;
      border-radius: 10px;
      flex: 0 0 auto;
      background: linear-gradient(180deg, rgba(34,197,94,0.18), rgba(34,197,94,0.10));
      border: 1px solid rgba(230,233,242,0.95);
      display:grid;
      place-items:center;
      font-size: 18px;
    }

    /* ë¸”ë§í¬(ëˆˆ ê¹œë¹¡ì„) ì˜¤ë²„ë ˆì´ */
    .blink{
      position:absolute;
      inset:0;
      background: #000;
      opacity:0;
      pointer-events:none;
    }

    /* ì‘ì€ í† ìŠ¤íŠ¸ */
    .toast{
      position:absolute;
      left:50%;
      top: 64px;
      transform: translateX(-50%) translateY(-8px);
      background: rgba(255,255,255,0.92);
      border: 1px solid rgba(230,233,242,0.95);
      border-radius: 999px;
      box-shadow: var(--shadow2);
      padding: 8px 10px;
      font-size:12px;
      font-weight: 900;
      color: rgba(11,18,32,0.92);
      opacity:0;
      transition: opacity .18s ease, transform .18s ease;
      pointer-events:none;
    }
    .toast.on{
      opacity:1;
      transform: translateX(-50%) translateY(0);
    }

    /* ê°€ì´ë“œ ì§„í–‰ë°” */
    .tourBar{
      position:absolute;
      left:10px; right:10px;
      top: 56px;
      height: 6px;
      background: rgba(255,255,255,0.10);
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 999px;
      overflow:hidden;
      opacity:0;
      pointer-events:none;
    }
    .tourBar.on{ opacity:1; }
    .tourFill{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(30,120,255,0.9), rgba(120,210,255,0.9));
      border-radius: 999px;
      transition: width .30s ease;
    }

    @media (max-width: 420px){
      .pThumb{ width: 84px; height: 52px; }
      #lens3d{ width: min(86vw, 400px); height: min(86vw, 400px); }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="headRow">
        <div class="brandBox">
          <div class="title">ì•Œë¦¼í†¡ ëœë”© (í…ŒìŠ¤íŠ¸)</div>
          <div class="sub">ì œí’ˆ ì¹´ë“œ í´ë¦­ â†’ 3D í”„ë¦¬ë·°(í•«ìŠ¤íŒŸ/ê°€ì´ë“œ/ì •ë³´/í€´ì¦ˆ)</div>
        </div>
        <div class="pill">í´ë¦­ ì¦‰ì‹œ</div>
      </div>
    </header>

    <section>
      <div class="card">
        <div class="listTitle">ì•„íë¸ŒÂ® ì½˜íƒíŠ¸ë Œì¦ˆ</div>

        <div class="productCard" data-product="omax">
          <div class="pThumb">OASYS<br>MAX</div>
          <div class="pInfo">
            <div class="pName">ì•„íë¸Œ ì˜¤ì•„ì‹œìŠ¤ ë§¥ìŠ¤ ì›ë°ì´</div>
            <div class="pDesc">í´ë¦­í•˜ë©´ 3D í”„ë¦¬ë·° + í•µì‹¬ 3í¬ì¸íŠ¸</div>
            <div class="chips">
              <div class="chip">#ë¸”ë£¨ë¼ì´íŠ¸</div>
              <div class="chip">#ëˆˆë¬¼ì•ˆì •í™”</div>
              <div class="chip">#123ë§ˆí¬</div>
            </div>
          </div>
          <div class="arrow">â€º</div>
        </div>

        <div class="gap"></div>

        <div class="productCard" data-product="o1day">
          <div class="pThumb">OASYS<br>1-DAY</div>
          <div class="pInfo">
            <div class="pName">ì•„íë¸Œ ì˜¤ì•„ì‹œìŠ¤ ì›ë°ì´Â® (ìƒ˜í”Œ)</div>
            <div class="pDesc">ë™ì¼ UIë¡œ ë‹¤ë¥¸ ë Œì¦ˆ í™•ì¥ ê°€ëŠ¥</div>
            <div class="chips">
              <div class="chip">#ì°©ìš©ê°</div>
              <div class="chip">#ë³´ìŠµ</div>
              <div class="chip">#ê´€ë¦¬</div>
            </div>
          </div>
          <div class="arrow">â€º</div>
        </div>

        <div class="hint">
          * í…ŒìŠ¤íŠ¸ìš© 3DëŠ” â€œê³ ê¸‰ìŠ¤ëŸ½ê²Œ ëŠê»´ì§€ëŠ” ì¸í„°ë™ì…˜â€ ì¤‘ì‹¬ì…ë‹ˆë‹¤.<br>
          (ì‹¤ì œ ì œí’ˆë³„ ë¬¸êµ¬/ì£¼ì˜ì‚¬í•­/ê´€ë¦¬/ì°©ìš©Â·ì œê±°ëŠ” ë„ˆê°€ ìš”ì²­í•˜ë©´ ì½˜í…ì¸ ë§Œ êµì²´ ê°€ëŠ¥)
        </div>
      </div>
    </section>
  </div>

  <!-- ê²°ê³¼ ëª¨ë‹¬ -->
  <div class="modal" id="resultModal" aria-hidden="true">
    <div class="modalBox">
      <div class="modalTop">
        <div class="t">3D í”„ë¦¬ë·°</div>
        <button class="x" id="btnClose">ë‹«ê¸°</button>
      </div>

      <div class="stage" id="stage">
        <div class="glowDust"></div>
        <div class="blink" id="blink"></div>

        <div class="headerBar">
          <div class="name" id="productTop">ì œí’ˆëª…</div>
          <div class="name" style="opacity:0; font-size:12px;">.</div>
        </div>

        <div class="tourBar" id="tourBar"><div class="tourFill" id="tourFill"></div></div>
        <div class="toast" id="toast">ì•ˆë‚´</div>

        <div class="rail">
          <div class="railGroupTitle">í•µì‹¬</div>
          <div class="ptBtn" id="btnHot1" title="í•«ìŠ¤íŒŸ 1"><div class="ptIcon" id="hot1Icon">ğŸ’§</div></div>
          <div class="ptBtn" id="btnHot2" title="í•«ìŠ¤íŒŸ 2"><div class="ptIcon" id="hot2Icon">123</div></div>
          <div class="ptBtn" id="btnHot3" title="í•«ìŠ¤íŒŸ 3"><div class="ptIcon" id="hot3Icon">ğŸŸ¦</div></div>

          <div class="railGroupTitle" style="margin-top:8px;">íš¨ê³¼</div>
          <div class="ptBtn" id="btnTour" title="1ë¶„ ê°€ì´ë“œ"><div class="ptIcon">â–¶ï¸</div></div>
          <div class="ptBtn" id="btnBlink" title="ëˆˆ ê¹œë¹¡ì„"><div class="ptIcon">ğŸ‘</div></div>
          <div class="ptBtn" id="btnReset" title="ë¦¬ì…‹"><div class="ptIcon">âŸ²</div></div>
        </div>

        <canvas id="lens3d" width="900" height="900"></canvas>

        <!-- í•˜ë‹¨ ì„¤ëª… ì¹´ë“œ -->
        <div class="infoCard" id="infoCard">
          <div class="infoTopRow">
            <div style="min-width:0; flex:1">
              <div class="infoTitle" id="infoTitle">íƒ€ì´í‹€</div>
              <p class="infoBody" id="infoBody">ë°”ë””</p>
              <div class="miniPills" id="miniPills"></div>
            </div>
          </div>
          <div class="infoActions">
            <button class="ghostBtn" id="btnOpenInfo">ì£¼ì˜/ê´€ë¦¬/ì°©ìš©</button>
            <button class="ghostBtn" id="btnOpenQuiz">í€´ì¦ˆ(3ë¬¸í•­)</button>
          </div>
        </div>

        <!-- í™•ì¥ ì‹œíŠ¸(íƒ­/í€´ì¦ˆ) -->
        <div class="sheet" id="sheet">
          <div class="sheetBox">
            <div class="sheetTop">
              <div class="st" id="sheetTitle">ì •ë³´</div>
              <button class="x" id="btnCloseSheet">ë‹«ê¸°</button>
            </div>
            <div class="tabs" id="tabs"></div>
            <div class="tabBody" id="tabBody"></div>
          </div>
        </div>
      </div>

      <div class="modalBottom">
        <div class="status">
          <span>ìƒíƒœ: <b id="statusLeft">ì‹¤í–‰ ì¤‘</b></span>
          <span>ì¡°ì‘: <b>ë“œë˜ê·¸/í•€ì¹˜ ì¤Œ</b></span>
        </div>

        <div class="actionRow">
          <button class="btn secondary" id="btnBack">ëª©ë¡ìœ¼ë¡œ</button>
          <a class="btn secondary surveyBtn" href="https://forms.office.com/r/aqt7sf0ciB" target="_blank" rel="noopener">
            <div class="surveyText">
              <div class="t1">ë§Œì¡±ë„ ì¡°ì‚¬</div>
              <div class="t2">ê¸°í”„í‹°ì½˜ 100% ì œê³µ</div>
            </div>
            <div class="surveyThumb">â˜•ï¸</div>
          </a>
        </div>
      </div>
    </div>
  </div>

  <script>
    // =========================
    // 1) í…ŒìŠ¤íŠ¸ìš© "ì½˜í…ì¸  ë°ì´í„°"
    //    -> ë„ˆê°€ ë‚˜ì¤‘ì— ì—¬ê¸°ë§Œ ë°”ê¾¸ë©´ ë¨
    // =========================
    const PRODUCTS = {
      omax: {
        name: "ì•„íë¸Œ ì˜¤ì•„ì‹œìŠ¤ ë§¥ìŠ¤ ì›ë°ì´",
        pills: ["#ë¸”ë£¨ë¼ì´íŠ¸", "#ëˆˆë¬¼ì•ˆì •í™”", "#123ë§ˆí¬"],
        hotspots: [
          { key:"TEAR", icon:"ğŸ’§", title:"ëˆˆë¬¼ ì•ˆì •í™” ê¸°ìˆ ", body:"ìŠµìœ¤ ì¸ìë¥¼ í†µí•´ ì˜¤ë˜ ì´‰ì´‰í•˜ê³  í¸ì•ˆí•œ ì°©ìš©ê°ì„ ì œê³µ", focus:{rx: 0.25, ry:-0.15, zoom: 1.08} },
          { key:"MARK", icon:"123", title:"123ë§ˆí¬", body:"ë Œì¦ˆ ë’¤ì§‘í˜ ì—¬ë¶€ë¥¼ ì§ê´€ì ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”", focus:{rx:-0.18, ry: 0.22, zoom: 1.12} },
          { key:"BLUE", icon:"ğŸŸ¦", title:"ë¸”ë£¨ë¼ì´íŠ¸ ì°¨ë‹¨", body:"ë””ì§€í„¸ í™”ë©´ ì‹œì²­ ì‹œ ëˆˆ í¸ì•ˆí•¨ì„ ê³ ë ¤í•œ ê¸°ëŠ¥(ìˆ˜ì¹˜ ë¬¸êµ¬ëŠ” ë‚´ë¶€ í™•ì •ë³¸ìœ¼ë¡œ êµì²´)", focus:{rx: 0.06, ry: 0.08, zoom: 1.10} }
        ],
        tabs: {
          "ì£¼ì˜ì‚¬í•­": [
            "í†µì¦/ì¶©í˜ˆ/ì‹œì•¼ ì´ìƒì´ ìˆìœ¼ë©´ ì¦‰ì‹œ ì°©ìš©ì„ ì¤‘ë‹¨í•˜ê³  ì „ë¬¸ê°€ì™€ ìƒë‹´í•˜ì„¸ìš”.",
            "íƒ€ì¸ê³¼ ê³µìœ  ê¸ˆì§€, ì† ìœ„ìƒ í›„ ì°©ìš©/ì œê±°.",
            "ì •í•´ì§„ êµì²´ì£¼ê¸°ë¥¼ ì§€í‚¤ê³ , ì‚¬ìš©ê¸°í•œì„ ë„˜ê¸°ì§€ ë§ˆì„¸ìš”."
          ],
          "ê´€ë¦¬ë°©ë²•": [
            "ì›ë°ì´ëŠ” ì¬ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”(í…ŒìŠ¤íŠ¸ ë¬¸êµ¬).",
            "ì¼€ì´ìŠ¤ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ ì •ê¸° êµì²´/ê±´ì¡° ìœ ì§€.",
            "ì œí’ˆ/ìƒí™©ì— ë§ëŠ” ê´€ë¦¬ë²• ë¬¸êµ¬ë¡œ êµì²´ ê°€ëŠ¥."
          ],
          "ì°©ìš©Â·ì œê±°": [
            "ì°©ìš©: ì† ì”»ê¸° â†’ ë Œì¦ˆ ì˜¬ë¦¬ê¸° â†’ ëˆˆì— ë¶€ë“œëŸ½ê²Œ ì°©ìš©",
            "ì œê±°: ì•„ë˜ë¥¼ ë³´ê³  ë Œì¦ˆë¥¼ ì‚´ì§ ëª¨ì•„ ì œê±°",
            "ì´ˆë³´ììš© íŒ/ì£¼ì˜ì‚¬í•­ì„ 3~5ë‹¨ê³„ë¡œ ì •ë¦¬ ê°€ëŠ¥"
          ]
        }
      },
      o1day: {
        name: "ì•„íë¸Œ ì˜¤ì•„ì‹œìŠ¤ ì›ë°ì´Â® (ìƒ˜í”Œ)",
        pills: ["#ì°©ìš©ê°", "#ë³´ìŠµ", "#ê´€ë¦¬"],
        hotspots: [
          { key:"TEAR", icon:"ğŸ’§", title:"ì´‰ì´‰í•¨ í¬ì¸íŠ¸", body:"í•˜ë£¨ ì¤‘ ê±´ì¡°ê°ì„ ì¤„ì´ë„ë¡ ì„¤ê³„ëœ ì½˜ì…‰íŠ¸(í…ŒìŠ¤íŠ¸)", focus:{rx: 0.18, ry:-0.10, zoom: 1.06} },
          { key:"MARK", icon:"123", title:"ì‚¬ìš© íŒ", body:"ì´ˆë³´ìê°€ í™•ì¸í•˜ê¸° ì‰¬ìš´ í¬ì¸íŠ¸ë¥¼ ì œê³µ(í…ŒìŠ¤íŠ¸)", focus:{rx:-0.10, ry: 0.18, zoom: 1.10} },
          { key:"BLUE", icon:"ğŸŸ¦", title:"íŠ¹ì§• 3", body:"í•«ìŠ¤íŒŸ 3ê°œ êµ¬ì¡°ë¡œ ì œí’ˆë³„ ì„¤ëª…ì„ í†µì¼(í…ŒìŠ¤íŠ¸)", focus:{rx: 0.00, ry: 0.06, zoom: 1.08} }
        ],
        tabs: {
          "ì£¼ì˜ì‚¬í•­": [
            "í…ŒìŠ¤íŠ¸: ì´ìƒ ì‹œ ì¤‘ë‹¨/ìƒë‹´, ì† ìœ„ìƒ, ê³µìœ  ê¸ˆì§€",
            "í…ŒìŠ¤íŠ¸: ì‚¬ìš©ê¸°í•œ/êµì²´ì£¼ê¸° ì¤€ìˆ˜"
          ],
          "ê´€ë¦¬ë°©ë²•": [
            "í…ŒìŠ¤íŠ¸: ì œí’ˆ ìœ í˜•ì— ë§ê²Œ ë¬¸êµ¬ êµì²´",
            "í…ŒìŠ¤íŠ¸: ë§¤ì¥/ë¸Œëœë“œ ê°€ì´ë“œì— ë§ì¶° ì¡°ì •"
          ],
          "ì°©ìš©Â·ì œê±°": [
            "í…ŒìŠ¤íŠ¸: 3~5ë‹¨ê³„ë¡œ ì‹œê°í™” ê°€ëŠ¥",
            "í…ŒìŠ¤íŠ¸: ì§§ì€ ìš”ì•½ + í¼ì¹˜ê¸° êµ¬ì¡° ì¶”ì²œ"
          ]
        }
      }
    };

    // =========================
    // 2) DOM
    // =========================
    const modal = document.getElementById("resultModal");
    const btnClose = document.getElementById("btnClose");
    const btnBack = document.getElementById("btnBack");
    const stage = document.getElementById("stage");

    const productTop = document.getElementById("productTop");
    const infoTitle = document.getElementById("infoTitle");
    const infoBody = document.getElementById("infoBody");
    const miniPills = document.getElementById("miniPills");
    const statusLeft = document.getElementById("statusLeft");

    const btnHot1 = document.getElementById("btnHot1");
    const btnHot2 = document.getElementById("btnHot2");
    const btnHot3 = document.getElementById("btnHot3");
    const hot1Icon = document.getElementById("hot1Icon");
    const hot2Icon = document.getElementById("hot2Icon");
    const hot3Icon = document.getElementById("hot3Icon");

    const btnTour = document.getElementById("btnTour");
    const btnBlink = document.getElementById("btnBlink");
    const btnReset = document.getElementById("btnReset");

    const blink = document.getElementById("blink");
    const toast = document.getElementById("toast");
    const tourBar = document.getElementById("tourBar");
    const tourFill = document.getElementById("tourFill");

    const btnOpenInfo = document.getElementById("btnOpenInfo");
    const btnOpenQuiz = document.getElementById("btnOpenQuiz");
    const sheet = document.getElementById("sheet");
    const sheetTitle = document.getElementById("sheetTitle");
    const btnCloseSheet = document.getElementById("btnCloseSheet");
    const tabsEl = document.getElementById("tabs");
    const tabBody = document.getElementById("tabBody");

    const lens = document.getElementById("lens3d");
    const ctx = lens.getContext("2d", { alpha:true });

    // =========================
    // 3) Modal helpers
    // =========================
    function openModal(){
      modal.classList.add("open");
      modal.setAttribute("aria-hidden","false");
    }
    function closeModal(){
      modal.classList.remove("open");
      modal.setAttribute("aria-hidden","true");
      closeSheet();
      stopTour();
    }

    btnClose.addEventListener("click", closeModal);
    btnBack.addEventListener("click", closeModal);
    modal.addEventListener("click", (e)=>{ if(e.target === modal) closeModal(); });

    // =========================
    // 4) ì‘ì€ UI helpers
    // =========================
    let toastTimer = null;
    function showToast(text){
      toast.textContent = text;
      toast.classList.add("on");
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=> toast.classList.remove("on"), 1400);
    }

    function haptic(){
      try{ navigator.vibrate && navigator.vibrate(12); }catch(_){}
    }

    // =========================
    // 5) State
    // =========================
    let current = PRODUCTS.omax;
    let activeHot = -1;

    // "ìš°ì•„í•œ 3D ëŠë‚Œ"ì„ ë‚´ëŠ” ê°€ì§œ ë Œì¦ˆ íŒŒë¼ë¯¸í„°
    let rx = 0.12, ry = -0.08;     // íšŒì „ ëŠë‚Œ(ê°€ì§œ)
    let offX = 0, offY = 0;        // ì‚´ì§ ì´ë™
    let zoom = 1.0;                // ì¤Œ
    let dragging = false;
    let pointers = new Map();
    let lastCenter = null;
    let lastDist = null;

    // í¬ì»¤ìŠ¤ ì• ë‹ˆë©”ì´ì…˜
    let target = { rx, ry, zoom, offX, offY };
    function setFocus(f){
      target.rx = f.rx ?? target.rx;
      target.ry = f.ry ?? target.ry;
      target.zoom = f.zoom ?? target.zoom;
      // ì´ë™ì€ ë„ˆë¬´ íŠ€ì§€ ì•Šê²Œ
      target.offX = f.offX ?? 0;
      target.offY = f.offY ?? 0;
    }

    function resetView(){
      rx = 0.12; ry = -0.08; offX = 0; offY = 0; zoom = 1.0;
      target = { rx, ry, zoom, offX, offY };
      showToast("ë¦¬ì…‹");
      haptic();
    }

    // =========================
    // 6) Open product
    // =========================
    function openProduct(key){
      current = PRODUCTS[key] || PRODUCTS.omax;
      productTop.textContent = current.name;

      // pills
      miniPills.innerHTML = "";
      (current.pills || []).forEach(p=>{
        const el = document.createElement("div");
        el.className = "miniPill";
        el.textContent = p;
        miniPills.appendChild(el);
      });

      // hotspots icons
      hot1Icon.textContent = current.hotspots[0].icon;
      hot2Icon.textContent = current.hotspots[1].icon;
      hot3Icon.textContent = current.hotspots[2].icon;

      // default card
      activeHot = -1;
      setActiveHot(-1);
      infoTitle.textContent = "ì œí’ˆ í•µì‹¬ 3í¬ì¸íŠ¸ë¥¼ ëˆŒëŸ¬ë³´ì„¸ìš”";
      infoBody.textContent = "ë“œë˜ê·¸ë¡œ íšŒì „, í•€ì¹˜ë¡œ í™•ëŒ€/ì¶•ì†Œ. íƒ­í•˜ë©´ ë¬¼ê²° íš¨ê³¼ê°€ ì‚´ì§ ë³´ì—¬ìš”.";
      statusLeft.textContent = "ì‹¤í–‰ ì¤‘";

      resetView();
      openModal();
      resizeCanvas();
      showToast("ë“œë˜ê·¸/í•€ì¹˜ë¡œ ì¡°ì‘");
    }

    document.querySelectorAll(".productCard").forEach(el=>{
      el.addEventListener("click", ()=>{
        openProduct(el.getAttribute("data-product"));
      });
    });

    // =========================
    // 7) Hotspots
    // =========================
    function setActiveHot(idx){
      [btnHot1, btnHot2, btnHot3].forEach((b,i)=> b.classList.toggle("active", i===idx));
      activeHot = idx;

      if(idx < 0){
        return;
      }
      const h = current.hotspots[idx];
      infoTitle.textContent = h.title;
      infoBody.textContent = h.body;
      setFocus(h.focus || {});

      showToast(h.title);
      haptic();
    }

    btnHot1.addEventListener("click", ()=> setActiveHot(0));
    btnHot2.addEventListener("click", ()=> setActiveHot(1));
    btnHot3.addEventListener("click", ()=> setActiveHot(2));

    // =========================
    // 8) Blink / Ripple / Reset
    // =========================
    function doBlink(){
      // ëˆˆêº¼í’€ ëŠë‚Œ: ë¹ ë¥´ê²Œ ë‹«í˜”ë‹¤ ì—´ë¦¼
      blink.style.opacity = "0";
      blink.style.transition = "none";
      requestAnimationFrame(()=>{
        blink.style.transition = "opacity .10s ease";
        blink.style.opacity = "0.75";
        setTimeout(()=>{
          blink.style.transition = "opacity .16s ease";
          blink.style.opacity = "0";
        }, 90);
      });
      showToast("Blink");
      haptic();
    }
    btnBlink.addEventListener("click", doBlink);
    btnReset.addEventListener("click", resetView);

    // íƒ­ ë¦¬í”Œ(ë¬¼ê²°) - ë Œì¦ˆ í‘œë©´ì— ì€ì€í•˜ê²Œ
    let ripples = [];
    function addRipple(x, y){
      ripples.push({x,y,t:0});
      if(ripples.length > 6) ripples.shift();
    }
    lens.addEventListener("click", (e)=>{
      // ë“œë˜ê·¸ ì¤‘ í´ë¦­ ë°©ì§€ ëŠë‚Œìœ¼ë¡œ ì•„ì£¼ ì‘ì€ ì¡°ê±´
      if(dragging) return;
      const r = lens.getBoundingClientRect();
      const x = (e.clientX - r.left) / r.width;
      const y = (e.clientY - r.top) / r.height;
      addRipple(x, y);
      showToast("âœ¨");
    });

    // =========================
    // 9) Info sheet (tabs) & Quiz
    // =========================
    function openSheet(title){
      sheetTitle.textContent = title;
      sheet.classList.add("open");
    }
    function closeSheet(){
      sheet.classList.remove("open");
    }
    btnCloseSheet.addEventListener("click", closeSheet);

    btnOpenInfo.addEventListener("click", ()=>{
      buildInfoTabs();
      openSheet("ì£¼ì˜/ê´€ë¦¬/ì°©ìš©");
      showToast("ì •ë³´");
      haptic();
    });

    btnOpenQuiz.addEventListener("click", ()=>{
      buildQuiz();
      openSheet("í€´ì¦ˆ");
      showToast("í€´ì¦ˆ");
      haptic();
    });

    function buildInfoTabs(){
      tabsEl.innerHTML = "";
      tabBody.innerHTML = "";

      const tabNames = Object.keys(current.tabs || {});
      const safeTabs = tabNames.length ? tabNames : ["ì£¼ì˜ì‚¬í•­","ê´€ë¦¬ë°©ë²•","ì°©ìš©Â·ì œê±°"];

      safeTabs.forEach((name, i)=>{
        const t = document.createElement("button");
        t.className = "tab";
        t.textContent = name;
        t.addEventListener("click", ()=> selectTab(name));
        tabsEl.appendChild(t);
        if(i===0) t.classList.add("active");
      });

      selectTab(safeTabs[0]);

      function selectTab(name){
        [...tabsEl.children].forEach(el=> el.classList.toggle("active", el.textContent===name));
        const list = (current.tabs && current.tabs[name]) ? current.tabs[name] : [];
        tabBody.innerHTML = `
          <div style="font-weight:980; letter-spacing:-0.2px; margin-bottom:6px;">${name}</div>
          <ul class="check">${list.map(x=>`<li>${escapeHtml(x)}</li>`).join("")}</ul>
          <div class="smallNote">* í…ŒìŠ¤íŠ¸ ë¬¸êµ¬ì…ë‹ˆë‹¤. ë‚´ë¶€ í™•ì •ë³¸ìœ¼ë¡œ êµì²´í•˜ë©´ ë©ë‹ˆë‹¤.</div>
        `;
      }
    }

    function buildQuiz(){
      tabsEl.innerHTML = "";
      tabBody.innerHTML = "";

      const Q = [
        { q:"Q1) 123 ë§ˆí¬ëŠ” ë¬´ì—‡ì„ í™•ì¸í•˜ë‚˜ìš”?", a:["ë¸”ë£¨ë¼ì´íŠ¸ ì°¨ë‹¨","ë Œì¦ˆ ë’¤ì§‘í˜ ì—¬ë¶€","ë Œì¦ˆ ì¬ê³ "], correct:1 },
        { q:"Q2) ë¸”ë£¨ë¼ì´íŠ¸ ì°¨ë‹¨ ì„¤ëª…ì˜ ëª©ì ì€?", a:["ë””ì§€í„¸ í™”ë©´ ì‹œì²­ ì‹œ ëˆˆ í¸ì•ˆí•¨ ê³ ë ¤","ë Œì¦ˆ ë‘ê»˜ ì¦ê°€","ìƒ‰ìƒ ë³€ê²½"], correct:0 },
        { q:"Q3) ê´€ë¦¬/ì£¼ì˜ì—ì„œ ê°€ì¥ ë¨¼ì € ë– ì˜¬ë¦´ í–‰ë™ì€?", a:["ì† ìœ„ìƒ í›„ ì°©ìš©/ì œê±°","ê³µìœ  ì°©ìš©","ì´ìƒ ìˆì–´ë„ ê³„ì† ì°©ìš©"], correct:0 }
      ];

      let idx = 0;
      let score = 0;

      render();

      function render(){
        const item = Q[idx];
        tabBody.innerHTML = `
          <div style="font-weight:980; letter-spacing:-0.2px; margin-bottom:10px;">${escapeHtml(item.q)}</div>
          <div style="display:grid; gap:8px;">
            ${item.a.map((t,i)=>`
              <button class="tab" style="border-radius:14px; text-align:left;" data-i="${i}">
                ${escapeHtml(t)}
              </button>
            `).join("")}
          </div>
          <div class="smallNote">* ì •ë‹µ/ì˜¤ë‹µ ì‹œ ìë™ í”¼ë“œë°±(í•«ìŠ¤íŒŸ ì´ë™) í…ŒìŠ¤íŠ¸</div>
        `;

        tabBody.querySelectorAll("button[data-i]").forEach(btn=>{
          btn.addEventListener("click", ()=>{
            const pick = Number(btn.getAttribute("data-i"));
            const ok = pick === item.correct;

            if(ok){
              score++;
              showToast("ì •ë‹µ âœ…");
              haptic();
            } else {
              showToast("ì˜¤ë‹µ â†’ ë³µìŠµ");
              haptic();
              // ì˜¤ë‹µì´ë©´ ê´€ë ¨ í•«ìŠ¤íŒŸìœ¼ë¡œ ì´ë™(ê°„ë‹¨ ê·œì¹™)
              if(idx === 0) setActiveHot(1);
              if(idx === 1) setActiveHot(2);
              if(idx === 2) setActiveHot(0);
            }

            idx++;
            if(idx >= Q.length){
              finish();
            } else {
              render();
            }
          });
        });
      }

      function finish(){
        tabBody.innerHTML = `
          <div style="font-weight:980; letter-spacing:-0.2px; margin-bottom:8px;">ì™„ë£Œ!</div>
          <div style="font-size:13px; line-height:1.6;">
            ì ìˆ˜: <b>${score} / ${Q.length}</b><br>
            í•µì‹¬ í¬ì¸íŠ¸ë¥¼ ë‹¤ì‹œ ëˆŒëŸ¬ë³´ë©° ë‚´ìš©ì„ í™•ì¸í•´ë³´ì„¸ìš”.
          </div>
          <div style="display:flex; gap:8px; margin-top:12px;">
            <button class="tab" id="quizAgain">ë‹¤ì‹œ í’€ê¸°</button>
            <button class="tab" id="quizClose">ë‹«ê¸°</button>
          </div>
        `;
        document.getElementById("quizAgain").addEventListener("click", ()=>{
          idx = 0; score = 0;
          render();
        });
        document.getElementById("quizClose").addEventListener("click", closeSheet);
      }
    }

    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // =========================
    // 10) 1-minute tour (auto guide)
    // =========================
    let tourRunning = false;
    let tourStep = 0;
    let tourTimer = null;

    function startTour(){
      if(tourRunning) return;
      tourRunning = true;
      tourStep = 0;
      tourBar.classList.add("on");
      statusLeft.textContent = "1ë¶„ ê°€ì´ë“œ";

      runStep();
      showToast("ê°€ì´ë“œ ì‹œì‘");
      haptic();
    }

    function stopTour(){
      tourRunning = false;
      clearTimeout(tourTimer);
      tourBar.classList.remove("on");
      tourFill.style.width = "0%";
      if(modal.classList.contains("open")) statusLeft.textContent = "ì‹¤í–‰ ì¤‘";
    }

    function runStep(){
      if(!tourRunning) return;

      const steps = [0,1,2];
      const idx = steps[tourStep] ?? 2;

      setActiveHot(idx);

      const pct = Math.round(((tourStep+1)/steps.length)*100);
      tourFill.style.width = pct + "%";

      // ë‹¤ìŒ ìŠ¤í…
      tourTimer = setTimeout(()=>{
        tourStep++;
        if(tourStep >= steps.length){
          showToast("ê°€ì´ë“œ ì™„ë£Œ");
          stopTour();
        } else {
          runStep();
        }
      }, 1700);
    }

    btnTour.addEventListener("click", ()=>{
      if(tourRunning) stopTour();
      else startTour();
    });

    // =========================
    // 11) Canvas rendering ("ìš°ì•„í•œ ê°€ì§œ 3D ë Œì¦ˆ")
    // =========================
    function resizeCanvas(){
      const r = lens.getBoundingClientRect();
      const dpr = Math.min(window.devicePixelRatio || 1, 2);
      lens.width = Math.floor(r.width * dpr);
      lens.height = Math.floor(r.height * dpr);
    }
    window.addEventListener("resize", resizeCanvas);

    // pointer gestures: drag rotate + pinch zoom
    function getCenterAndDist(){
      const pts = [...pointers.values()];
      if(pts.length === 1){
        return { center: {x: pts[0].x, y: pts[0].y}, dist: 0 };
      }
      if(pts.length >= 2){
        const a = pts[0], b = pts[1];
        const cx = (a.x + b.x)/2;
        const cy = (a.y + b.y)/2;
        const dx = a.x - b.x;
        const dy = a.y - b.y;
        const dist = Math.hypot(dx, dy);
        return { center: {x: cx, y: cy}, dist };
      }
      return null;
    }

    lens.addEventListener("pointerdown", (e)=>{
      lens.setPointerCapture(e.pointerId);
      pointers.set(e.pointerId, {x:e.clientX, y:e.clientY});
      dragging = true;
      lastCenter = null;
      lastDist = null;
    });

    lens.addEventListener("pointermove", (e)=>{
      if(!pointers.has(e.pointerId)) return;
      pointers.set(e.pointerId, {x:e.clientX, y:e.clientY});

      const cd = getCenterAndDist();
      if(!cd) return;

      // 1 pointer = rotate + slight translate
      if(pointers.size === 1){
        if(!lastCenter){ lastCenter = cd.center; return; }
        const dx = cd.center.x - lastCenter.x;
        const dy = cd.center.y - lastCenter.y;
        lastCenter = cd.center;

        // íšŒì „(ê°€ì§œ) ëŠë‚Œ
        rx += dy * 0.0022;
        ry += dx * 0.0022;

        // ì‚´ì§ ì´ë™(ë„ˆë¬´ í¬ê²Œ ì•ˆ)
        offX += dx * 0.08;
        offY += dy * 0.06;

        offX = clamp(offX, -24, 24);
        offY = clamp(offY, -18, 18);
      }

      // 2 pointers = pinch zoom
      if(pointers.size >= 2){
        if(lastDist == null){ lastDist = cd.dist; return; }
        const dd = cd.dist - lastDist;
        lastDist = cd.dist;
        zoom += dd * 0.0012;
        zoom = clamp(zoom, 0.88, 1.22);
      }
    });

    lens.addEventListener("pointerup", (e)=>{
      pointers.delete(e.pointerId);
      if(pointers.size === 0){
        dragging = false;
        lastCenter = null;
        lastDist = null;
      }
    });
    lens.addEventListener("pointercancel", (e)=> {
      pointers.delete(e.pointerId);
      if(pointers.size === 0){
        dragging = false;
        lastCenter = null;
        lastDist = null;
      }
    });

    function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }

    // main draw
    let t = 0;
    function draw(){
      requestAnimationFrame(draw);
      if(!modal.classList.contains("open")) return;

      t += 0.016;

      // idle motion (ìš°ì•„í•œ ì‚´ì•„ìˆìŒ)
      if(!dragging && !tourRunning){
        ry += 0.0009;
        rx += Math.sin(t*0.7) * 0.00012;
      }

      // focus easing
      rx += (target.rx - rx) * 0.08;
      ry += (target.ry - ry) * 0.08;
      zoom += (target.zoom - zoom) * 0.08;
      offX += (target.offX - offX) * 0.08;
      offY += (target.offY - offY) * 0.08;

      // center return (ë“œë˜ê·¸ ì—†ì„ ë•Œ ì‚´ì§ ì¤‘ì•™ ë³µê·€)
      if(!dragging){
        offX *= 0.94;
        offY *= 0.94;
      }

      const w = lens.width, h = lens.height;
      ctx.clearRect(0,0,w,h);

      const cx = w/2 + offX;
      const cy = h/2 + offY;
      const R = Math.min(w,h) * 0.40 * zoom;

      // light direction based on rx/ry
      const lx = cx + (ry * R * 1.2) - R*0.20;
      const ly = cy + (rx * R * 1.2) - R*0.26;

      // base glass gradient
      const g = ctx.createRadialGradient(lx, ly, R*0.08, cx, cy, R*1.12);
      const isBlue = (activeHot === 2);
      const tint = isBlue ? [170,255,236,0.22] : [220,245,255,0.20];

      g.addColorStop(0, `rgba(255,255,255,0.48)`);
      g.addColorStop(0.35, `rgba(${tint[0]},${tint[1]},${tint[2]},${tint[3]})`);
      g.addColorStop(1, `rgba(255,255,255,0.03)`);

      // disk
      ctx.beginPath();
      ctx.arc(cx, cy, R, 0, Math.PI*2);
      ctx.fillStyle = g;
      ctx.fill();

      // rim
      ctx.strokeStyle = `rgba(255,255,255,0.26)`;
      ctx.lineWidth = Math.max(2, R*0.010);
      ctx.beginPath();
      ctx.arc(cx, cy, R*0.985, 0, Math.PI*2);
      ctx.stroke();

      // inner ring
      ctx.strokeStyle = isBlue ? `rgba(30,120,255,0.20)` : `rgba(255,255,255,0.14)`;
      ctx.lineWidth = Math.max(1.5, R*0.007);
      ctx.beginPath();
      ctx.arc(cx, cy, R*0.62, 0, Math.PI*2);
      ctx.stroke();

      // highlight streaks (ìš°ì•„í•¨)
      ctx.save();
      ctx.globalCompositeOperation = "screen";
      const hl1 = ctx.createRadialGradient(cx - R*0.18, cy - R*0.20, R*0.02, cx - R*0.10, cy - R*0.14, R*0.62);
      hl1.addColorStop(0, "rgba(255,255,255,0.30)");
      hl1.addColorStop(1, "rgba(255,255,255,0.00)");
      ctx.fillStyle = hl1;
      ctx.beginPath();
      ctx.arc(cx, cy, R, 0, Math.PI*2);
      ctx.fill();

      const hl2 = ctx.createRadialGradient(cx + R*0.14, cy + R*0.08, R*0.02, cx + R*0.18, cy + R*0.12, R*0.70);
      hl2.addColorStop(0, "rgba(120,210,255,0.12)");
      hl2.addColorStop(1, "rgba(120,210,255,0.00)");
      ctx.fillStyle = hl2;
      ctx.beginPath();
      ctx.arc(cx, cy, R, 0, Math.PI*2);
      ctx.fill();
      ctx.restore();

      // subtle depth shadow
      const sh = ctx.createRadialGradient(cx, cy + R*0.68, R*0.02, cx, cy + R*0.78, R*0.56);
      sh.addColorStop(0, `rgba(0,0,0,0.18)`);
      sh.addColorStop(1, `rgba(0,0,0,0)`);
      ctx.fillStyle = sh;
      ctx.beginPath();
      ctx.arc(cx, cy, R, 0, Math.PI*2);
      ctx.fill();

      // Hotspot highlight (ì˜ì—­ ê¸€ë¡œìš°)
      if(activeHot >= 0){
        const hidx = activeHot;
        // ì˜ì—­ë³„ ìœ„ì¹˜(ë Œì¦ˆ ìœ„ ìƒëŒ€ì¢Œí‘œ)
        const spots = [
          {x: cx - R*0.22, y: cy - R*0.20}, // tear
          {x: cx,          y: cy + R*0.56}, // mark
          {x: cx + R*0.16, y: cy + R*0.06}  // blue
        ];
        const s = spots[hidx];
        const pulse = 0.55 + (Math.sin(t*3.0)+1)*0.20;

        ctx.save();
        ctx.globalCompositeOperation = "screen";
        const gg = ctx.createRadialGradient(s.x, s.y, R*0.02, s.x, s.y, R*0.26);
        gg.addColorStop(0, `rgba(255,255,255,${0.35*pulse})`);
        gg.addColorStop(1, `rgba(255,255,255,0)`);
        ctx.fillStyle = gg;
        ctx.beginPath();
        ctx.arc(s.x, s.y, R*0.28, 0, Math.PI*2);
        ctx.fill();
        ctx.restore();

        // MARKì¼ ë•Œ 123 í‘œì‹œ
        if(hidx === 1){
          ctx.save();
          ctx.globalAlpha = 0.90;
          ctx.fillStyle = "rgba(15,23,38,0.92)";
          ctx.font = `900 ${Math.max(18, R*0.14)}px Arial`;
          ctx.textAlign="center";
          ctx.textBaseline="middle";
          ctx.fillText("123", s.x, s.y);
          ctx.restore();
        }
      }

      // Ripples
      if(ripples.length){
        ctx.save();
        ctx.globalCompositeOperation = "screen";
        for(const r0 of ripples){
          r0.t += 0.020;
          const rr = r0.t * R*0.45;
          const alpha = Math.max(0, 0.14 - r0.t*0.10);

          const rxp = cx + (r0.x - 0.5) * R*1.3;
          const ryp = cy + (r0.y - 0.5) * R*1.3;

          ctx.strokeStyle = `rgba(255,255,255,${alpha})`;
          ctx.lineWidth = Math.max(1.2, R*0.006);
          ctx.beginPath();
          ctx.arc(rxp, ryp, rr, 0, Math.PI*2);
          ctx.stroke();
        }
        ctx.restore();
        // cleanup
        ripples = ripples.filter(x=> x.t < 1.2);
      }
    }

    // =========================
    // 12) Sheet open/close
    // =========================
    function closeSheet(){
      sheet.classList.remove("open");
    }
    btnCloseSheet.addEventListener("click", closeSheet);

    // =========================
    // 13) Init
    // =========================
    function init(){
      resizeCanvas();
      draw();
    }
    init();
  </script>
</body>
</html>
