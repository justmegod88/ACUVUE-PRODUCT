<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>ACUVUE GLB Viewer (model-viewer)</title>
  <style>
    html,body{height:100%;margin:0;background:#081625;overflow:hidden;font-family:-apple-system,system-ui;}
    #msg{
      position:fixed;left:12px;right:12px;top:12px;z-index:20;
      padding:10px 12px;border-radius:12px;
      background:rgba(0,0,0,.60);color:#eaf2ff;font-size:13px;white-space:pre-wrap;
      border:1px solid rgba(255,255,255,.14);
    }
    #btns{
      position:fixed;left:12px;right:12px;bottom:12px;z-index:20;
      display:flex;gap:8px;flex-wrap:wrap;
    }
    button{
      flex:1;min-width:120px;
      padding:12px 12px;border-radius:14px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.08);
      color:#eaf2ff;font-weight:800;font-size:13px;
      -webkit-tap-highlight-color: transparent;
    }
    button.primary{ background:rgba(0,255,140,.12); border-color:rgba(0,255,140,.35); }

    model-viewer{
      width:100vw;height:100vh;
      background:transparent;
    }
  </style>
</head>
<body>
  <div id="msg">준비중…</div>

  <div id="btns">
    <button id="btnTest" class="primary">test.glb 보기</button>
    <button id="btnEye">eye_animation.glb 보기</button>
    <button id="btnAnim">애니메이션 재생</button>
  </div>

  <!-- ✅ model-viewer 로더 (Three.js 내장) -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <script nomodule src="https://unpkg.com/@google/model-viewer/dist/model-viewer-legacy.js"></script>

  <!-- ✅ 뷰어 -->
  <model-viewer
    id="mv"
    src="test.glb"
    camera-controls
    touch-action="pan-y"
    autoplay
    exposure="1.1"
    shadow-intensity="0"
    style="display:block;">
  </model-viewer>

  <script>
    const msg = document.getElementById('msg');
    const mv  = document.getElementById('mv');

    // 에러를 화면에 표시
    window.addEventListener('error', (e)=>{
      msg.textContent = '❌ JS 에러\n' + (e.message || e);
    });

    // GLB 파일이 실제로 접근 가능한지(404면 여기서 바로 잡힘)
    async function probe(url){
      try{
        const r = await fetch(url + '?v=' + Date.now(), { method:'GET' });
        return r.ok ? '✅ 파일 접근 OK: ' + url : `❌ 파일 접근 실패: ${url}\nstatus: ${r.status}`;
      }catch(err){
        return `❌ 네트워크/권한 문제: ${url}\n${err}`;
      }
    }

    async function setModel(file){
      msg.textContent = '로딩중…\n' + file;

      // 파일 접근 테스트 결과 먼저 표시
      const p = await probe(file);
      msg.textContent = p + '\n\n모델 로딩 시도중…';

      // model-viewer에 src 변경(캐시 회피)
      mv.src = file + '?v=' + Date.now();
    }

    // model-viewer 이벤트
    mv.addEventListener('load', ()=>{
      msg.textContent = '✅ 로드 성공!\n드래그 회전 / 핀치 확대';
    });
    mv.addEventListener('error', (e)=>{
      msg.textContent = '❌ model-viewer 로딩 실패\n' + JSON.stringify(e.detail || {}, null, 2);
    });

    // 버튼
    document.getElementById('btnTest').onclick = ()=>setModel('test.glb');
    document.getElementById('btnEye').onclick  = ()=>setModel('eye_animation.glb');

    // 애니메이션 재생(eye_animation.glb에 애니메이션이 들어있다면 동작)
    document.getElementById('btnAnim').onclick = ()=>{
      try{
        mv.play();
        msg.textContent = '▶️ 애니메이션 재생 시도';
      }catch(e){
        msg.textContent = '❌ 애니메이션 재생 실패\n(파일에 애니메이션이 없을 수 있어요)';
      }
    };

    // 시작
    setModel('test.glb');
  </script>
</body>
</html>
