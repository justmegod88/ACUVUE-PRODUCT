<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>ACUVUE GLB Viewer (í°ìƒ‰/ ë¸”ë£¨)</title>

  <style>
    /* =========================
       âœ… ACUVUE White + Blue Theme (ìƒ‰ìƒë§Œ êµì²´)
       - ë‹¤ë¥¸ ë¡œì§/êµ¬ì¡°/JS ë¯¸ìˆ˜ì •(ìš”ì²­ ë°˜ì˜: ì„¤ëª…ì°½ ê³ ê¸‰ íš¨ê³¼ + PVP ì›í˜• í™•ëŒ€/ì •ë ¬)
       ========================= */

    :root{
      --acuvue-blue:#005EB8;
      --acuvue-blue-2:#1E78D6;
      --acuvue-soft:#EAF3FF;
      --acuvue-soft-2:#F5F9FF;
      --text-navy:#0B1F33;
      --text-sub:#30485F;
      --line:#D9E6F5;
      --shadow:0 18px 60px rgba(11,31,51,.18);
      --glass:rgba(255,255,255,.86);
      --glass-2:rgba(255,255,255,.72);

      /* âœ… ì„¤ëª…ì°½(íŒ¨ë„) ê³ ê¸‰ ë¶„ë¦¬ìš© í†¤ */
      --panel-grad: linear-gradient(180deg, rgba(234,243,255,.92) 0%, rgba(255,255,255,.90) 55%, rgba(245,249,255,.86) 100%);
      --panel-stroke: rgba(0,94,184,.18);
      --panel-stroke-2: rgba(11,31,51,.10);
      --panel-glow: 0 16px 50px rgba(0,94,184,.10), 0 18px 60px rgba(11,31,51,.14);
      --panel-topline: linear-gradient(90deg, rgba(0,94,184,.75), rgba(0,94,184,.12));
    }

    html,body{
      height:100%;
      margin:0;
      background:linear-gradient(180deg, var(--acuvue-soft-2) 0%, #ffffff 55%, var(--acuvue-soft-2) 100%);
      overflow:hidden;
      font-family:-apple-system,system-ui;
      color:var(--text-navy);
    }

    model-viewer{width:100vw;height:100vh;background:transparent;display:block;position:fixed;inset:0;z-index:1;}

    /* ìƒë‹¨ ë¯¸ì…˜ ì¹´ë“œ */
    #missionBar{
      position:fixed; left:12px; right:12px; top:12px; z-index:40;
      display:flex; gap:10px; align-items:stretch;
      pointer-events:auto;
    }
    .missionCard{
      flex:1;
      padding:12px 12px;
      border-radius:16px;
      background:var(--glass);
      border:1px solid var(--line);
      color:var(--text-navy);
      backdrop-filter: blur(10px);
      min-height:86px;
      box-sizing:border-box;

      -webkit-tap-highlight-color: transparent;
      user-select:none;
      cursor:pointer;
      transition: transform .08s ease, background .18s ease, border-color .18s ease;
      position:relative;
      box-shadow: 0 10px 28px rgba(11,31,51,.08);
    }
    .missionCard:active{ transform: scale(.99); }

    .missionCard.on{
      background:rgba(0,94,184,.10);
      border-color:rgba(0,94,184,.35);
    }

    .missionCard.done::after{
      content:"ì™„ë£Œ";
      position:absolute;
      right:10px; top:10px;
      font-size:11px;
      font-weight:900;
      padding:4px 8px;
      border-radius:999px;
      background:rgba(0,94,184,.12);
      border:1px solid rgba(0,94,184,.35);
      color:var(--acuvue-blue);
      backdrop-filter: blur(6px);
    }

    .missionNo{font-weight:900;opacity:.85;font-size:14px;margin-bottom:6px;color:var(--text-sub);}
    .missionTitle{font-weight:900;font-size:16px;margin-bottom:6px;color:var(--text-navy);}
    .missionDesc{font-size:12.5px;line-height:1.35;opacity:.9;white-space:pre-line;color:var(--text-sub);}

    /* í•˜ë‹¨ ë²„íŠ¼ */
    #bottomBtns{
      position:fixed;left:12px;right:12px;bottom:12px;z-index:50;
      display:flex;gap:8px;flex-wrap:wrap;align-items:center;
    }
    .btn{
      flex:1;min-width:140px;
      padding:12px 12px;border-radius:14px;
      border:1px solid var(--line);
      background:var(--glass);
      color:var(--text-navy);
      font-weight:900;font-size:13px;
      -webkit-tap-highlight-color: transparent;
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 28px rgba(11,31,51,.10);
    }
    .btn.primary{
      background:var(--acuvue-blue);
      border-color:rgba(0,94,184,.65);
      color:#ffffff;
    }

    /* ì‘ì€ ì›í˜• â†º ë²„íŠ¼ */
    #btnReset{
      width:46px;height:46px;min-width:46px;flex:0 0 auto;
      border-radius:999px;
      border:1px solid var(--line);
      background:var(--glass);
      color:var(--text-navy);
      font-weight:900;
      font-size:16px;
      display:flex;align-items:center;justify-content:center;
      backdrop-filter: blur(10px);
      -webkit-tap-highlight-color: transparent;
      box-shadow: 0 10px 28px rgba(11,31,51,.10);
    }

    /* =========================
       âœ… ë¸”ë£¨ë¼ì´íŠ¸: ìƒíƒœ pill + ê´‘ì„ (íˆ¬ê³¼/êº¾ì„) + ì„¤ëª…/ë¯¸ì…˜
       ========================= */

    #bluePill{
      position:fixed;
      right:14px;
      bottom:210px;
      z-index:72;
      display:none;

      padding:6px;
      border-radius:999px;
      background:var(--glass);
      border:1px solid var(--line);
      backdrop-filter: blur(12px);
      -webkit-tap-highlight-color: transparent;
      user-select:none;
      box-shadow: var(--shadow);

      gap:6px;
      align-items:center;
      white-space:nowrap;
    }
    .blueSegBtn{
      padding:9px 12px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(0,94,184,.06);
      color:var(--acuvue-blue);
      font-weight:900;
      font-size:13px;
      letter-spacing:.2px;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
    }
    .blueSegBtn:active{ transform:scale(.98); }
    .blueSegBtn.on{
      background:var(--acuvue-blue);
      border-color:rgba(0,94,184,.65);
      color:#ffffff;
    }

    #blueRayLayer{
      position:fixed;
      inset:0;
      z-index:200;
      pointer-events:none;
      display:none;
    }
    #blueRaySvg{
      width:100%;
      height:100%;
      display:block;
    }

    #blueRayLayerBack{
      position:fixed;
      inset:0;
      z-index:0;           /* âœ… ë Œì¦ˆ(model-viewer) ë’¤ë¡œ */
      pointer-events:none;
      display:none;
    }
    #blueRaySvgBack{
      width:100%;
      height:100%;
      display:block;
    }


    
    /* âœ… ì¶œì‚¬ê´‘(beamOut)ë§Œ ë Œì¦ˆ ë’¤ë¡œ ë³´ë‚´ê¸°ìš© ë ˆì´ì–´ */
    #blueRayBehind{
      position:fixed;
      inset:0;
      z-index:10; /* model-viewer(z=20)ë³´ë‹¤ ì•„ë˜ */
      pointer-events:none;
      display:none;
    }
    #blueRaySvgBack{
      width:100%;
      height:100%;
      display:block;
    }
#blueBackGlow{
      position:fixed;
      inset:0;
      z-index:199;
      pointer-events:none;
      display:none;
      background:
        radial-gradient(35% 22% at 66% 52%,
          rgba(0,94,184,.18) 0%,
          rgba(0,94,184,.12) 22%,
          rgba(0,94,184,.08) 38%,
          rgba(0,94,184,0) 62%);
      filter: blur(1px);
      opacity:.95;
    }

    /* âœ… í•˜ë‹¨ ì„¤ëª…/ë¯¸ì…˜ íŒ¨ë„ (ê³ ê¸‰ ë¶„ë¦¬: ì•„ì£¼ ì˜…ì€ í•˜ëŠ˜/ê·¸ë ˆì´ ê·¸ë¼ë°ì´ì…˜ + ìƒë‹¨ ë¼ì¸) */
    #blueInfo{
      position:fixed;
      left:12px;
      right:12px;
      bottom:92px;
      z-index:71;
      display:none;
      border-radius:14px;
      border:1px solid var(--panel-stroke);
      background: var(--panel-grad);
      backdrop-filter: blur(14px);
      box-shadow: var(--panel-glow);
      overflow:hidden;
    }
    #blueInfo::before{
      content:"";
      position:absolute;
      left:0; right:0; top:0;
      height:2px;
      background: var(--panel-topline);
      opacity:.95;
      pointer-events:none;
    }
    #blueInfo::after{
      content:"";
      position:absolute; inset:0;
      border-radius:14px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.45);
      pointer-events:none;
      opacity:.55;
    }

    #blueInfoTop{
      padding:10px 12px;
      border-bottom:1px solid rgba(11,31,51,.10);
      color:var(--text-navy);
      font-weight:900;
      font-size:13px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    #blueInfoTop b{ font-weight:900; }
    #blueInfoTop b .pct{ color:var(--acuvue-blue); }

    #blueInfoBody{
      padding:10px 12px;
      color:var(--text-sub);
      font-size:12.5px;
      line-height:1.35;
    }

    #blueInfoMission{
      padding:9px 12px;
      border-top:1px solid rgba(11,31,51,.10);
      color:var(--text-navy);
      font-size:12.5px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    #blueInfoMission .left{
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      flex:1 1 auto;
      color:var(--text-sub);
    }
    #blueInfoMission .confirm{
      color:#ffffff;
      font-weight:900;
      opacity:1;
      cursor:pointer;
      user-select:none;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(0,94,184,.65);
      background:var(--acuvue-blue);
      backdrop-filter: blur(8px);
      -webkit-tap-highlight-color: transparent;
      flex:0 0 auto;
      white-space:nowrap;
      display:none;
      box-shadow: 0 10px 22px rgba(0,94,184,.22);
    }
    #blueInfoMission .confirm:active{ transform:scale(.98); }

    /* ========================= */

    /* ASD ì˜¤ë²„ë ˆì´ */
    #asdOverlay{
      position:fixed; inset:0; z-index:80;
      display:none;
      background:rgba(11,31,51,.22);
      backdrop-filter: blur(12px);
      align-items:center; justify-content:center;
      padding:18px;
      box-sizing:border-box;
    }
    #asdOverlay.show{ display:flex; }
    #asdCard{
      width:min(920px, 96vw);
      border-radius:18px;
      border:1px solid var(--panel-stroke);
      background: var(--panel-grad);
      overflow:hidden;
      box-shadow: var(--panel-glow);
      position:relative;
    }
    #asdCard::before{
      content:"";
      position:absolute;
      left:0; right:0; top:0;
      height:2px;
      background: var(--panel-topline);
      opacity:.95;
      pointer-events:none;
    }
    #asdCard::after{
      content:"";
      position:absolute; inset:0;
      border-radius:18px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.45);
      pointer-events:none;
      opacity:.55;
    }

    #asdCard img:not(#asdLensImg):not(#asdEyeMV){
      width:100%;
      height:auto;
      display:block;
      background:rgba(0,94,184,.03);
    }

    #asdClose{
      position:absolute; right:10px; top:10px;
      width:38px; height:38px; border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.92);
      color:var(--text-navy);
      font-weight:900;
      -webkit-tap-highlight-color: transparent;
      z-index:6;
      box-shadow: 0 10px 18px rgba(11,31,51,.12);
    }
    #asdHint{
      padding:10px 12px;
      color:var(--text-sub);
      font-size:12.5px;
      opacity:.95;
      border-top:1px solid rgba(11,31,51,.10);
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
      background: linear-gradient(180deg, rgba(234,243,255,.70) 0%, rgba(255,255,255,.55) 100%);
    }
    #asdHint button{
      border:1px solid rgba(0,94,184,.65);
      background:var(--acuvue-blue);
      color:#ffffff;
      font-weight:900;
      font-size:12px;
      padding:8px 10px;
      border-radius:12px;
      -webkit-tap-highlight-color: transparent;
      backdrop-filter: blur(8px);
      cursor:pointer;
      flex:0 0 auto;
      white-space:nowrap;
      box-shadow: 0 10px 22px rgba(0,94,184,.22);
    }
    #asdHint button:active{ transform:scale(.98); }

    #asdScene{
      position:relative;
      width:100%;
      background:rgba(0,94,184,.03);
      overflow:hidden;
      aspect-ratio: 1/1;
      min-height: 360px;
      --irisX: 13px;
      --irisY: 26px;
    }

    #asdEyeMV{
      position:absolute; inset:0;
      width:100%; height:100%;
      display:block;
      background:transparent;
      pointer-events:none;
      object-fit:cover;
      transform: scale(1.55);
      transform-origin:center;
      filter: contrast(1.02) saturate(1.02);
    }

    #asdUpperLid{
      position:absolute; inset:0;
      width:100%; height:100%;
      display:block;
      pointer-events:none;
      object-fit:cover;
      transform: scale(1.55) translateY(3px);
      transform-origin:center;
      z-index:3; /* âœ… ë Œì¦ˆ ìœ„ì— ë®ì´ë„ë¡ */
      filter: drop-shadow(0 2px 10px rgba(0,0,0,.18));
    }


    #asdLensImg{
      position:absolute;
      left:50%;
      top:52%;
      width:80%;
      transform: translate(calc(-50% - 4px), calc(-50% + 10px)) rotate(20deg);
      transform-origin:50% 50% scale(1.35);
      opacity:.70;
      mix-blend-mode: normal;
      filter:saturate(1.08) contrast(1.06);
      pointer-events:none;
      will-change: transform, opacity;
    }
    #asdLensRim{
      position:absolute;
      left:50%;
      top:52%;
      width:80%;
      height:80%;
      transform:translate(-50%,-50%);
      border-radius:999px;
      pointer-events:none;
      box-shadow:
        0 0 0 1px rgba(11,31,51,.10),
        0 18px 46px rgba(11,31,51,.16),
        inset 0 0 24px rgba(255,255,255,.18);
      opacity:.45;
      mix-blend-mode: screen;
    }
    #asdMaskShade{
      position:absolute; inset:0;
      pointer-events:none;
      background:
        radial-gradient(110% 70% at 50% 18%,
          rgba(11,31,51,.38) 0%,
          rgba(11,31,51,.16) 32%,
          rgba(11,31,51,0) 58%),
        radial-gradient(110% 70% at 50% 90%,
          rgba(11,31,51,.34) 0%,
          rgba(11,31,51,.14) 34%,
          rgba(11,31,51,0) 60%);
      mix-blend-mode: multiply;
      opacity:.78;
    }

    #asdBlinkLid{
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index:4;
    }
    #asdLidTop, #asdLidBot{
      position:absolute;
      left:0; right:0;
      height:55%;
      background:
        radial-gradient(120% 90% at 50% 85%,
          rgba(165,120,95,.98) 0%,
          rgba(120,80,62,.98) 46%,
          rgba(40,25,22,.98) 92%);
      filter: blur(.2px);
      opacity:0;
      transform: translateY(-110%);
      will-change: transform, opacity;
    }
    #asdLidBot{
      top:auto; bottom:0;
      background:
        radial-gradient(120% 90% at 50% 15%,
          rgba(165,120,95,.98) 0%,
          rgba(120,80,62,.98) 46%,
          rgba(40,25,22,.98) 92%);
      transform: translateY(110%);
    }
    #asdLidTop::after, #asdLidBot::after{
      content:"";
      position:absolute;
      left:-10%; right:-10%;
      height:28px;
      background: radial-gradient(120% 100% at 50% 50%,
        rgba(0,0,0,.35) 0%,
        rgba(0,0,0,.18) 35%,
        rgba(0,0,0,0) 70%);
      opacity:.55;
    }
    #asdLidTop::after{ bottom:-12px; }
    #asdLidBot::after{ top:-12px; transform: scaleY(-1); }

    #asdBlinkBtn{
      position:absolute;
      right:14px;
      bottom:14px;
      width:54px;
      height:54px;
      border-radius:999px;
      border:1px solid rgba(0,94,184,.55);
      background:var(--acuvue-blue);
      backdrop-filter: blur(10px);
      color:#ffffff;
      font-weight:900;
      font-size:12px;
      display:flex;
      align-items:center;
      justify-content:center;
      -webkit-tap-highlight-color: transparent;
      user-select:none;
      cursor:pointer;
      box-shadow: 0 12px 26px rgba(0,94,184,.20);
      z-index:5;
    }
    #asdBlinkBtn:active{ transform:scale(.95); }
    #asdRotateBtn{
      position:absolute;
      right:76px;
      bottom:14px;
      width:54px;
      height:54px;
      border-radius:999px;
      border: 1px solid rgba(0,94,184,.35);
      background: rgba(255,255,255,.92);
      backdrop-filter: blur(10px);
      color:var(--acuvue-blue);
      font-weight:900;
      font-size:12px;
      display:flex;
      align-items:center;
      justify-content:center;
      -webkit-tap-highlight-color: transparent;
      user-select:none;
      cursor:pointer;
      box-shadow: 0 10px 22px rgba(11,31,51,.12);
      z-index:5;
    }
    #asdRotateBtn:active{ transform:scale(.95); }

    #asdAngleBadge{
      position:absolute;
      left:14px;
      bottom:18px;
      color:var(--acuvue-blue);
      font-size:12px;
      font-weight:900;
      text-shadow:none;
      background:rgba(255,255,255,.86);
      border:1px solid rgba(0,94,184,.35);
      border-radius:999px;
      padding:6px 10px;
      backdrop-filter: blur(8px);
      z-index:5;
      box-shadow: 0 10px 22px rgba(11,31,51,.10);
    }

    /* =========================
       âœ… PVP ì›í˜•: ë Œì¦ˆ ì¤‘ì•™ ì •ë ¬ + ì‚´ì§ ë” í¬ê²Œ + íŒì—… í™•ëŒ€ ì• ë‹ˆë©”ì´ì…˜
       ========================= */

    @keyframes pvpPop {
      0%   { transform: translate(-50%,-50%) scale(.94); opacity: 0; }
      60%  { transform: translate(-50%,-50%) scale(1.02); opacity: 1; }
      100% { transform: translate(-50%,-50%) scale(1.00); opacity: 1; }
    }

    #pvpBig{
      position:fixed;
      left:50%;
      top:50%;
      transform:translate(-50%,-50%);
      width:min(76vw, 560px);
      height:min(76vw, 560px);
      border-radius:999px;
      z-index:56;
      display:none;
      pointer-events:none;
      background:rgba(0,94,184,.04);
      border:1px solid var(--panel-stroke);
      backdrop-filter: blur(10px);
      overflow:hidden;
      box-shadow: var(--panel-glow);
    }
    #pvpBig.show{
      display:block;
      animation: pvpPop 220ms ease-out both;
    }
    #pvpBig img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      border-radius:999px;
      filter:saturate(1.05) contrast(1.02);
      transform: scale(1.02);
      transform-origin:center;
    }
    #pvpBig::after{
      content:"";
      position:absolute; inset:0;
      border-radius:999px;
      box-shadow: inset 0 0 0 2px rgba(0,94,184,.08), inset 0 0 26px rgba(0,94,184,.06);
      pointer-events:none;
    }

    /* PVP í•˜ë‹¨ ì„¤ëª… (ê³ ê¸‰ ë¶„ë¦¬) */
    #pvpOverlay{
      position:fixed; left:12px; right:12px; bottom:92px; z-index:60;
      background: var(--panel-grad);
      border:1px solid var(--panel-stroke);
      border-radius:14px;
      padding:10px 10px;
      display:none;
      gap:10px;
      align-items:center;
      backdrop-filter: blur(12px);
      box-shadow: var(--panel-glow);
      overflow:hidden;
    }
    #pvpOverlay::before{
      content:"";
      position:absolute;
      left:0; right:0; top:0;
      height:2px;
      background: var(--panel-topline);
      opacity:.95;
      pointer-events:none;
    }
    #pvpOverlay::after{
      content:"";
      position:absolute; inset:0;
      border-radius:14px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.45);
      pointer-events:none;
      opacity:.55;
    }

    #pvpOverlay.show{ display:flex; }
    #pvpOverlay img{
      width:88px;height:88px;object-fit:cover;border-radius:12px;
      border:1px solid var(--panel-stroke-2);
      background:rgba(0,94,184,.03);
      box-shadow: 0 10px 18px rgba(11,31,51,.10);
    }
    #pvpText{color:var(--text-sub);font-size:12.5px;line-height:1.35; flex:1 1 auto;}
    #pvpTitle{font-weight:900;margin-bottom:2px;color:var(--text-navy);}
    #hint{opacity:.9;color:var(--text-sub);}

    #pvpConfirm{
      color:#ffffff;
      font-weight:900;
      opacity:1;
      cursor:pointer;
      user-select:none;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid rgba(0,94,184,.65);
      background:var(--acuvue-blue);
      backdrop-filter: blur(8px);
      -webkit-tap-highlight-color: transparent;
      flex:0 0 auto;
      white-space:nowrap;
      display:none;
      box-shadow: 0 10px 22px rgba(0,94,184,.22);
    }
    #pvpConfirm:active{ transform:scale(.98); }

    /* ë‘ê»˜ ê·¸ë˜í”„(ê°€ë¡œí˜•) (ê³ ê¸‰ ë¶„ë¦¬) */
    #thicknessBar{
      position:fixed;
      left:12px;
      right:12px;
      bottom:92px;
      z-index:67;
      display:none;
      border-radius:14px;
      border:1px solid var(--panel-stroke);
      background: var(--panel-grad);
      backdrop-filter: blur(12px);
      padding:10px 12px 12px;
      box-sizing:border-box;
      box-shadow: var(--panel-glow);
      overflow:hidden;
    }
    #thicknessBar::before{
      content:"";
      position:absolute;
      left:0; right:0; top:0;
      height:2px;
      background: var(--panel-topline);
      opacity:.95;
      pointer-events:none;
    }
    #thicknessBar::after{
      content:"";
      position:absolute; inset:0;
      border-radius:14px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.45);
      pointer-events:none;
      opacity:.55;
    }
    #thicknessBar.show{ display:block; }

    #thHeader{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      margin-bottom:8px;
    }
    #thTitle{
      color:var(--text-navy);
      font-weight:900;
      font-size:12.5px;
      letter-spacing:.2px;
      opacity:.98;
    }
    #thUnit{
      color:rgba(48,72,95,.85);
      font-size:11px;
      font-weight:700;
      letter-spacing:.1px;
    }

    #gradRow{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .tickLabel{
      width:46px;
      text-align:right;
      color:rgba(48,72,95,.86);
      font-size:11px;
      font-weight:700;
      letter-spacing:.1px;
      flex:0 0 auto;
    }

    #gradWrap{
      position:relative;
      flex:1 1 auto;
      height:14px;
      border-radius:999px;
      overflow:hidden;
      border:1px solid rgba(11,31,51,.12);
      background:rgba(0,94,184,.03);
      box-shadow: inset 0 0 12px rgba(11,31,51,.10);
    }

    #grad{
      position:absolute; inset:0;
      background:linear-gradient(90deg,
        rgba(140,  0,255,1) 0%,
        rgba(  0, 90,255,1) 17%,
        rgba(  0,200,255,1) 32%,
        rgba(  0,255,150,1) 48%,
        rgba(150,255,  0,1) 64%,
        rgba(255,220,  0,1) 78%,
        rgba(255,120,  0,1) 90%,
        rgba(255, 50, 50,1) 100%
      );
      opacity:.92;
      filter:saturate(1.05) contrast(1.05);
    }

    #gradShine{
      position:absolute; inset:0;
      background:linear-gradient(180deg,
        rgba(255,255,255,.30) 0%,
        rgba(255,255,255,0) 55%,
        rgba(11,31,51,.10) 100%
      );
      mix-blend-mode: overlay;
      opacity:.55;
      pointer-events:none;
    }

    .mark{
      position:absolute;
      top:-6px;
      width:1px;
      height:26px;
      background:rgba(11,31,51,.18);
    }
    .mark strong{
      position:absolute;
      top:18px;
      left:50%;
      transform:translateX(-50%);
      font-size:10px;
      color:rgba(48,72,95,.80);
      font-weight:700;
      white-space:nowrap;
    }
    .m0{ left:0%; }
    .m25{ left:25%; }
    .m50{ left:50%; }
    .m75{ left:75%; }
    .m100{ left:100%; }

    #thHint{ display:none; }
  
    /* =========================
       âœ… ASD Tutorial (Auto) + Key Message Popup
       - ê¸°ì¡´ ë¡œì§/ìŠ¤íƒ€ì¼ ìµœëŒ€í•œ ìœ ì§€, ì¶”ê°€ ìš”ì†Œë§Œ
       ========================= */
    #tutorialLayer{
      position:fixed; inset:0; z-index:95;
      display:none;
      background:rgba(8,22,37,.45);
      backdrop-filter: blur(3px);
    }
    #tutorialLayer.show{display:block;}
    .tutBox{
      position:absolute;
      width:min(320px, 84vw);
      background:#0B5C8A;
      color:#fff;
      border-radius:16px;
      padding:14px 14px 12px;
      box-shadow:0 18px 60px rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.18);
    }
    .tutBox .tutTitle{font-weight:800; margin-bottom:8px; font-size:16px;}
    .tutBox .tutText{line-height:1.35; font-size:14px; opacity:.95;}
    .tutBox .tutBtn{
      margin-top:12px;
      width:100%;
      height:42px;
      border-radius:12px;
      border:2px solid rgba(0,0,0,.35);
      background:rgba(255,255,255,.14);
      color:#fff;
      font-weight:800;
      cursor:pointer;
    }
    /* step positions */
    #tutLeft{left:14px; top:42%; transform:translateY(-50%);}
    #tutBottom{left:50%; bottom:112px; transform:translateX(-50%);}
    #tutTop{left:50%; top:96px; transform:translateX(-50%);}

    /* Key message popup (ì¹´ë“œ í´ë¦­ ì‹œ ë¨¼ì €) */
    #asdKeyMsgLayer{
      position:fixed; inset:0; z-index:96;
      display:none;
      background:rgba(8,22,37,.45);
      backdrop-filter: blur(3px);
    }
    #asdKeyMsgLayer.show{display:block;}
    #asdKeyMsgCard{
      position:absolute;
      left:16px; top:50%;
      transform:translateY(-50%);
      width:min(320px, 84vw);
      background:#0B5C8A;
      color:#fff;
      border-radius:22px;
      padding:18px 16px 14px;
      box-shadow:0 18px 60px rgba(0,0,0,.28);
      border:1px solid rgba(255,255,255,.18);
    }
    #asdKeyMsgCard .kmTitle{font-weight:900; font-size:18px; margin-bottom:10px;}
    #asdKeyMsgCard .kmText{font-size:14px; line-height:1.4; opacity:.95;}
    #asdKeyMsgCard .kmBtn{
      margin-top:14px;
      width:100%;
      height:44px;
      border-radius:14px;
      border:2px solid rgba(0,0,0,.35);
      background:rgba(255,255,255,.14);
      color:#fff;
      font-weight:900;
      cursor:pointer;
    }


    /* =========================
       âœ… [NEW] íŠœí† ë¦¬ì–¼ ê°€ì´ë“œ (ë„¤ì´ë²„ ëŠë‚Œ + ACUVUE ì»¬ëŸ¬)
       - ìˆœì„œ: ë Œì¦ˆì¡°ì‘ â†’ í•˜ë‹¨ë²„íŠ¼ â†’ ë¯¸ì…˜ì¹´ë“œ
       ========================= */
    #tutorialOverlay{
      position:fixed; inset:0;
      z-index:140;
      display:none;
      background:rgba(11,31,51,.22);
      backdrop-filter: blur(6px);
      pointer-events:auto;
    }
    #tutorialOverlay.show{ display:block; }

    #tutorialHighlight{
      position:fixed;
      z-index:141;
      border-radius:22px;
      box-shadow: 0 0 0 9999px rgba(11,31,51,.28);
      border:1px solid rgba(0,94,184,.30);
      background:rgba(255,255,255,.08);
      pointer-events:none;
    }

    #tutorialArrow{
      position:fixed;
      inset:0;
      z-index:142;
      pointer-events:none;
    }
    #tutorialArrowPath{ filter: drop-shadow(0 10px 20px rgba(0,94,184,.18)); }

    #tutorialHand{
      position:fixed;
      z-index:143;
      width:46px; height:46px;
      border-radius:999px;
      display:flex; align-items:center; justify-content:center;
      background:rgba(255,255,255,.92);
      border:1px solid rgba(0,94,184,.28);
      box-shadow: 0 12px 22px rgba(11,31,51,.16);
      font-size:22px;
      pointer-events:none;
      transform: translate(-50%,-50%);
      opacity:0;
    }

    #tutorialBubble{
      position:fixed;
      z-index:144;
      width:min(560px, 92vw);
      border-radius:18px;
      border:1px solid rgba(0,94,184,.22);
      background: rgba(255,255,255,.92);
      box-shadow: 0 18px 60px rgba(11,31,51,.18);
      overflow:hidden;
      backdrop-filter: blur(14px);
    }

    #tutorialClose{
      position:absolute; right:10px; top:10px;
      width:34px; height:34px;
      border-radius:999px;
      border:1px solid rgba(11,31,51,.10);
      background:rgba(255,255,255,.92);
      color:var(--text-navy);
      font-weight:900;
      -webkit-tap-highlight-color: transparent;
      cursor:pointer;
    }

    #tutorialBubbleHead{
      padding:12px 14px;
      background: linear-gradient(180deg, rgba(0,94,184,.10) 0%, rgba(234,243,255,.72) 100%);
      border-bottom:1px solid rgba(11,31,51,.10);
      font-weight:900;
      font-size:13.5px;
      color:var(--text-navy);
      display:flex;
      align-items:center;
      gap:10px;
    }
    #tutorialGift{
      margin-left:auto;
      font-size:12px;
      font-weight:900;
      padding:5px 9px;
      border-radius:999px;
      background:rgba(0,94,184,.10);
      border:1px solid rgba(0,94,184,.28);
      color:var(--acuvue-blue);
      white-space:nowrap;
    }

    #tutorialBubbleBody{
      padding:14px 14px 12px;
      color:var(--text-sub);
      font-size:13px;
      line-height:1.45;
      white-space:pre-line;
    }

    #tutorialBubbleFoot{
      padding:12px 14px;
      border-top:1px solid rgba(11,31,51,.10);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      background:linear-gradient(180deg, rgba(255,255,255,.85) 0%, rgba(245,249,255,.78) 100%);
    }

    #tutorialDots{
      display:flex;
      gap:6px;
      align-items:center;
    }
    #tutorialDots .dot{
      width:8px; height:8px;
      border-radius:999px;
      background:rgba(48,72,95,.20);
      border:1px solid rgba(48,72,95,.12);
      box-sizing:border-box;
    }
    #tutorialDots .dot.on{
      background:var(--acuvue-blue);
      border-color:rgba(0,94,184,.45);
      box-shadow: 0 8px 18px rgba(0,94,184,.22);
    }

    #tutorialNext{
      border:1px solid rgba(0,94,184,.65);
      background:var(--acuvue-blue);
      color:#fff;
      font-weight:900;
      font-size:12.8px;
      padding:9px 14px;
      border-radius:12px;
      -webkit-tap-highlight-color: transparent;
      cursor:pointer;
      box-shadow: 0 10px 22px rgba(0,94,184,.22);
      white-space:nowrap;
    }
    #tutorialNext:active{ transform:scale(.98); }

  </style>
</head>

<body>
  <!-- âœ… ë¯¸ì…˜ ì¹´ë“œ -->
  <div id="missionBar">
    <div id="missionASD" class="missionCard" role="button" tabindex="0" aria-label="ASD ì¶•ì•ˆì •í™” ë³´ê¸°">
      <div class="missionNo">01</div>
      <div class="missionTitle">ASD ì¶•ì•ˆì •í™”</div>
      <div class="missionDesc">ì¹´ë“œë¥¼ ëˆŒëŸ¬ í™•ì¸</div>
    </div>
    <div id="missionPVP" class="missionCard" role="button" tabindex="0" aria-label="PVP ë³´ê¸°">
      <div class="missionNo">02</div>
      <div class="missionTitle">ASD í¸ì•ˆí•œ ì‹œì•¼</div>
      <div class="missionDesc">ì¹´ë“œë¥¼ ëˆŒëŸ¬ í™•ì¸</div>
    </div>
    <div id="missionBlue" class="missionCard" role="button" tabindex="0" aria-label="ì˜µí‹°ë¸”ë£¨ ë³´ê¸°">
      <div class="missionNo">03</div>
      <div class="missionTitle">ASD ì°©ìš©ê°</div>
      <div class="missionDesc">ì¹´ë“œë¥¼ ëˆŒëŸ¬ í™•ì¸</div>
    </div>
  </div>

  <!-- âœ… OFFì¼ ë•Œ ë Œì¦ˆ ë’¤ìª½ ê·¸ë¼ë°ì´ì…˜ ë²ˆì§ -->
  <div id="blueBackGlow" aria-hidden="true"></div>

  <!-- âœ… ê´‘ì„  ë ˆì´ì–´ -->

  <!-- âœ… ì¶œì‚¬ê´‘(beamOut) ì „ìš©: ë Œì¦ˆ ë’¤(ë’¤ ë ˆì´ì–´) -->
  <div id="blueRayLayerBack" aria-hidden="true">
    <svg id="blueRaySvgBack" viewBox="0 0 100 100" preserveAspectRatio="none">
      <defs>
        <linearGradient id="beamOutGradBack" x1="0" y1="0" x2="1" y2="0">
          <stop offset="0"    stop-color="rgb(255,191,0)" stop-opacity="0.22"></stop>
          <stop offset="0.35" stop-color="rgb(255,191,0)" stop-opacity="1"></stop>
          <stop offset="0.75" stop-color="rgb(255,191,0)" stop-opacity="0.50"></stop>
          <stop offset="1"    stop-color="rgb(255,191,0)" stop-opacity="0"></stop>
        </linearGradient>
        <filter id="beamGlowBack" x="-50%" y="-50%" width="200%" height="200%">
          <feGaussianBlur stdDeviation="0.9" result="blur"/>
          <feMerge>
            <feMergeNode in="blur"/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>
      </defs>

      <line id="beamOutBack" x1="50" y1="50" x2="100" y2="50"
            stroke="url(#beamOutGradBack)"
            stroke-width="3.00"
            stroke-linecap="round"
            filter="url(#beamGlowBack)"
            opacity="0.0"></line>
    </svg>
  </div>

<div id="blueRayLayer" aria-hidden="true">
  <svg id="blueRaySvg" viewBox="0 0 100 100" preserveAspectRatio="none">
    <defs>

      <!-- ğŸ”¶ beamIn : ì§„ë…¸ë‘ -->
      <linearGradient id="beamInGrad" x1="0" y1="0" x2="1" y2="0">
        <stop offset="0"    stop-color="rgb(255,170,0)" stop-opacity="0"></stop>
        <stop offset="0.28" stop-color="rgb(255,170,0)" stop-opacity="0.55"></stop>
        <stop offset="0.55" stop-color="rgb(255,170,0)" stop-opacity="1"></stop>
        <stop offset="1"    stop-color="rgb(255,170,0)" stop-opacity="0.18"></stop>
      </linearGradient>

      <!-- ğŸ”¶ beamOut : ë…¸ë‘(ì—°) -->
      <linearGradient id="beamOutGrad" x1="0" y1="0" x2="1" y2="0">
        <stop offset="0"    stop-color="rgb(255,205,70)" stop-opacity="0.10"></stop>
        <stop offset="0.30" stop-color="rgb(255,205,70)" stop-opacity="0.75"></stop>
        <stop offset="0.55" stop-color="rgb(255,205,70)" stop-opacity="1"></stop>
        <stop offset="1"    stop-color="rgb(255,205,70)" stop-opacity="0"></stop>
      </linearGradient>

      <!-- âœ… beamBend(ë°˜ì‚¬ê´‘) : íŒŒë€ìƒ‰ ìœ ì§€ -->
      <linearGradient id="beamReflectGrad" x1="0" y1="0" x2="1" y2="0">
        <stop offset="0"    stop-color="rgb(0,94,184)" stop-opacity="0.15"></stop>
        <stop offset="0.30" stop-color="rgb(0,94,184)" stop-opacity="0.80"></stop>
        <stop offset="0.55" stop-color="rgb(0,94,184)" stop-opacity="1"></stop>
        <stop offset="1"    stop-color="rgb(0,94,184)" stop-opacity="0"></stop>
      </linearGradient>

      <filter id="beamGlow" x="-60%" y="-60%" width="220%" height="220%">
        <feGaussianBlur stdDeviation="1.15" result="blur"/>
        <feMerge>
          <feMergeNode in="blur"/>
          <feMergeNode in="SourceGraphic"/>
        </feMerge>
      </filter>

      <!-- âœ… ì‘ì€ '->' ëŠë‚Œ í™”ì‚´í‘œ (ì¶œì‚¬ê´‘/ë°˜ì‚¬ê´‘) -->
      <marker id="beamArrowBlueSmall" viewBox="0 0 12 10" refX="10.2" refY="5"
              markerWidth="0.9" markerHeight="0.9" orient="auto">
        <path d="M 0 1 L 11 5 L 0 9"
              fill="none"
              stroke="rgb(0,94,184)"
              stroke-width="2.0"
              stroke-linecap="round"
              stroke-linejoin="round"
              opacity="0.95"></path>
      </marker>

      <marker id="beamArrowYellowSmall" viewBox="0 0 12 10" refX="10.2" refY="5"
              markerWidth="0.9" markerHeight="0.9" orient="auto">
        <path d="M 0 1 L 11 5 L 0 9"
              fill="none"
              stroke="rgb(255,190,40)"
              stroke-width="2.0"
              stroke-linecap="round"
              stroke-linejoin="round"
              opacity="0.95"></path>
      </marker>

      <!-- âœ… ë Œì¦ˆë¥¼ ì§€ë‚˜ëŠ” êµ¬ê°„(ì¶œì‚¬ê´‘) ê°€ë¦¬ê¸°ìš© ë§ˆìŠ¤í¬ -->
      <mask id="lensOccludeMask">
        <rect x="0" y="0" width="100" height="100" fill="white"></rect>
        <!-- JSì—ì„œ ìœ„ì¹˜/í¬ê¸° ê°±ì‹  -->
        <ellipse id="lensOccludeEllipse" cx="56" cy="52" rx="26" ry="30" fill="black"></ellipse>
      </mask>

    </defs>

    <line id="beamIn" x1="0" y1="50" x2="50" y2="50"
          stroke="url(#beamInGrad)"
          stroke-width="3.4"
          stroke-linecap="round"
          filter="url(#beamGlow)"
          opacity="0.0"></line>

    <line id="beamOutFront" x1="50" y1="50" x2="100" y2="50"
          stroke="url(#beamOutGrad)"
          stroke-width="3.4"
          stroke-linecap="round"
          marker-end="url(#beamArrowYellowSmall)"
          mask="url(#lensOccludeMask)"
          filter="url(#beamGlow)"
          opacity="0.0"></line>

    <line id="beamBend" x1="50" y1="50" x2="25" y2="70"
          stroke="url(#beamReflectGrad)"
          stroke-width="3.6"
          stroke-linecap="round"
          marker-end="url(#beamArrowBlueSmall)"
          filter="url(#beamGlow)"
          opacity="0.0"></line>

    <circle id="beamHit"
            cx="50"
            cy="50"
            r="1.6"
            fill="rgb(255,255,255)"
            fill-opacity="0.80"
            filter="url(#beamGlow)"
            opacity="0.0"></circle>

  </svg>
</div>

  <!-- âœ… ì¶œì‚¬ê´‘(beamOut) ì „ìš©: ë Œì¦ˆ ë’¤ ë ˆì´ì–´ -->
  <div id="blueRayBehind" aria-hidden="true">
    <svg id="blueRaySvgBack" viewBox="0 0 100 100" preserveAspectRatio="none">
      <line id="beamOutFront" x1="50" y1="50" x2="100" y2="50"
            stroke="url(#beamOutGrad)"
            stroke-width="2.00"
            stroke-linecap="round"
            filter="url(#beamGlow)"
            opacity="0.0"></line>
    </svg>
  </div>



  <div id="bluePill" aria-label="ë¸”ë£¨ë¼ì´íŠ¸ ì°¨ë‹¨ ì„ íƒ">
    <div id="blueSegOn" class="blueSegBtn">ë¸”ë£¨ë¼ì´íŠ¸ ì°¨ë‹¨ ON</div>
    <div id="blueSegOff" class="blueSegBtn">OFF</div>
  </div>

  <div id="blueInfo" aria-hidden="true">
    <div id="blueInfoTop">
      <b>ë¸”ë£¨ë¼ì´íŠ¸ <span class="pct">55%</span> ì°¨ë‹¨</b>
    </div>
    <div id="blueInfoBody">
      ì•„íë¸Œ MAXëŠ”,
      ë¸”ë£¨ë¼ì´íŠ¸ë¥¼ 55% ì°¨ë‹¨í•˜ì—¬ ë””ì§€í„¸ì— ë…¸ì¶œëœ ëˆˆì„ ë³´í˜¸í•©ë‹ˆë‹¤.
      ë¸”ë£¨ë¼ì´íŠ¸ ì°¨ë‹¨ì„ ìœ„í•œ "ë¸”ë£¨ ê·¸ë¦° í‹´íŠ¸"ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.
    </div>
    <div id="blueInfoMission">
      <div class="left" id="blueMissionText">ë¯¸ì…˜: "ë¸”ë£¨ë¼ì´íŠ¸ ì°¨ë‹¨ on" ë²„íŠ¼ì„ ëˆŒëŸ¬ ì°¨ì´ë¥¼ ë¹„êµí•´ ë³´ì„¸ìš”</div>
      <div class="confirm" id="blueMissionConfirm">í™•ì¸</div>
    </div>
  </div>

  <div id="thicknessBar" aria-hidden="true">
    <div id="thHeader">
      <div id="thTitle">ë‘ê»˜</div>
      <div id="thUnit">mm</div>
    </div>
    <div id="gradRow">
      <div class="tickLabel">ì–‡ìŒ_0.0</div>
      <div id="gradWrap">
        <div id="grad"></div>
        <div id="gradShine"></div>
        <div class="mark m0"><strong>0.0</strong></div>
        <div class="mark m25"><strong>0.1</strong></div>
        <div class="mark m50"><strong>0.2</strong></div>
        <div class="mark m75"><strong>0.3</strong></div>
        <div class="mark m100"><strong>0.4</strong></div>
      </div>
      <div class="tickLabel" style="text-align:left;width:46px;">0.4_ë‘ê»</div>
    </div>
    <div id="thHint"></div>
  </div>

  <div id="pvpBig">
    <img id="pvpBigImg" src="PVP.gif" alt="PVP Big" onerror="this.onerror=null; this.src='PVP.jpeg';">
  </div>

  <div id="pvpOverlay">
    <img id="pvpThumb" src="PVP.png" alt="PVP" onerror="this.onerror=null; this.src='PVP.jpeg';">
    <div id="pvpText">
      <div id="pvpTitle">PVP ìŠµìœ¤ ì¸ì</div>
      <div id="hint">ë Œì¦ˆ ë‚´ PVP ìŠµìœ¤ì¸ìê°€ ìˆ˜ë¶„ì„ ë” ì˜¤ë«ë™ì•ˆ ëˆˆë¬¼ë§‰ ìœ ì§€í•˜ì—¬ ê±´ì¡°ê°ì„ ê°ì†Œ ì‹œí‚µë‹ˆë‹¤.</div>
    </div>
    <div id="pvpConfirm" role="button" tabindex="0" aria-label="í™•ì¸">í™•ì¸</div>
  </div>

  <div id="asdOverlay" aria-hidden="true">
    <div id="asdCard">
      <button id="asdClose" type="button" aria-label="ë‹«ê¸°">âœ•</button>
      <div id="asdScene">
        <img id="asdEyeMV" src="a.png" alt="Eye background" onerror="this.onerror=null; this.src='a.gif';">
        <div id="asdLensRim" aria-hidden="true"></div>
        <img id="asdLensImg" src="lens.png" alt="Lens overlay"
             onerror="this.style.display='none'; document.getElementById('asdHint').textContent='lens.png / lens2.png íŒŒì¼ì„ ê°™ì€ í´ë”ì— ë„£ì–´ì£¼ì„¸ìš”.';">
        <div id="asdMaskShade" aria-hidden="true"></div>
                <img id="asdUpperLid" src="upper_lid.png" alt="Upper eyelid overlay" onerror="this.style.display='none';">

        <div id="asdBlinkLid" aria-hidden="true">
          <div id="asdLidTop"></div>
          <div id="asdLidBot"></div>
        </div>

        <div id="asdAngleBadge">20Â°</div>
        <button id="asdRotateBtn" type="button" aria-label="íšŒì „">ì¶•ì´íƒˆ</button>
        <button id="asdBlinkBtn" type="button" aria-label="ëˆˆ ê¹œë°•">ê¹œë°•ì„</button>
      </div>
      <div id="asdHint">ë¯¸ì…˜1. â€˜ê¹œë°•ì„â€™ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì´íƒˆëœ ì¶•ì„ ì•ˆì •í™” ì‹œì¼œ ë³´ì„¸ìš”</div>
    </div>
  </div>

  
  <!-- âœ… [NEW] ìë™ ê°€ì´ë“œ(ë„¤ì´ë²„ íŠœí† ë¦¬ì–¼ ëŠë‚Œ / ACUVUE ì»¬ëŸ¬) -->
  <div id="tutorialOverlay" aria-hidden="true">
    <div id="tutorialHighlight" aria-hidden="true"></div>

    <svg id="tutorialArrow" viewBox="0 0 100 100" preserveAspectRatio="none" aria-hidden="true">
      <defs>
        <marker id="tutArrowHead" viewBox="0 0 10 10" refX="8.5" refY="5"
                markerWidth="6" markerHeight="6" orient="auto">
          <path d="M 0 0 L 10 5 L 0 10" fill="none" stroke="var(--acuvue-blue)" stroke-width="2.2"
                stroke-linecap="round" stroke-linejoin="round"></path>
        </marker>
      </defs>
      <path id="tutorialArrowPath" d="M10,10 Q50,50 90,90" fill="none" stroke="var(--acuvue-blue)"
            stroke-width="2.6" stroke-linecap="round" stroke-linejoin="round" marker-end="url(#tutArrowHead)"
            opacity="0.0"></path>
    </svg>

    <div id="tutorialHand" aria-hidden="true">ğŸ‘†</div>

    <div id="tutorialBubble" role="dialog" aria-label="ê°€ì´ë“œ">
      <button id="tutorialClose" type="button" aria-label="ë‹«ê¸°">âœ•</button>
      <div id="tutorialBubbleHead">
        <span id="tutorialTitle">ê°€ì´ë“œ</span>
        <span id="tutorialGift" style="display:none;">ğŸ ê¸°í”„í‹°ì½˜</span>
      </div>
      <div id="tutorialBubbleBody"></div>
      <div id="tutorialBubbleFoot">
        <div id="tutorialDots" aria-hidden="true">
          <span class="dot"></span><span class="dot"></span><span class="dot"></span>
        </div>
        <button id="tutorialNext" type="button" aria-label="í™•ì¸">í™•ì¸</button>
      </div>
    </div>
  </div>

<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <script nomodule src="https://unpkg.com/@google/model-viewer/dist/model-viewer-legacy.js"></script>

  <model-viewer
    id="mv"
    src="lens_clear.glb"
    camera-controls
    camera-orbit="0deg 100deg 2.6m"
    camera-target="0m 0.015m 0m"
    touch-action="pan-y"
    exposure="1.35"
    tone-mapping="aces"
    environment-image="neutral"
    shadow-intensity="0"
    style="display:block;">
  </model-viewer>

  <div id="bottomBtns">
    <button id="btnReset" title="ì²˜ìŒ ìœ„ì¹˜ë¡œ">â†º</button>
    <button id="modeLens" class="btn primary">íˆ¬ëª… ë Œì¦ˆ ëª¨ë“œ</button>
    <button id="modeHeat" class="btn">ë Œì¦ˆ ë‘ê»˜ MAP</button>
  </div>

  <script>
    const mv = document.getElementById('mv');

    /* =========================
       âœ… í„°ì¹˜í•˜ë©´ ë©ˆì¶”ëŠ” í˜„ìƒ ë°©ì§€ (ì´ ë¸”ë¡ë§Œ ì¶”ê°€)
       - iOS/ì¼ë¶€ ë¸Œë¼ìš°ì €ì—ì„œ GLB ì• ë‹ˆë©”ì´ì…˜/ë Œë”ê°€ í„°ì¹˜ í›„ pause ë˜ëŠ” ì¼€ì´ìŠ¤ ëŒ€ì‘
       - ë‹¤ë¥¸ ë¡œì§/êµ¬ì¡°ëŠ” ë³€ê²½í•˜ì§€ ì•ŠìŒ
       ========================= */
    function keepMVPlaying(){
      try{
        if(!mv) return;
        if(mv.paused) mv.play();
      }catch(e){}
    }
    if(mv){
      ['pointerdown','pointermove','pointerup','touchstart','touchend','mousedown','mouseup'].forEach((ev)=>{
        try{ mv.addEventListener(ev, keepMVPlaying, { passive:true }); }catch(e){}
      });
    }
    document.addEventListener('visibilitychange', ()=>{
      if(!document.hidden) setTimeout(keepMVPlaying, 60);
    });
    /* ========================= */

    const missionASD  = document.getElementById('missionASD');
    const missionPVP  = document.getElementById('missionPVP');
    const missionBlue = document.getElementById('missionBlue');

    const modeLens = document.getElementById('modeLens');
    const modeHeat = document.getElementById('modeHeat');

    const btnReset = document.getElementById('btnReset');

    const asdOverlay = document.getElementById('asdOverlay');
    const asdClose   = document.getElementById('asdClose');

    const pvpOverlay = document.getElementById('pvpOverlay');
    const pvpBig     = document.getElementById('pvpBig');
    const pvpConfirm = document.getElementById('pvpConfirm');

    const thicknessBar = document.getElementById('thicknessBar');

    const bluePill = document.getElementById('bluePill');
    const blueSegOn  = document.getElementById('blueSegOn');
    const blueSegOff = document.getElementById('blueSegOff');
    const blueRayLayer = document.getElementById('blueRayLayer');
    const blueRayLayerBack = document.getElementById('blueRayLayerBack');
    const blueRayBehind = document.getElementById('blueRayBehind');
    const blueBackGlow = document.getElementById('blueBackGlow');
    const blueInfo = document.getElementById('blueInfo');
    const blueMissionText = document.getElementById('blueMissionText');
    const blueMissionConfirm = document.getElementById('blueMissionConfirm');

    const beamIn  = document.getElementById('beamIn');
    const beamOut = document.getElementById('beamOutBack');
    const beamOutFront = document.getElementById('beamOutFront');
    const beamBend = document.getElementById('beamBend');
    const beamHit = document.getElementById('beamHit');

    const lensOccludeEllipse = document.getElementById('lensOccludeEllipse');


    /* =========================
       âœ… [ì¶”ê°€] iOS Safariì—ì„œ SVG gradient/filter ë¼ì¸ì´ 'ì•ˆ ë³´ì´ëŠ”' ì¼€ì´ìŠ¤ ìµœí›„ ë°©ì–´
       - ë¡œì§ì€ ê·¸ëŒ€ë¡œ, ë Œë”ë§ ë¬¸ì œì¼ ë•Œë§Œ 'ë Œë” ì¹œí™”' ì†ì„±ìœ¼ë¡œ ë³´ì •
       ========================= */
    const __isIOS = (()=> {
      const ua = navigator.userAgent || '';
      const platform = navigator.platform || '';
      const iOS = /iP(hone|od|ad)/.test(platform);
      const iPadOS13Plus = (platform === 'MacIntel' && navigator.maxTouchPoints > 1);
      return iOS || iPadOS13Plus;
    })();
    const __isSafari = /^((?!chrome|crios|android).)*safari/i.test(navigator.userAgent || '');
    const __isSafariIOS = __isIOS && __isSafari;

    function __forceSvgRedraw(){
      try{
        const layer = document.getElementById('blueRayLayer');
        const svg = document.getElementById('blueRaySvg');
        if(!layer || !svg) return;

        // display:none -> block ì „í™˜ ì§í›„ Safariê°€ paintë¥¼ ìŠ¤í‚µí•˜ëŠ” ì¼€ì´ìŠ¤ ë°©ì§€
        svg.style.transform = 'translateZ(0)';
        const prev = svg.style.display || 'block';
        svg.style.display = 'none';
        // ê°•ì œ reflow
        void svg.getBoundingClientRect();
        svg.style.display = prev;

        // line bbox ê³„ì‚° ê°•ì œ (ì¼ë¶€ Safariì—ì„œ íš¨ê³¼ ìˆìŒ)
        try{ svg.getBBox(); }catch(e){}
      }catch(e){}
    }

    function __patchBeamsForSafari(){
      if(!__isSafariIOS) return;
      // gradient + filter ì¡°í•©ì´ ì•ˆ ë³´ì´ëŠ” ì¼€ì´ìŠ¤ê°€ ìˆì–´, beamIn/Outë§Œ ìµœì†Œ ë³´ì •
      [beamIn, beamOut].forEach(el=>{
        if(!el) return;
        try{ el.setAttribute('filter','none'); }catch(e){}
        try{ el.style.filter = 'none'; }catch(e){}
        // gradientê°€ paintë¥¼ ëª»í•  ë•Œë¥¼ ëŒ€ë¹„í•œ fallback: solid stroke
        try{ el.setAttribute('stroke','rgb(255,191,0)'); }catch(e){}
        try{ el.style.stroke = 'rgb(255,191,0)'; }catch(e){}
        try{ el.setAttribute('shape-rendering','geometricPrecision'); }catch(e){}
        try{ el.setAttribute('vector-effect','non-scaling-stroke'); }catch(e){}
      });
      [beamBend].forEach(el=>{
        if(!el) return;
        try{ el.setAttribute('shape-rendering','geometricPrecision'); }catch(e){}
        try{ el.setAttribute('vector-effect','non-scaling-stroke'); }catch(e){}
      });
    }
    /* ========================= */


    const asdEyeMV = document.getElementById('asdEyeMV');
    const asdLensImg = document.getElementById('asdLensImg');
    const asdBlinkBtn = document.getElementById('asdBlinkBtn');
    const asdRotateBtn = document.getElementById('asdRotateBtn');
    const asdAngleBadge = document.getElementById('asdAngleBadge');
    const asdLensRim = document.getElementById('asdLensRim');
    const asdHint = document.getElementById('asdHint');

    const asdLidTop = document.getElementById('asdLidTop');
    const asdLidBot = document.getElementById('asdLidBot');

    let currentMode = 'lens';
    let blueOn = false;
    let pvpOn = false;
    let pvpDone = false;
    let bluePanelOpen = false;

    let lastOrbit = null;
    let lastTarget = null;

    let defaultOrbit = null;
    let defaultTarget = null;
    let defaultFov = null;

    const BLUE_PANEL_ORBIT_STR  = '55deg 99deg 2.9m';
    const BLUE_PANEL_TARGET_STR = '0m -0.010m 0m';

    const BLUE_ORBIT_STR  = '-20deg 88deg 2.75m';
    const BLUE_TARGET_STR = '0m -0.010m 0m';

    const CLEAR_DEFAULT_ORBIT_STR  = '0deg 100deg 2.6m';
    const CLEAR_DEFAULT_TARGET_STR = '0m 0.015m 0m';

    const HEAT_DEFAULT_ORBIT_STR  = '0deg 100deg 2.6m';
    const HEAT_DEFAULT_TARGET_STR = '0m 0.015m 0m';

    let pendingCameraPreset = null;

    let orbitBeforeBlue = null;
    let targetBeforeBlue = null;

    const BLUEGREEN_TINT = [0.55, 1.08, 0.72, 0.45];
    let allMaterialBackup = null;

    const blueMission = {
      successShown: false,
      confirmed: false,
      sawOn: false,
      sawOff: false
    };

    let beamAnimToken = 0;
    let beamGeom = null;

    /* =========================
       âœ… ë¹” ì• ë‹ˆë©”ì´ì…˜(ëª¨ë°”ì¼/iOS ì•ˆì „)
       - stroke-dash ì‚¬ìš© ì—†ì´, ë¼ì¸ì„ "ê·¸ë ¤ì§€ëŠ”" ë°©ì‹ìœ¼ë¡œ ì• ë‹ˆë©”ì´ì…˜
       - OFF: ì…ì‚¬ê´‘ â†’ ì¶œì‚¬ê´‘ (ìˆœì°¨)
       - ON : ì…ì‚¬ê´‘ â†’ (ì¶œì‚¬ê´‘ + ë°˜ì‚¬ê´‘ ë™ì‹œ ë¶„ê¸°) + ì¤‘ì•™ íˆíŠ¸ ì 
       ========================= */
    function setLineFull(el, g){
      if(!el || !g) return;
      el.setAttribute('x1', g.x1); el.setAttribute('y1', g.y1);
      el.setAttribute('x2', g.x2); el.setAttribute('y2', g.y2);
    }
    function setLineProgress(el, g, t){
      if(!el || !g) return;
      const tt = Math.max(0, Math.min(1, t));
      const x2 = g.x1 + (g.x2 - g.x1) * tt;
      const y2 = g.y1 + (g.y2 - g.y1) * tt;
      el.setAttribute('x1', g.x1); el.setAttribute('y1', g.y1);
      el.setAttribute('x2', x2);   el.setAttribute('y2', y2);
    }
    function animateDraw(el, g, ms, delay=0, token=0){
      if(!el || !g) return;
      const startAt = performance.now() + delay;
      const endAt = startAt + ms;

      // ì‹œì‘ì€ ì•ˆê·¸ë ¤ì§„ ìƒíƒœ
      setLineProgress(el, g, 0);
      el.style.opacity = '';
      el.setAttribute('opacity', el.getAttribute('opacity') || '1');

      const tick = (now)=>{
        if(token !== beamAnimToken) return; // ì¤‘ê°„ì— ì·¨ì†Œëœ ê²½ìš°
        if(now < startAt){ requestAnimationFrame(tick); return; }
        const t = (now - startAt) / ms;
        if(t >= 1){
          setLineFull(el, g);
          return;
        }
        setLineProgress(el, g, t);
        requestAnimationFrame(tick);
      };
      requestAnimationFrame(tick);
    }

    function playBeamAnimation(){
      beamAnimToken++;
      const token = beamAnimToken;

      // ì¢Œí‘œ ìµœì‹ í™”
      if(!beamGeom) updateBeams();

      // ìƒíƒœë³„ ê¸°ë³¸ ê°€ì‹œì„±
      syncBeamVisibility();

      // OFF: ì…ì‚¬ â†’ ì¶œì‚¬
      if(!blueOn){
        beamHit.setAttribute('opacity','0');
        beamBend.setAttribute('opacity','0');

        // ì…ì‚¬ê´‘ ê·¸ë¦¬ê¸°
        animateDraw(beamIn, beamGeom?.in, 180, 0, token);
        // ì¶œì‚¬ê´‘ ê·¸ë¦¬ê¸°(ë’¤ìª½, ë Œì¦ˆ êµ¬ê°„ ë§ˆìŠ¤í¬)
        animateDraw(beamOut, beamGeom?.out, 220, 140, token);
        return;
      }

      // ON: ì…ì‚¬ â†’ (ì¶œì‚¬+ë°˜ì‚¬) ë™ì‹œ
      beamHit.setAttribute('opacity','0.92');

      animateDraw(beamIn, beamGeom?.in, 180, 0, token);
      animateDraw(beamOut, beamGeom?.out, 220, 120, token);
      animateDraw(beamBend, beamGeom?.bend, 220, 120, token);
    }
    /* ========================= */

    function setBlueUI(){
      const visible = (bluePanelOpen && currentMode === 'lens');

      bluePill.style.display = visible ? 'flex' : 'none';
      blueInfo.style.display = visible ? 'block' : 'none';
      blueInfo.setAttribute('aria-hidden', visible ? 'false' : 'true');

      blueRayLayer.style.display = visible ? 'block' : 'none';
      blueRayLayerBack.style.display = visible ? 'block' : 'none';
      if(blueRayBehind) blueRayBehind.style.display = visible ? 'block' : 'none';
      blueBackGlow.style.display = (visible && !blueOn) ? 'block' : 'none';

      blueSegOn.classList.toggle('on', blueOn === true);
      blueSegOff.classList.toggle('on', blueOn === false);

      if(blueMission.successShown && !blueMission.confirmed){
        blueMissionText.textContent = 'ë¯¸ì…˜ ì„±ê³µ: í™•ì¸ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”';
        blueMissionConfirm.style.display = 'block';
      }else{
        blueMissionText.textContent = 'ë¯¸ì…˜: "ë¸”ë£¨ë¼ì´íŠ¸ ì°¨ë‹¨ on" ë²„íŠ¼ì„ ëˆŒëŸ¬ ì°¨ì´ë¥¼ ë¹„êµí•´ ë³´ì„¸ìš”';
        blueMissionConfirm.style.display = 'none';
      }

      syncBeamVisibility();
      if(visible){
        __patchBeamsForSafari();
        __forceSvgRedraw();
        updateBeams();
        playBeamAnimation();
      }
    }

    function syncBeamVisibility(){
      const visible = (bluePanelOpen && currentMode === 'lens');
      if(!visible){
        beamIn.setAttribute('opacity','0');
        beamOut.setAttribute('opacity','0');
        if(beamOutFront) beamOutFront.setAttribute('opacity','0');
        beamBend.setAttribute('opacity','0');
        beamHit.setAttribute('opacity','0');
        return;
      }

      if(!blueOn){
        beamIn.setAttribute('opacity','0.95');
        beamOut.setAttribute('opacity','0.95');
        if(beamOutFront) beamOutFront.setAttribute('opacity','0');
        beamBend.setAttribute('opacity','0');
        beamHit.setAttribute('opacity','0');
        return;
      }

      beamIn.setAttribute('opacity','0.95');
      beamOut.setAttribute('opacity','0.50');
      if(beamOutFront) beamOutFront.setAttribute('opacity','0');
      beamBend.setAttribute('opacity','0.55');
      beamHit.setAttribute('opacity','0.90');
    }

 
function updateBeams(){
  const visible = (bluePanelOpen && currentMode === 'lens');
  if(!visible) return;

  const rect = mv.getBoundingClientRect();

  const toVw = (x)=> (x / window.innerWidth) * 100;
  const toVh = (y)=> (y / window.innerHeight) * 100;

  // âœ… iOS Safariì—ì„œ viewBox ë°–ìœ¼ë¡œ í¬ê²Œ ë‚˜ê°€ë©´ lineì´ í†µì§¸ë¡œ ì•ˆ ê·¸ë ¤ì§€ëŠ” ì¼€ì´ìŠ¤ ë°©ì§€
  const clamp = (v, min, max)=> Math.max(min, Math.min(max, v));

  // =========================
  // âœ… ë Œì¦ˆ ì¤‘ì‹¬(í™”ë©´ìƒ) ê³„ì‚°
  // - model-viewerì˜ bounding rect ë¹„ìœ¨ ê¸°ë°˜(ì¹´ë©”ë¼/íšŒì „/ë“œë˜ê·¸ì—ë„ ìì—°ìŠ¤ëŸ½ê²Œ ë”°ë¼ê°)
  // =========================
  const lensCx = clamp(toVw(rect.left + rect.width  * 0.35), 0, 100);
  const lensCy = clamp(toVh(rect.top  + rect.height * 0.35), 0, 100);
  const rx = clamp((rect.width  / window.innerWidth)  * 100 * 0.24, 8, 40);
  const ry = clamp((rect.height / window.innerHeight) * 100 * 0.28, 10, 45);

  // =========================
  // âœ… ì›í•˜ëŠ” ì…ì‚¬ê°: ìˆ˜í‰ ê¸°ì¤€ ì•½ 165Â° ëŠë‚Œ(=ì•½ 15Â° ê¸°ìš¸ê¸°)
  // - hit(í° ì ) ìœ„ì¹˜ë¥¼ ë Œì¦ˆ "í‘œë©´(íƒ€ì› ê²½ê³„)"ì— ê³ ì •
  // - ì…ì‚¬/ì¶œì‚¬/ë°˜ì‚¬ ëª¨ë‘ ì´ hitë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°
  // =========================
  const m = Math.tan((15 * Math.PI) / 180); // 15Â°

  // âœ… line: (lensCx, lensCy) ë¥¼ ì§€ë‚˜ë©° ê¸°ìš¸ê¸° m ì¸ ì§ì„ ê³¼
  //    ellipse: ((x-lensCx)/rx)^2 + ((y-lensCy)/ry)^2 = 1 ì˜ êµì 
  //    -> ì¢Œì¸¡(ì…ì‚¬) í‘œë©´ êµì ì„ hit ë¡œ ì‚¬ìš©
    // âœ… íˆíŠ¸ í¬ì¸íŠ¸ë¥¼ ë Œì¦ˆ ì¤‘ì‹¬(ì‹œê°ì  ì¤‘ì‹¬)ì— ê³ ì •
  // - ë Œì¦ˆ ì˜¤ë¹—/ì›€ì§ì„ì—ë„ í•­ìƒ ë Œì¦ˆ ì¤‘ì‹¬ì„ ê¸°ì¤€ìœ¼ë¡œ ë”°ë¼ì˜¤ë„ë¡
  const hx = lensCx;
  const hy = lensCy;

  // ì…ì‚¬ê´‘ ì‹œì‘ì (ì™¼ìª½ ê²½ê³„ x=0) : ê°™ì€ ì§ì„  ì—°ì¥
  const inX1 = 0;
  const inY1 = clamp(hy - (m * hx), 0, 100);

  // ì¶œì‚¬ê´‘ ëì (ì˜¤ë¥¸ìª½ ê²½ê³„ x=100) : ê°™ì€ ì§ì„  ì—°ì¥(êº¾ì„ ì—†ìŒ)
  const outX2 = 100;
  const outY2 = clamp(hy + (m * (outX2 - hx)), 0, 100);

  // -------------------------
  // âœ… ì…ì‚¬ê´‘(beamIn): (0,inY1) -> (hx,hy)
  // -------------------------
  beamIn.setAttribute('x1', inX1);
  beamIn.setAttribute('y1', inY1);
  beamIn.setAttribute('x2', hx);
  beamIn.setAttribute('y2', hy);

  // -------------------------
  // âœ… ì¶œì‚¬ê´‘(beamOut): (hx,hy) -> (100,outY2)  (êº¾ì„ ì—†ìŒ)
  // -------------------------
  beamOut.setAttribute('x1', hx);
  beamOut.setAttribute('y1', hy);
  beamOut.setAttribute('x2', outX2);
  beamOut.setAttribute('y2', outY2);

  // -------------------------
  // âœ… ë°˜ì‚¬ê´‘(beamBend): (hx,hy) -> ìœ„ë¡œ íŠ€ëŠ” ëª¨ìŠµ(íŒŒë€ìƒ‰)
  // - ê¸¸ì´ëŠ” ê¸°ì¡´ ë¹„ìœ¨ ìœ ì§€í•˜ë˜, ë Œì¦ˆ ì¤‘ì‹¬ ê¸°ì¤€ìœ¼ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ë”°ë¼ê°
  // -------------------------
  const bendX2 = clamp(hx - rx * 0.55, 0, 100);
  const bendY2 = clamp(hy - ry * 0.95, 18, 100);

  beamBend.setAttribute('x1', hx);
  beamBend.setAttribute('y1', hy);
  beamBend.setAttribute('x2', bendX2);
  beamBend.setAttribute('y2', bendY2);

  // ì¤‘ì•™ íˆíŠ¸ í¬ì¸íŠ¸(í° ì )
  beamHit.setAttribute('cx', hx);
  beamHit.setAttribute('cy', hy);

  // -------------------------
  // âœ… ì¶œì‚¬ê´‘ì´ ë Œì¦ˆë¥¼ "ì§€ë‚˜ëŠ” êµ¬ê°„"ì´ ì•ì—ì„œ ì•ˆë³´ì´ê²Œ: ë§ˆìŠ¤í¬(íƒ€ì›) ìœ„ì¹˜ ê°±ì‹ 
  // - ë Œì¦ˆ ì¤‘ì‹¬/í¬ê¸° ë™ì¼ ê°’ ì‚¬ìš©(ì¹´ë©”ë¼ ì›€ì§ì—¬ë„ í•¨ê»˜ ì¶”ì )
  // -------------------------
  if(lensOccludeEllipse){
    lensOccludeEllipse.setAttribute('cx', lensCx);
    lensOccludeEllipse.setAttribute('cy', lensCy);
    lensOccludeEllipse.setAttribute('rx', rx);
    lensOccludeEllipse.setAttribute('ry', ry);
  }

  // ì• ë‹ˆë©”ì´ì…˜ìš© ì¢Œí‘œ ì €ì¥
  beamGeom = {
    in:  { x1: inX1, y1: inY1, x2: hx,    y2: hy },
    out: { x1: hx,   y1: hy,   x2: outX2, y2: outY2 },
    bend:{ x1: hx,   y1: hy,   x2: bendX2,y2: bendY2 }
  };
}


mv.addEventListener('camera-change', ()=>{
      if(bluePanelOpen && currentMode === 'lens') updateBeams();
    });
    window.addEventListener('resize', ()=>{
      if(bluePanelOpen && currentMode === 'lens') updateBeams();
    });

    let asdAngle = 20;
    const ASD_STEP = 5;
    const ASD_START = 20;
    let asdLastDir = -1;
    let asdDone = false;

    function setASDHintDefault(){
      if(!asdHint) return;
      asdHint.innerHTML = 'ì•„íë¸Œ ASDëŠ” ìì—°ìŠ¤ë¡œìš´ ëˆˆ ê¹œë°•ì„ì„ í†µí•´ ë¹ ë¥´ê³  ì •í™•í•˜ê²Œ ì¶• ì•ˆì •í™”ë¥¼ í•©ë‹ˆë‹¤.  ë¯¸ì…˜: â€˜ê¹œë°•ì„â€™ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì´íƒˆëœ ì¶•ì„ ì•ˆì •í™” ì‹œì¼œì£¼ì„¸ìš”';
    }
    function setASDHintSuccess(){
      if(!asdHint) return;
      asdHint.innerHTML = `
        <span>ë¯¸ì…˜ì„±ê³µ : ì¶•ì´ ì•ˆì •í™”ë˜ì—ˆìŠµë‹ˆë‹¤. í™•ì¸ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”</span>
        <button id="asdConfirmBtn" type="button" aria-label="í™•ì¸">í™•ì¸</button>
      `;
      const btn = document.getElementById('asdConfirmBtn');
      if(btn){
        btn.addEventListener('click', (e)=>{
          e.stopPropagation();
          closeASD();
          markASDDone(true);
        });
      }
    }
    function markASDDone(done){
      asdDone = !!done;
      missionASD.classList.toggle('done', asdDone);
    }
    function pickASDLensSrc(){
      return (currentMode === 'heat') ? 'lens2.png' : 'lens.png';
    }
    function setASDLensSrc(){
      if(!asdLensImg) return;
      const src = pickASDLensSrc();
      asdLensImg.src = src + '?v=' + Date.now();
    }
    function renderASDLensTransform(extraX=0){
      if(!asdLensImg) return;
      asdLensImg.style.transform =
        `translate(calc(-50% + ${extraX}px + var(--irisX, 0px)), calc(-50% + var(--irisY, 0px))) rotate(${asdAngle}deg)`;
      if(asdAngleBadge){
        if(asdAngle > 0) asdAngleBadge.textContent = `ì¢Œì¸¡ìœ¼ë¡œ ${asdAngle}Â° íšŒì „`;
        else if(asdAngle < 0) asdAngleBadge.textContent = `ìš°ì¸¡ìœ¼ë¡œ ${Math.abs(asdAngle)}Â° íšŒì „`;
        else asdAngleBadge.textContent = `ì¶• ì•ˆì •`;
      }
    }
    function resetASDState(){
      asdAngle = ASD_START;
      asdLastDir = -1;
      renderASDLensTransform(0);
    }

    let asdBlinkBusy = false;
    function playBlinkLid(){
      if(asdBlinkBusy) return;
      asdBlinkBusy = true;

      const hideLens = ()=>{
        if(asdLensImg) asdLensImg.style.opacity = '0';
        if(asdLensRim) asdLensRim.style.opacity = '0';
      };
      const showLens = ()=>{
        if(asdLensImg) asdLensImg.style.opacity = '';
        if(asdLensRim) asdLensRim.style.opacity = '';
      };

      if(!asdLidTop || !asdLidBot) {
        hideLens();
        setTimeout(()=>{ showLens(); asdBlinkBusy = false; }, 220);
        return;
      }

      asdLidTop.style.transition = 'none';
      asdLidBot.style.transition = 'none';
      asdLidTop.style.opacity = '0';
      asdLidBot.style.opacity = '0';
      asdLidTop.style.transform = 'translateY(-110%)';
      asdLidBot.style.transform = 'translateY(110%)';

      requestAnimationFrame(()=>{
        asdLidTop.style.transition = 'transform 120ms ease, opacity 120ms ease';
        asdLidBot.style.transition = 'transform 120ms ease, opacity 120ms ease';
        asdLidTop.style.opacity = '1';
        asdLidBot.style.opacity = '1';
        asdLidTop.style.transform = 'translateY(0%)';
        asdLidBot.style.transform = 'translateY(0%)';

        setTimeout(hideLens, 55);

        setTimeout(()=>{
          asdLidTop.style.transition = 'transform 150ms ease, opacity 150ms ease';
          asdLidBot.style.transition = 'transform 150ms ease, opacity 150ms ease';
          asdLidTop.style.transform = 'translateY(-110%)';
          asdLidBot.style.transform = 'translateY(110%)';
          asdLidTop.style.opacity = '0';
          asdLidBot.style.opacity = '0';
        }, 140);

        setTimeout(()=>{
          showLens();
          asdBlinkBusy = false;
        }, 240);
      });
    }

    function overshootAndReturn(){
      const overshootDeg = asdLastDir * 3;
      if(!asdLensImg) return;
      asdLensImg.style.transition = 'transform 120ms ease';
      asdAngle = overshootDeg;
      renderASDLensTransform(0);
      setTimeout(()=>{
        asdLensImg.style.transition = 'transform 180ms ease';
        asdAngle = 0;
        renderASDLensTransform(0);
        setTimeout(()=>{
          if(asdLensImg) asdLensImg.style.transition = '';
        }, 190);
      }, 120);
    }
    function handleASDBlink(){
      playBlinkLid();
      if(asdAngle > 0){
        asdLastDir = -1;
        asdAngle = Math.max(0, asdAngle - ASD_STEP);
        if(asdLensImg){
          asdLensImg.style.transition = 'transform 160ms ease';
          renderASDLensTransform(0);
          setTimeout(()=>{ if(asdLensImg) asdLensImg.style.transition = ''; }, 170);
        }else{
          renderASDLensTransform(0);
        }
        if(asdAngle === 0 && !asdDone){
          setASDHintSuccess();
        }
      }else if(asdAngle < 0){
        asdLastDir = +1;
        asdAngle = Math.min(0, asdAngle + ASD_STEP);
        if(asdLensImg){
          asdLensImg.style.transition = 'transform 160ms ease';
          renderASDLensTransform(0);
          setTimeout(()=>{ if(asdLensImg) asdLensImg.style.transition = ''; }, 170);
        }else{
          renderASDLensTransform(0);
        }
        if(asdAngle === 0 && !asdDone){
          setASDHintSuccess();
        }
      }else{
        overshootAndReturn();
      }
    }
    if(asdBlinkBtn){
      asdBlinkBtn.addEventListener('click', (e)=>{
        e.stopPropagation();
        handleASDBlink();
      });
    }
    function handleASDRotateRandom(){
      markASDDone(false);
      setASDHintDefault();
      const mags = [10,15,20];
      const mag = mags[Math.floor(Math.random() * mags.length)];
      const dir = (Math.random() < 0.5) ? -1 : 1;
      asdLastDir = dir;
      asdAngle = dir * mag;
      if(asdLensImg){
        asdLensImg.style.transition = 'transform 180ms ease';
        renderASDLensTransform(0);
        setTimeout(()=>{ if(asdLensImg) asdLensImg.style.transition = ''; }, 190);
      }else{
        renderASDLensTransform(0);
      }
    }
    if(asdRotateBtn){
      asdRotateBtn.addEventListener('click', (e)=>{
        e.stopPropagation();
        handleASDRotateRandom();
      });
    }

    function getOrbitSafe(){ try{ return mv.getCameraOrbit(); }catch(e){ return null; } }
    function getTargetSafe(){ try{ return mv.getCameraTarget(); }catch(e){ return null; } }
    function applyOrbit(orbit){
      if(!orbit) return;
      try{ mv.cameraOrbit = `${orbit.theta}rad ${orbit.phi}rad ${orbit.radius}m`; }catch(e){}
    }
    function applyTarget(target){
      if(!target) return;
      try{ mv.cameraTarget = `${target.x}m ${target.y}m ${target.z}m`; }catch(e){}
    }
    function applyOrbitStr(s){ try{ mv.cameraOrbit = s; }catch(e){} }
    function applyTargetStr(s){ try{ mv.cameraTarget = s; }catch(e){} }

    function resetCameraToModeDefault(mode){
      const orbitStr  = (mode === 'heat') ? HEAT_DEFAULT_ORBIT_STR  : CLEAR_DEFAULT_ORBIT_STR;
      const targetStr = (mode === 'heat') ? HEAT_DEFAULT_TARGET_STR : CLEAR_DEFAULT_TARGET_STR;

      const applyAll = ()=>{
        applyTargetStr(targetStr);
        applyOrbitStr(orbitStr);

        try{
          if(defaultFov) mv.fieldOfView = defaultFov;
          else mv.fieldOfView = '45deg';
        }catch(e){}

        try{ mv.jumpCameraToGoal?.(); }catch(e){}
      };

      try{ mv.removeAttribute('camera-controls'); }catch(e){}

      applyAll();

      requestAnimationFrame(()=>{
        try{ mv.setAttribute('camera-controls',''); }catch(e){}
        applyAll();
        setTimeout(applyAll, 120);
        setTimeout(applyAll, 260);
      });
    }

    function showPVP(show){
      pvpOverlay.classList.toggle('show', show);
      pvpBig.classList.toggle('show', show);
      pvpConfirm.style.display = show ? 'block' : 'none';
    }
    function showThickness(show){
      thicknessBar.classList.toggle('show', show);
      thicknessBar.setAttribute('aria-hidden', show ? 'false' : 'true');
    }

    /* âœ… (ìš”ì²­) PVP ì›í˜• ì´ë¯¸ì§€ + ë Œì¦ˆ ì¤‘ì•™ ë§ì¶¤ & ì‚´ì§ ë” í™•ëŒ€ (ê¸°ì¡´ ë°©ì‹ ìœ ì§€: ì¹´ë©”ë¼ ì¤Œ) */
    const PVP_ZOOM_FACTOR = 0.70;

    function zoomInForPVP(){
      try{
        const orbit = getOrbitSafe();
        if(!orbit) return;
        const targetRadius = orbit.radius * PVP_ZOOM_FACTOR;
        mv.cameraOrbit = `${orbit.theta}rad ${orbit.phi}rad ${targetRadius}m`;
      }catch(e){}
    }

    function tuneClearLensMaterials(){
      try{
        const model = mv.model;
        if(!model || !model.materials) return;
        model.materials.forEach(mat=>{
          const pbr = mat.pbrMetallicRoughness;
          if(!pbr) return;
          const base = pbr.baseColorFactor ? [...pbr.baseColorFactor] : [1,1,1,1];
          base[3] = Math.max(base[3], 0.45);
          pbr.setBaseColorFactor(base);
          try{ pbr.setRoughnessFactor(0.28); }catch(e){}
          try{ pbr.setMetallicFactor(0.0); }catch(e){}
          if(mat.extensions && mat.extensions.KHR_materials_transmission){
            mat.extensions.KHR_materials_transmission.transmissionFactor = 0.86;
          }
          try{
            if(mat.emissiveFactor){ mat.emissiveFactor = [0.04, 0.06, 0.07]; }
          }catch(e){}
          try{ if(mat.setAlphaMode) mat.setAlphaMode('BLEND'); }catch(e){}
        });
      }catch(e){}
    }

    function backupOriginalColors(){
      try{
        const model = mv.model;
        if(!model || !model.materials) return;
        allMaterialBackup = model.materials.map(mat=>{
          const pbr = mat.pbrMetallicRoughness;
          const base = (pbr && pbr.baseColorFactor) ? [...pbr.baseColorFactor] : [1,1,1,1];
          return base;
        });
      }catch(e){
        allMaterialBackup = null;
      }
    }
    function restoreOriginalColors(){
      try{
        const model = mv.model;
        if(!model || !model.materials || !allMaterialBackup) return;
        model.materials.forEach((mat, idx)=>{
          const pbr = mat.pbrMetallicRoughness;
          if(!pbr) return;
          const base = allMaterialBackup[idx] ? [...allMaterialBackup[idx]] : [1,1,1,1];
          base[3] = Math.max(base[3], 0.45);
          pbr.setBaseColorFactor(base);
        });
      }catch(e){}
    }
    function applyTint(){
      try{
        const model = mv.model;
        if(!model || !model.materials) return;
        model.materials.forEach((mat, idx)=>{
          const pbr = mat.pbrMetallicRoughness;
          if(!pbr) return;
          const cur = pbr.baseColorFactor ? [...pbr.baseColorFactor] : (allMaterialBackup?.[idx] ? [...allMaterialBackup[idx]] : [1,1,1,1]);
          const a = Math.max(cur[3] ?? 0.45, 0.45);
          pbr.setBaseColorFactor([BLUEGREEN_TINT[0], BLUEGREEN_TINT[1], BLUEGREEN_TINT[2], a]);
        });
      }catch(e){}
    }

    function syncMissionUI(){
      missionASD.classList.toggle('on', asdOverlay.classList.contains('show'));
      missionPVP.classList.toggle('on', pvpOn);
      missionBlue.classList.toggle('on', bluePanelOpen);

      missionASD.classList.toggle('done', asdDone);
      missionBlue.classList.toggle('done', blueMission.confirmed);
      missionPVP.classList.toggle('done', pvpDone);
    }

    function closeASD(){
      asdOverlay.classList.remove('show');
      asdOverlay.setAttribute('aria-hidden','true');
      resetCameraToModeDefault('lens');
      syncMissionUI();
    }

    function setModeButtons(){
      modeLens.classList.toggle('primary', currentMode === 'lens');
      modeHeat.classList.toggle('primary', currentMode === 'heat');
    }

    function forceBlueOff(){
      blueOn = false;
      restoreOriginalColors();
      orbitBeforeBlue = null;
      targetBeforeBlue = null;
      __patchBeamsForSafari();
      setBlueUI();
      syncMissionUI();
    }

    function closeBluePanel(){
      bluePanelOpen = false;
      forceBlueOff();
      __patchBeamsForSafari();
      setBlueUI();
      syncMissionUI();
    }

    function forcePVPOff(){
      if(!pvpOn) return;
      pvpOn = false;
      showPVP(false);
      syncMissionUI();
    }

    function openASD(){
      if(bluePanelOpen) closeBluePanel();
      if(pvpOn) forcePVPOff();

      resetCameraToModeDefault('lens');

      setASDLensSrc();
      resetASDState();
      setASDHintDefault();

      if(asdEyeMV){
        asdEyeMV.src = 'a.png' + '?v=' + Date.now();
      }

      asdOverlay.classList.add('show');
      asdOverlay.setAttribute('aria-hidden','false');
      syncMissionUI();
    }

    function setModel(file, mode, options = {}){
      const { resetCamera = false } = options;

      return new Promise((resolve)=>{
        pendingCameraPreset = null;

        if(!resetCamera){
          lastOrbit = getOrbitSafe();
          lastTarget = getTargetSafe();
        }else{
          lastOrbit = null;
          lastTarget = null;

          if(mode === 'heat'){
            pendingCameraPreset = { orbitStr: HEAT_DEFAULT_ORBIT_STR, targetStr: HEAT_DEFAULT_TARGET_STR };
          }else{
            pendingCameraPreset = { orbitStr: CLEAR_DEFAULT_ORBIT_STR, targetStr: CLEAR_DEFAULT_TARGET_STR };
          }
        }

        currentMode = mode;

        forcePVPOff();
        if(bluePanelOpen) closeBluePanel();

        showThickness(mode === 'heat');
        setModeButtons();

        const onLoadOnce = ()=>{
          mv.removeEventListener('load', onLoadOnce);
          resolve();
        };
        mv.addEventListener('load', onLoadOnce, { once:true });

        mv.src = file + '?v=' + Date.now();
      });
    }

    mv.addEventListener('load', ()=>{
      if(!defaultOrbit) defaultOrbit = getOrbitSafe();
      if(!defaultTarget) defaultTarget = getTargetSafe();
      if(!defaultFov){
        try{ defaultFov = mv.fieldOfView; }catch(e){ defaultFov = null; }
      }

      if(pendingCameraPreset){
        applyTargetStr(pendingCameraPreset.targetStr);
        applyOrbitStr(pendingCameraPreset.orbitStr);

        setTimeout(()=>{
          applyTargetStr(pendingCameraPreset.targetStr);
          applyOrbitStr(pendingCameraPreset.orbitStr);
        }, 120);

        resetCameraToModeDefault(currentMode);
        pendingCameraPreset = null;
      }else{
        if(lastTarget) applyTarget(lastTarget);
        if(lastOrbit)  applyOrbit(lastOrbit);

        setTimeout(()=>{
          if(lastTarget) applyTarget(lastTarget);
          if(lastOrbit)  applyOrbit(lastOrbit);
        }, 120);
      }

      if(currentMode === 'lens'){
        tuneClearLensMaterials();
        backupOriginalColors();
      }

      setModeButtons();
      __patchBeamsForSafari();
      setBlueUI();
      syncMissionUI();

      /* âœ… í„°ì¹˜/ë¡œë“œ í›„ ë©ˆì¶¤ ë°©ì§€: ë¡œë“œ ëë‚˜ë©´ ì¬ìƒ ìƒíƒœ í•œë²ˆ ë” ê°•ì œ */
      keepMVPlaying();
      setTimeout(keepMVPlaying, 120);
    });

    function toggleASD(){
      if(asdOverlay.classList.contains('show')){ closeASD(); return; }
      // âœ… ASD ì¶•ì•ˆì •í™”: ì¹´ë“œ í´ë¦­ ì‹œ 'í‚¤ ë©”ì‹œì§€' â†’ í™•ì¸ â†’ ë¯¸ì…˜(ASD í™”ë©´) íë¦„
      showASDKeyMsg();
    }
    missionASD.addEventListener('click', toggleASD);
    missionASD.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') toggleASD(); });

    asdClose.addEventListener('click', closeASD);
    asdOverlay.addEventListener('click', (e)=>{ if(e.target === asdOverlay) closeASD(); });

    async function togglePVP(){
      if(currentMode === 'heat'){
        await setModel('lens_clear.glb', 'lens', { resetCamera:true });
      }
      if(currentMode !== 'lens') return;

      if(!pvpOn && bluePanelOpen) closeBluePanel();
      if(asdOverlay.classList.contains('show')) closeASD();

      pvpOn = !pvpOn;

      if(pvpOn){
        resetCameraToModeDefault('lens');
        setTimeout(()=>{
          zoomInForPVP();
          showPVP(true);
          syncMissionUI();
        }, 140);
      }else{
        showPVP(false);
        resetCameraToModeDefault('lens');
        syncMissionUI();
      }
    }
    missionPVP.addEventListener('click', togglePVP);
    missionPVP.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') togglePVP(); });

    function confirmPVP(){
      pvpDone = true;
      pvpOn = false;
      showPVP(false);
      resetCameraToModeDefault('lens');
      syncMissionUI();
    }
    pvpConfirm.addEventListener('click', (e)=>{ e.stopPropagation(); confirmPVP(); });
    pvpConfirm.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); confirmPVP(); } });

    async function toggleBluePanel(){
      if(currentMode === 'heat'){
        await setModel('lens_clear.glb', 'lens', { resetCamera:true });
      }
      if(currentMode !== 'lens') return;

      forcePVPOff();
      if(asdOverlay.classList.contains('show')) closeASD();

      bluePanelOpen = !bluePanelOpen;

      if(!bluePanelOpen){
        closeBluePanel();
        resetCameraToModeDefault('lens');
        return;
      }

      forceBlueOff();
      bluePanelOpen = true;

      if(!blueMission.confirmed){
        blueMission.successShown = false;
      }

      applyOrbitStr(BLUE_PANEL_ORBIT_STR);
      applyTargetStr(BLUE_PANEL_TARGET_STR);
      setTimeout(()=>{
        applyOrbitStr(BLUE_PANEL_ORBIT_STR);
        applyTargetStr(BLUE_PANEL_TARGET_STR);
        __patchBeamsForSafari();
        __forceSvgRedraw();
        updateBeams();
        playBeamAnimation();
      }, 120);

      __patchBeamsForSafari();
      setBlueUI();
      syncMissionUI();
    }
    missionBlue.addEventListener('click', toggleBluePanel);
    missionBlue.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') toggleBluePanel(); });

    function setBlueState(nextOn){
      if(!bluePanelOpen) return;

      const newState = !!nextOn;

      if(blueOn === newState){
        setBlueUI();
        updateBeams();
        playBeamAnimation();
        return;
      }

      blueOn = newState;

      if(!blueMission.confirmed && blueOn){
        blueMission.successShown = true;
      }

      if(blueOn) blueMission.sawOn = true;
      else blueMission.sawOff = true;

      if(blueOn){
        if(!allMaterialBackup) backupOriginalColors();
        applyTint();
      }else{
        restoreOriginalColors();
      }

      applyOrbitStr(BLUE_PANEL_ORBIT_STR);
      applyTargetStr(BLUE_PANEL_TARGET_STR);
      setTimeout(()=>{
        applyOrbitStr(BLUE_PANEL_ORBIT_STR);
        applyTargetStr(BLUE_PANEL_TARGET_STR);
        __patchBeamsForSafari();
        __forceSvgRedraw();
        updateBeams();
        playBeamAnimation();
      }, 80);

      __patchBeamsForSafari();
      setBlueUI();
      syncMissionUI();
    }

    blueSegOn.addEventListener('click', (e)=>{ e.stopPropagation(); setBlueState(true); });
    blueSegOff.addEventListener('click', (e)=>{ e.stopPropagation(); setBlueState(false); });

    blueMissionConfirm.addEventListener('click', (e)=>{
      e.stopPropagation();
      blueMission.confirmed = true;
      blueMission.successShown = false;
      __patchBeamsForSafari();
      setBlueUI();
      syncMissionUI();
    });

    btnReset.addEventListener('click', async ()=>{
      if(asdOverlay.classList.contains('show')) closeASD();
      if(pvpOn){ pvpOn = false; showPVP(false); }
      if(bluePanelOpen){ bluePanelOpen = false; forceBlueOff(); }

      showThickness(currentMode === 'heat');
      bluePanelOpen = false;
      setBlueUI();

      resetCameraToModeDefault(currentMode);
      syncMissionUI();
    });

    modeLens.addEventListener('click', ()=> setModel('lens_clear.glb', 'lens', { resetCamera:false }));
    modeHeat.addEventListener('click', ()=> setModel('lens_heatmap.glb', 'heat', { resetCamera:false }));

    setModel('lens_clear.glb', 'lens', { resetCamera:true });
  
    // =========================
    // âœ… Auto Tutorial (ì¢Œì¸¡ â†’ í•˜ë‹¨ â†’ ìƒë‹¨)
    // - íŠœí† ë¦¬ì–¼ ë²„íŠ¼ ì—†ì´, ì°½ì„ ì¼œë©´ ë°”ë¡œ ì‹œì‘
    // =========================
    
    /* =========================
       âœ… [NEW] ìë™ íŠœí† ë¦¬ì–¼(ë„¤ì´ë²„ ëŠë‚Œ)
       - ìˆœì„œ: ë Œì¦ˆì¡°ì‘ â†’ í•˜ë‹¨ë²„íŠ¼ â†’ ë¯¸ì…˜ì¹´ë“œ
       - ì¸ë””ì¼€ì´í„°(dot) í¬í•¨
       - ì„¸ì…˜ 1íšŒ ë…¸ì¶œ
       ========================= */
    const tutorialOverlay   = document.getElementById('tutorialOverlay');
    const tutorialHighlight = document.getElementById('tutorialHighlight');
    const tutorialBubble    = document.getElementById('tutorialBubble');
    const tutorialBody      = document.getElementById('tutorialBubbleBody');
    const tutorialNext      = document.getElementById('tutorialNext');
    const tutorialClose     = document.getElementById('tutorialClose');
    const tutorialDots      = document.getElementById('tutorialDots');
    const tutorialGift      = document.getElementById('tutorialGift');
    const tutorialTitle     = document.getElementById('tutorialTitle');

    const tutorialArrowPath = document.getElementById('tutorialArrowPath');
    const tutorialHand      = document.getElementById('tutorialHand');

    const tutorialSteps = [
      {
        title: 'ê°€ì´ë“œ 1/3',
        body: 'ë Œì¦ˆë¥¼ ì¢Œìš°ë¡œ ì›€ì§ì—¬
ì•„íë¸Œ ë‚œì‹œë Œì¦ˆë¥¼ ì²´í—˜í•´ ë³´ì„¸ìš”',
        target: ()=> mv,                 // í™”ë©´ ì¤‘ì•™ ë Œì¦ˆ ì˜ì—­
        highlight: (rect)=> {
          // model-viewerëŠ” ì „ì²´ í™”ë©´ì´ë¼ ì¤‘ì•™ ì›í˜•ì²˜ëŸ¼ ê°•ì¡°
          const size = Math.min(window.innerWidth, window.innerHeight) * 0.42;
          const cx = window.innerWidth * 0.52;
          const cy = window.innerHeight * 0.52;
          return { x: cx - size/2, y: cy - size/2, w: size, h: size, r: 999 };
        },
        showGift: false
      },
      {
        title: 'ê°€ì´ë“œ 2/3',
        body: 'ë Œì¦ˆ ë‘ê»˜ MAPì„ ëˆŒëŸ¬
ë Œì¦ˆ ê°€ì¥ìë¦¬ ë‘ê»˜ë¥¼ í™•ì¸í•´ ë³´ì„¸ìš”',
        target: ()=> document.getElementById('bottomBtns'),
        highlight: null,
        showGift: false
      },
      {
        title: 'ê°€ì´ë“œ 3/3',
        body: 'ê° ì¹´ë“œë¥¼ ëˆŒëŸ¬ ë¯¸ì…˜ ì™„ë£Œ ì‹œ,
ê¸°í”„í‹°ì½˜!',
        target: ()=> document.getElementById('missionBar'),
        highlight: null,
        showGift: true
      }
    ];
    let tutorialIdx = 0;

    function setDots(i){
      if(!tutorialDots) return;
      const dots = Array.from(tutorialDots.querySelectorAll('.dot'));
      dots.forEach((d, idx)=> d.classList.toggle('on', idx === i));
    }

    function placeTutorial(targetEl, step){
      if(!targetEl) return;

      const r = targetEl.getBoundingClientRect();
      const pad = 8;

      // highlight rect
      let hx, hy, hw, hh, radius = 22;
      if(step && typeof step.highlight === 'function'){
        const h = step.highlight(r);
        hx=h.x; hy=h.y; hw=h.w; hh=h.h; radius=h.r ?? 22;
      }else{
        hx = r.left - pad;
        hy = r.top  - pad;
        hw = r.width  + pad*2;
        hh = r.height + pad*2;
      }

      tutorialHighlight.style.left = hx + 'px';
      tutorialHighlight.style.top = hy + 'px';
      tutorialHighlight.style.width = hw + 'px';
      tutorialHighlight.style.height = hh + 'px';
      tutorialHighlight.style.borderRadius = radius + 'px';

      // bubble ìœ„ì¹˜: ê¸°ë³¸ì€ highlight ì•„ë˜, ë¶€ì¡±í•˜ë©´ ìœ„
      const bubbleW = Math.min(560, window.innerWidth * 0.92);
      const bubbleRect = tutorialBubble.getBoundingClientRect();
      const bubbleH = bubbleRect.height || 170;

      let bx = Math.max(12, Math.min(window.innerWidth - bubbleW - 12, hx));
      let by = hy + hh + 14;

      if(by + bubbleH > window.innerHeight - 12){
        by = Math.max(12, hy - bubbleH - 14);
      }

      tutorialBubble.style.left = bx + 'px';
      tutorialBubble.style.top = by + 'px';

      // hand (í•˜ì´ë¼ì´íŠ¸ ì¤‘ì•™)
      const handX = hx + hw*0.55;
      const handY = hy + hh*0.62;
      if(tutorialHand){
        tutorialHand.style.left = handX + 'px';
        tutorialHand.style.top  = handY + 'px';
        tutorialHand.style.opacity = '1';
      }

      // curved arrow: bubble -> highlight
      if(tutorialArrowPath){
        const startX = (bx + bubbleW*0.22) / window.innerWidth  * 100;
        const startY = (by + bubbleH*0.55) / window.innerHeight * 100;

        const endX   = (hx + hw*0.55) / window.innerWidth  * 100;
        const endY   = (hy + hh*0.35) / window.innerHeight * 100;

        const midX   = (startX + endX)/2;
        const midY   = Math.min(startY, endY) - 10;

        tutorialArrowPath.setAttribute('d', `M ${startX} ${startY} Q ${midX} ${midY} ${endX} ${endY}`);
        tutorialArrowPath.style.opacity = '0.95';
      }
    }

    function showTutorialStep(i){
      const step = tutorialSteps[i];
      if(!step) return;

      tutorialIdx = i;

      const targetEl = step.target?.();
      if(!targetEl) return;

      tutorialOverlay.classList.add('show');
      tutorialOverlay.setAttribute('aria-hidden','false');

      tutorialTitle.textContent = step.title;
      tutorialBody.textContent = step.body;

      tutorialGift.style.display = step.showGift ? 'inline-flex' : 'none';

      setDots(i);
      placeTutorial(targetEl, step);
    }

    function closeTutorial(persist=true){
      tutorialOverlay.classList.remove('show');
      tutorialOverlay.setAttribute('aria-hidden','true');
      if(tutorialHand) tutorialHand.style.opacity = '0';
      if(tutorialArrowPath) tutorialArrowPath.style.opacity = '0';
      if(persist){
        try{ sessionStorage.setItem('acuvue_tutorial_done','1'); }catch(e){}
      }
    }

    if(tutorialNext){
      tutorialNext.addEventListener('click', ()=>{
        const next = tutorialIdx + 1;
        if(next >= tutorialSteps.length){
          closeTutorial(true);
          return;
        }
        showTutorialStep(next);
      });
    }
    if(tutorialClose){
      tutorialClose.addEventListener('click', ()=> closeTutorial(true));
    }
    if(tutorialOverlay){
      tutorialOverlay.addEventListener('click', (e)=>{
        if(e.target === tutorialOverlay) closeTutorial(true);
      });
    }

    window.addEventListener('resize', ()=>{
      if(tutorialOverlay && tutorialOverlay.classList.contains('show')){
        const step = tutorialSteps[tutorialIdx];
        const targetEl = step?.target?.();
        if(targetEl) placeTutorial(targetEl, step);
      }
    });

    // ìë™ ì‹œì‘(ì„¸ì…˜ 1íšŒ)
    window.addEventListener('load', ()=>{
      let done = false;
      try{ done = sessionStorage.getItem('acuvue_tutorial_done') === '1'; }catch(e){}
      if(done) return;

      // ì²« ë Œë” í›„ í‘œì‹œ
      setTimeout(()=>{ showTutorialStep(0); }, 420);
    });
    /* ========================= */

    });

// =========================
    // âœ… ASD Key Message â†’ ASD í™”ë©´(ë¯¸ì…˜) íë¦„
    // =========================
    const asdKeyMsgLayer = document.getElementById('asdKeyMsgLayer');
    function showASDKeyMsg(){
      asdKeyMsgLayer.classList.add('show');
      asdKeyMsgLayer.setAttribute('aria-hidden','false');
    }
    function hideASDKeyMsg(){
      asdKeyMsgLayer.classList.remove('show');
      asdKeyMsgLayer.setAttribute('aria-hidden','true');
    }
    document.getElementById('asdKeyConfirm')?.addEventListener('click', ()=>{
      hideASDKeyMsg();
      openASD();          // ASD í™”ë©´ìœ¼ë¡œ ì „í™˜
      setASDHintDefault(); // ë¯¸ì…˜1 ë¬¸êµ¬ ì ìš©
    });

</script>

  <!-- âœ… Auto Tutorial Layer (ì¢Œì¸¡ â†’ í•˜ë‹¨ â†’ ìƒë‹¨) -->
  <div id="tutorialLayer" aria-hidden="true">
    <div class="tutBox" id="tutLeft" style="display:none;">
      <div class="tutTitle">ê°€ì´ë“œ 1</div>
      <div class="tutText">ë Œì¦ˆë¥¼ ë“œë˜ê·¸ ë° í™•ëŒ€, ì¶•ì†Œí•´ ë³´ì„¸ìš”.<br/>ì•„íë¸Œ ë‚œì‹œ ë Œì¦ˆ êµ¬ì¡°ë¥¼ ìƒìƒí•˜ê²Œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
      <button class="tutBtn" id="tutNext1">í™•ì¸</button>
    </div>
    <div class="tutBox" id="tutBottom" style="display:none;">
      <div class="tutTitle">ê°€ì´ë“œ 2</div>
      <div class="tutText">â€˜ë Œì¦ˆ ë‘ê»˜ MAPâ€™ì„ í´ë¦­í•˜ì—¬<br/>ë Œì¦ˆì˜ ê°€ì¥ ì–‡ì€ ë¶€ë¶„(ë³´ë¼ìƒ‰)ì„ í™•ì¸í•´ ë³´ì„¸ìš”!</div>
      <button class="tutBtn" id="tutNext2">í™•ì¸</button>
    </div>
    <div class="tutBox" id="tutTop" style="display:none;">
      <div class="tutTitle">ê°€ì´ë“œ 3</div>
      <div class="tutText">ê° ì¹´ë“œë¥¼ ëˆŒëŸ¬ ë¯¸ì…˜ì„ ì§„í–‰í•´ ë³´ì„¸ìš”.<br/>ë¯¸ì…˜ ì™„ë£Œì‹œ ê¸°í”„í‹°ì½˜!</div>
      <button class="tutBtn" id="tutDone">í™•ì¸</button>
    </div>
  </div>

  <!-- âœ… ASD Key Message (ASD ì¶•ì•ˆì •í™” ì¹´ë“œ í´ë¦­ ì‹œ ë¨¼ì € ë…¸ì¶œ) -->
  <div id="asdKeyMsgLayer" aria-hidden="true">
    <div id="asdKeyMsgCard">
      <div class="kmTitle">í‚¤ ë©”ì‹œì§€</div>
      <div class="kmText">ì•„íë¸Œ ASDëŠ” ìì—°ìŠ¤ëŸ¬ìš´ ëˆˆ ê¹œë°•ì„ì„ í†µí•´<br/>ë¹ ë¥´ê³  ì •í™•í•˜ê²Œ ì¶• ì•ˆì •í™”ë¥¼ í•©ë‹ˆë‹¤.</div>
      <button class="kmBtn" id="asdKeyConfirm">í™•ì¸</button>
    </div>
  </div>

</body>
</html>
