<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title> ACUVUE PRODUCT </title>

  <style>
    :root{
      --bg:#f6f8fc;
      --surface:#ffffff;
      --text:#0b1220;
      --muted:#5b6475;

      --brand:#0b4aa2;
      --brand2:#1e78ff;
      --line:#e6e9f2;

      --card:#ffffff;
      --soft:#f2f5fb;

      --btn:#0b4aa2;
      --btnText:#ffffff;

      --shadow: 0 10px 28px rgba(16,24,40,0.10);
      --shadow2: 0 6px 16px rgba(16,24,40,0.08);
      --radius: 18px;
      --radiusSm: 14px;
      --max: 760px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      background: radial-gradient(1200px 500px at 20% -10%, rgba(30,120,255,0.12), transparent 60%),
                  radial-gradient(900px 450px at 90% 0%, rgba(11,74,162,0.10), transparent 55%),
                  var(--bg);
      color:var(--text);
      font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic", Arial, sans-serif;
      line-height:1.35;
    }

    .wrap{
      max-width: var(--max);
      margin:0 auto;
      padding: 18px 16px 44px;
    }

    header{
      position: sticky;
      top: 0;
      z-index: 5;
      padding: 12px 0 12px;
      backdrop-filter: blur(10px);
      background: rgba(246,248,252,0.72);
      border-bottom: 1px solid rgba(230,233,242,0.75);
    }

    .headRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .brandBox{
      display:flex;
      flex-direction:column;
      gap:2px;
      min-width: 0;
    }
    .brandBox .title{
      font-weight:950;
      letter-spacing:-0.4px;
      font-size:16px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .brandBox .sub{
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .pill{
      font-size:12px;
      padding:8px 10px;
      border:1px solid var(--line);
      border-radius:999px;
      color:var(--muted);
      background: rgba(255,255,255,0.9);
      box-shadow: 0 2px 10px rgba(16,24,40,0.06);
      flex: 0 0 auto;
    }

    .card{
      background: var(--card);
      border: 1px solid rgba(230,233,242,0.9);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: var(--shadow);
    }
    .card + .card{ margin-top: 12px; }

    .h1{
      font-size: 22px;
      font-weight: 950;
      letter-spacing:-0.6px;
      margin:0 0 8px;
    }
    .p{
      margin:0;
      color: var(--muted);
      font-size: 14px;
      line-height:1.45;
    }

    .btn{
      width:100%;
      border:0;
      border-radius: 14px;
      padding: 14px 14px;
      font-size: 16px;
      font-weight: 900;
      background: linear-gradient(180deg, var(--brand2), var(--brand));
      color: var(--btnText);
      cursor:pointer;
      box-shadow: 0 10px 22px rgba(11,74,162,0.22);
    }
    .btn:active{ transform: translateY(1px); }

    .btn.secondary{
      background: rgba(255,255,255,0.96);
      color: var(--text);
      border:1px solid var(--line);
      font-weight: 900;
      box-shadow: var(--shadow2);
    }

    .btnRow{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      margin-top: 14px;
    }

    .trust{
      margin-top: 12px;
      font-size: 12px;
      color: var(--muted);
      display:flex;
      align-items:flex-start;
      gap:8px;
    }
    .trust .dot{
      width:8px; height:8px;
      margin-top: 5px;
      border-radius: 999px;
      background: #16a34a;
      flex:0 0 auto;
    }

    /* ========== RESULT HERO (íŒ©ìƒ· + ì œí’ˆëª… + í—¤ë“œë¼ì¸) ========== */
    .hero{
      padding: 16px;
      border-radius: var(--radius);
      border: 1px solid rgba(230,233,242,0.9);
      background:
        radial-gradient(420px 260px at 10% 10%, rgba(30,120,255,0.18), transparent 60%),
        radial-gradient(380px 240px at 90% 0%, rgba(11,74,162,0.14), transparent 55%),
        linear-gradient(180deg, rgba(255,255,255,0.96), rgba(255,255,255,0.92));
      box-shadow: var(--shadow);
    }

    .heroTop{
      display:flex;
      gap:12px;
      align-items:flex-start;
    }

    .heroShot{
      width:78px;
      height:78px;
      object-fit:contain;
      border-radius: 16px;
      background:#fff;
      border:1px solid rgba(0,0,0,0.06);
      box-shadow: 0 10px 24px rgba(0,0,0,0.10);
      flex: 0 0 auto;
    }

    .heroText{
      flex:1 1 auto;
      min-width: 0;
    }

    .heroProductName{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-size: 13px;
      font-weight: 950;
      letter-spacing: -0.2px;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(11,74,162,0.08);
      border: 1px solid rgba(11,74,162,0.16);
      margin: 0 0 10px;
      color: var(--text);
    }
    .heroProductName .miniDot{
      width:8px; height:8px;
      border-radius:999px;
      background: var(--brand);
      box-shadow: 0 0 0 5px rgba(11,74,162,0.10);
    }

    .hero h2{
      margin:0 0 8px;
      font-size: 20px;
      letter-spacing:-0.55px;
      font-weight: 980;
      line-height:1.18;
    }

    .hero p{
      margin:0;
      color: var(--muted);
      font-size: 14px;
      line-height:1.5;
    }

    /* ========== KEY CARDS ========== */
    .kcards{
      display:grid;
      gap:10px;
      margin-top: 12px;
    }
    .kcard{
      background:#fff;
      border: 1px solid rgba(230,233,242,0.95);
      border-radius: var(--radiusSm);
      padding: 14px;
      box-shadow: var(--shadow2);
    }
    .kcard .khead{
      display:flex;
      gap:10px;
      align-items:center;
      margin-bottom: 6px;
      font-weight: 950;
      letter-spacing:-0.3px;
    }
    .kcard .ico{
      width:32px; height:32px;
      display:grid; place-items:center;
      border-radius: 12px;
      background: rgba(11,74,162,0.10);
      border: 1px solid rgba(11,74,162,0.18);
      font-size: 16px;
      flex: 0 0 auto;
    }
    .kcard .kbody{
      color: var(--muted);
      font-size: 14px;
      line-height:1.45;
    }

    /* ========== FACTS / DEFENSE ========== */
    .grid2{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      margin-top: 12px;
    }

    .list{
      margin:0;
      padding: 0;
      list-style:none;
      display:grid;
      gap:8px;
      font-size: 14px;
    }
    .li{
      display:flex;
      justify-content:space-between;
      gap:10px;
      padding: 10px 12px;
      background:#fff;
      border: 1px solid rgba(230,233,242,0.95);
      border-radius: 14px;
      box-shadow: var(--shadow2);
    }
    .li span{ color: var(--muted); }
    .li b{ color: var(--text); }

    .quote{
      margin-top: 12px;
      padding: 14px 14px;
      border-radius: 16px;
      background: rgba(217, 237, 255, 0.62);
      border: 1px solid rgba(11,74,162,0.22);
      color: var(--text);
      font-size: 14px;
      line-height:1.55;
      box-shadow: var(--shadow2);
    }
    .quote b{ font-weight: 980; }

    .foot{
      margin-top: 12px;
      color: var(--muted);
      font-size: 12px;
      line-height:1.45;
      border-top: 1px solid rgba(230,233,242,0.9);
      padding-top: 12px;
    }

    .hide{ display:none !important; }

    /* ========== MODALS (SCAN / AR) ========== */
    .modal{
      position: fixed;
      inset:0;
      background: rgba(0,0,0,0.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 16px;
      z-index: 50;
    }
    .modal.open{ display:flex; }

    .modalBox{
      width:100%;
      max-width: 560px;
      background:#fff;
      border-radius: var(--radius);
      overflow:hidden;
      border: 1px solid rgba(230,233,242,0.95);
      box-shadow: var(--shadow);
    }

    .modalTop{
      padding: 12px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom: 1px solid rgba(230,233,242,0.95);
      background: rgba(255,255,255,0.92);
      backdrop-filter: blur(10px);
    }
    .modalTop .t{
      font-weight: 950;
      letter-spacing:-0.3px;
    }
    .x{
      border:1px solid rgba(230,233,242,0.95);
      background:#fff;
      font-size:14px;
      font-weight:900;
      cursor:pointer;
      padding: 10px 12px;
      border-radius: 12px;
      box-shadow: var(--shadow2);
    }

    .videoWrap{
      position: relative;
      background:#000;
      width:100%;
      aspect-ratio: 3 / 4;
    }
    video{
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
    }
    .scanFrame{
      position:absolute;
      inset: 14% 10%;
      border: 2px solid rgba(255,255,255,0.88);
      border-radius: 16px;
      box-shadow: 0 0 0 999px rgba(0,0,0,0.15);
      pointer-events:none;
    }
    .scanHint{
      position:absolute;
      bottom: 10px;
      left: 10px;
      right: 10px;
      background: rgba(255,255,255,0.92);
      border-radius: 14px;
      padding: 10px 10px;
      font-size: 13px;
      color: var(--text);
      box-shadow: var(--shadow2);
    }

    .modalBottom{
      padding: 12px 14px 14px;
      border-top: 1px solid rgba(230,233,242,0.95);
      display:grid;
      gap: 10px;
      background: rgba(255,255,255,0.98);
    }
    .status{
      font-size: 13px;
      color: var(--muted);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .status b{ color: var(--text); }

    .inputRow{
      display:flex;
      gap:8px;
      align-items:center;
    }
    input[type="text"]{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(230,233,242,0.95);
      font-size: 14px;
      outline: none;
      box-shadow: inset 0 1px 0 rgba(16,24,40,0.03);
    }

    /* AR overlay bits */
    .arOverlay{
      position:absolute;
      inset:0;
      pointer-events:none;
    }
    .arTag{
      position:absolute;
      max-width: 78%;
      background: rgba(255,255,255,0.92);
      border: 1px solid rgba(230,233,242,0.95);
      border-radius: 16px;
      padding: 10px 12px;
      color: var(--text);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      pointer-events:none;
    }
    .arTag .t{
      display:flex;
      align-items:center;
      gap:8px;
      font-weight: 950;
      letter-spacing:-0.2px;
      margin: 0 0 6px;
      font-size: 13px;
    }
    .arTag .b{
      font-size: 13px;
      color: var(--muted);
      line-height:1.45;
    }
    .arTag .dot{
      width:10px; height:10px;
      border-radius:999px;
      background: var(--brand);
      box-shadow: 0 0 0 6px rgba(11,74,162,0.12);
      flex:0 0 auto;
    }

    .arHintBar{
      position:absolute;
      left:10px; right:10px; top:10px;
      background: rgba(11,74,162,0.92);
      color:#fff;
      border-radius: 16px;
      padding: 10px 12px;
      font-size: 13px;
      line-height:1.35;
      box-shadow: var(--shadow);
      pointer-events:none;
    }

    @media (min-width: 720px){
      .wrap{ padding: 20px 18px 60px; }
      .btnRow{ grid-template-columns: 1fr 1fr; }
      .heroShot{ width:92px; height:92px; }
      .hero h2{ font-size: 22px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="headRow">
        <div class="brandBox">
          <div class="title">ì œí’ˆ ìŠ¤ìº” í…ŒìŠ¤íŠ¸ </div>
        </div>
        <div class="pill" id="envPill">í™˜ê²½ í™•ì¸ ì¤‘â€¦</div>
      </div>
    </header>

    <!-- ENTRY VIEW -->
    <section id="viewEntry">
    <div class="card">
    <h1 class="h1">ğŸ“· ë‚´ê°€ êµ¬ë§¤í•œ ë Œì¦ˆ,ì•Œì•„ë³´ê¸°</h1>
<p class="p">ì œí’ˆ íŒ©ì„ ì¹´ë©”ë¼ë¡œ ì´¬ì˜í•´ ì£¼ì„¸ìš”</p>
<div class="btnRow">

        <div class="btnRow">
          <button class="btn" id="btnOpenScan">ì¹´ë©”ë¼ë¡œ ìŠ¤ìº”í•˜ê¸°</button>
          <button class="btn secondary" id="btnGoManual">í…ŒìŠ¤íŠ¸ìš© ì½”ë“œ ì…ë ¥</button>
        </div>

        <div class="trust">
        
        </div>
      </div>
    </section>

    <!-- RESULT VIEW -->
    <section id="viewResult" class="hide">
      <!-- HERO (ë…¸ë€ ì˜ì—­ì— íŒ©ìƒ·+ì œí’ˆëª… í¬í•¨) -->
      <div class="hero">
        <div class="heroTop">
          <img
            id="productImage"
            class="heroShot"
            src="https://via.placeholder.com/600x600?text=ACUVUE+MAX+OASYS+1-Day"
            alt="ì•„íë¸Œ ë§¥ìŠ¤ ì˜¤ì•„ì‹œìŠ¤ ì›ë°ì´ íŒ©ìƒ·"
          />

          <div class="heroText">
            <div class="heroProductName" id="productName">
              <span class="miniDot"></span>
              ì•„íë¸Œ ë§¥ìŠ¤ ì˜¤ì•„ì‹œìŠ¤ ì›ë°ì´
            </div>

            <h2 id="heroTitle">ëˆˆì˜ í”¼ë¡œê¹Œì§€ ê³ ë ¤í•´ ì„¤ê³„ëœ ì›ë°ì´ ë Œì¦ˆ</h2>
            <p id="heroSub">ì¥ì‹œê°„ ë””ì§€í„¸ í™˜ê²½ì—ì„œë„ í¸ì•ˆí•œ ì°©ìš©ì„ ëª©í‘œë¡œ ê°œë°œë˜ì—ˆìŠµë‹ˆë‹¤</p>
          </div>
        </div>
      </div>

      <div class="kcards" id="keyCards"></div>

      <div class="grid2">
        <div class="card">
          <div style="font-weight:980; letter-spacing:-0.3px; margin-bottom:10px;">í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ ë Œì¦ˆ</div>
          <ul class="list" id="productFacts"></ul>
          <div style="margin-top:10px; color:var(--muted); font-size:14px; line-height:1.55;" id="targetLine">
            ì´ ë Œì¦ˆëŠ” ìŠ¤ë§ˆíŠ¸í°Â·PC ì‚¬ìš© ì‹œê°„ì´ ê¸´ ë¼ì´í”„ìŠ¤íƒ€ì¼ì„ ê³ ë ¤í•´ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤
          </div>
        </div>

        <div class="quote" id="defenseCopy">
          ğŸ’¬ <b>ë‹¤ë¥¸ ë Œì¦ˆë¥¼ ì¶”ì²œë°›ìœ¼ì…”ë„,</b><br>
          ì§€ê¸ˆ ì‚¬ìš© ì¤‘ì¸ ë Œì¦ˆê°€<br>
          <b>ì‹œì•¼ ì•ˆì •ì„±ê³¼ ëˆˆì˜ í”¼ë¡œë¥¼ ê³ ë ¤í•´ ì„¤ê³„ëœ ì œí’ˆì¸ì§€</b><br>
          ë¹„êµí•´ë³´ì„¸ìš”.
        </div>

        <button class="btn secondary" id="btnAR">
          ğŸ” ARë¡œ ì„¤ê³„ í¬ì¸íŠ¸ ë³´ê¸°
        </button>

        <div class="card">
          <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
            <div style="font-weight:980; letter-spacing:-0.3px;">ì¸ì‹ ê²°ê³¼</div>
            <div class="pill" id="scanBadge">TEST</div>
          </div>
          <p class="p" style="margin-top:8px;" id="scanInfo">ì œí’ˆì„ ì¸ì‹í–ˆìŠµë‹ˆë‹¤.</p>

          <div class="btnRow" style="margin-top:12px;">
            <button class="btn" id="btnRescan">ë‹¤ì‹œ ìŠ¤ìº”í•˜ê¸°</button>
            <button class="btn secondary" id="btnBackHome">ì²˜ìŒìœ¼ë¡œ</button>
          </div>

          <div class="foot">
            ë³¸ ì •ë³´ëŠ” ì œì¡°ì‚¬ ê³µì‹ ìë£Œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì œê³µë©ë‹ˆë‹¤.<br>
            ê°œì¸ ì°©ìš© ìƒë‹´ì€ ì•ˆê²½ì‚¬ì™€ ìƒë‹´í•´ì£¼ì„¸ìš”.
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- SCANNER MODAL -->
  <div class="modal" id="scanModal" aria-hidden="true">
    <div class="modalBox">
      <div class="modalTop">
        <div class="t">ì¹´ë©”ë¼ë¡œ ìŠ¤ìº”</div>
        <button class="x" id="btnCloseScan" aria-label="ë‹«ê¸°">ë‹«ê¸°</button>
      </div>

      <div class="videoWrap">
        <video id="scanVideo" playsinline muted></video>
        <div class="scanFrame"></div>
        <div class="scanHint">
          ì œí’ˆ ë°•ìŠ¤ì˜ <b>ë°”ì½”ë“œ</b>ê°€ í”„ë ˆì„ ì•ˆì— ì˜¤ë„ë¡ ë§ì¶°ì£¼ì„¸ìš”.<br>
          ë°˜ì‚¬ë˜ë©´ ê°ë„ë¥¼ ì‚´ì§ ë°”ê¿”ì£¼ì„¸ìš”.
        </div>
      </div>

      <div class="modalBottom">
        <div class="status">
          <span id="scanStatus">ìƒíƒœ: <b>ëŒ€ê¸°</b></span>
          <span id="scanTech">ì¸ì‹: <b>ìë™</b></span>
        </div>

        <div class="inputRow">
          <input id="manualCode" type="text" inputmode="numeric" placeholder="í…ŒìŠ¤íŠ¸ìš© ì½”ë“œ ì…ë ¥ (ì˜ˆ: 1234567890123)" />
          <button class="btn secondary" id="btnUseManual" style="width:auto; padding:12px 12px; border-radius:14px;">í™•ì¸</button>
        </div>

        <button class="btn" id="btnStart">ìŠ¤ìº” ì‹œì‘</button>
      </div>
    </div>
  </div>

  <!-- AR MODAL (ì¹´ë©”ë¼ + ì˜¤ë²„ë ˆì´) -->
  <div class="modal" id="arModal" aria-hidden="true">
    <div class="modalBox">
      <div class="modalTop">
        <div class="t">AR ë³´ê¸° (í…ŒìŠ¤íŠ¸)</div>
        <button class="x" id="btnCloseAR" aria-label="ë‹«ê¸°">ë‹«ê¸°</button>
      </div>

      <div class="videoWrap">
        <video id="arVideo" playsinline muted></video>

        <div class="arOverlay">
          <div class="arHintBar">
            ğŸ“¦ ì œí’ˆ ë°•ìŠ¤ë¥¼ í™”ë©´ì— í¬ê²Œ ì¡ì•„ì£¼ì„¸ìš”. (ë°˜ì‚¬ë˜ë©´ ê°ë„ ì‚´ì§ ë³€ê²½)
          </div>

          <!-- ì˜¤ë²„ë ˆì´ ë§í’ì„  (ê³ ì • ìœ„ì¹˜, í…ŒìŠ¤íŠ¸ìš© AR ëŠë‚Œ) -->
          <div class="arTag" style="left:10px; top:34%;">
            <div class="t"><span class="dot"></span>ì„ ëª…í•œ ì‹œì•¼ ì„¤ê³„</div>
            <div class="b">ë””ì§€í„¸ í™˜ê²½ì—ì„œë„ ì‹œì•¼ ì•ˆì •ì„±ì„ ê³ ë ¤í•œ ì„¤ê³„</div>
          </div>

          <div class="arTag" style="right:10px; top:48%;">
            <div class="t"><span class="dot"></span>ì¥ì‹œê°„ ì´‰ì´‰í•¨</div>
            <div class="b">ìˆ˜ë¶„ ìœ ì§€ êµ¬ì¡°ë¡œ í•˜ë£¨ ì¢…ì¼ í¸ì•ˆí•¨ì„ ë•ìŠµë‹ˆë‹¤</div>
          </div>

          <div class="arTag" style="left:10px; bottom:18%;">
            <div class="t"><span class="dot"></span>ëˆˆì˜ í”¼ë¡œ ê³ ë ¤</div>
            <div class="b">ì‹œì„  ë³€í™”Â·ê¹œë¹¡ì„ê¹Œì§€ ê³ ë ¤í•œ ë””ìì¸</div>
          </div>
        </div>
      </div>

      <div class="modalBottom">
        <div class="status">
          <span id="arStatus">ìƒíƒœ: <b>ëŒ€ê¸°</b></span>
          <span>ë°©ì‹: <b>ì¹´ë©”ë¼ ì˜¤ë²„ë ˆì´</b></span>
        </div>
        <button class="btn" id="btnStartAR">AR ì‹œì‘</button>
      </div>
    </div>
  </div>

  <script>
    // =========================
    // 1) í…ŒìŠ¤íŠ¸ìš© ì œí’ˆ DB
    // =========================
    // TODO: ì‹¤ì œ ë°”ì½”ë“œ/íŒ©ìƒ· URLë¡œ ë°”ê¿”ì„œ ì“°ë©´ ë¨
    const PRODUCT_DB = {
      "1234567890123": {
        product_name: "ì•„íë¸Œ ë§¥ìŠ¤ ì˜¤ì•„ì‹œìŠ¤ ì›ë°ì´",
        // TODO: ì‹¤ì œ íŒ©ìƒ· ì´ë¯¸ì§€ URLë¡œ êµì²´
        product_image: "https://via.placeholder.com/600x600?text=ACUVUE+MAX+OASYS+1-Day",
        hero_title: "ëˆˆì˜ í”¼ë¡œê¹Œì§€ ê³ ë ¤í•´ ì„¤ê³„ëœ ì›ë°ì´ ë Œì¦ˆ",
        hero_sub: "ì¥ì‹œê°„ ë””ì§€í„¸ í™˜ê²½ì—ì„œë„ í¸ì•ˆí•œ ì°©ìš©ì„ ëª©í‘œë¡œ ê°œë°œë˜ì—ˆìŠµë‹ˆë‹¤",
        key_cards: [
          { icon: "ğŸ’¡", title: "ì„ ëª…í•œ ì‹œì•¼ë¥¼ ê³ ë ¤í•œ ì„¤ê³„", body: "ë””ì§€í„¸ ê¸°ê¸° ì‚¬ìš© ì‹œì—ë„ ì‹œì•¼ê°€ ì•ˆì •ì ìœ¼ë¡œ ìœ ì§€ë˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤" },
          { icon: "ğŸ’§", title: "ì¥ì‹œê°„ ì´‰ì´‰í•¨ì„ ìœ„í•œ êµ¬ì¡°", body: "ìˆ˜ë¶„ ìœ ì§€ ê¸°ìˆ ì„ ì ìš©í•´ í•˜ë£¨ ì¢…ì¼ í¸ì•ˆí•œ ì°©ìš©ì„ ë•ìŠµë‹ˆë‹¤" },
          { icon: "ğŸ‘", title: "ëˆˆì˜ í”¼ë¡œë¥¼ ê³ ë ¤í•œ ë””ìì¸", body: "ëˆˆ ê¹œë¹¡ì„ê³¼ ì‹œì„  ë³€í™”ë¥¼ ê³ ë ¤í•´ ë¶€ë‹´ì„ ì¤„ì´ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤" }
        ],
        facts: [
          { k: "ì°©ìš© ì£¼ê¸°", v: "ì›ë°ì´" },
          { k: "ë Œì¦ˆ íƒ€ì…", v: "ì†Œí”„íŠ¸ ì½˜íƒíŠ¸ë Œì¦ˆ" },
          { k: "ì„¤ê³„ í¬ì¸íŠ¸", v: "ë””ì§€í„¸ í™˜ê²½ ê³ ë ¤" }
        ],
        target_line: "ì´ ë Œì¦ˆëŠ” ìŠ¤ë§ˆíŠ¸í°Â·PC ì‚¬ìš© ì‹œê°„ì´ ê¸´ ë¼ì´í”„ìŠ¤íƒ€ì¼ì„ ê³ ë ¤í•´ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤",
        defense_copy_html: `ğŸ’¬ <b>ë‹¤ë¥¸ ë Œì¦ˆë¥¼ ì¶”ì²œë°›ìœ¼ì…”ë„,</b><br>
          ì§€ê¸ˆ ì‚¬ìš© ì¤‘ì¸ ë Œì¦ˆê°€<br>
          <b>ì‹œì•¼ ì•ˆì •ì„±ê³¼ ëˆˆì˜ í”¼ë¡œë¥¼ ê³ ë ¤í•´ ì„¤ê³„ëœ ì œí’ˆì¸ì§€</b><br>
          ë¹„êµí•´ë³´ì„¸ìš”.`
      }
    };

    // =========================
    // 2) DOM
    // =========================
    const viewEntry = document.getElementById('viewEntry');
    const viewResult = document.getElementById('viewResult');

    const envPill = document.getElementById('envPill');

    // Scan modal
    const scanModal = document.getElementById('scanModal');
    const scanVideo = document.getElementById('scanVideo');
    const btnOpenScan = document.getElementById('btnOpenScan');
    const btnGoManual = document.getElementById('btnGoManual');
    const btnCloseScan = document.getElementById('btnCloseScan');
    const btnStart = document.getElementById('btnStart');
    const btnUseManual = document.getElementById('btnUseManual');
    const manualCode = document.getElementById('manualCode');
    const scanStatus = document.getElementById('scanStatus');
    const scanTech = document.getElementById('scanTech');

    // Result
    const heroTitle = document.getElementById('heroTitle');
    const heroSub = document.getElementById('heroSub');
    const keyCards = document.getElementById('keyCards');
    const productFacts = document.getElementById('productFacts');
    const targetLine = document.getElementById('targetLine');
    const defenseCopy = document.getElementById('defenseCopy');
    const scanInfo = document.getElementById('scanInfo');
    const scanBadge = document.getElementById('scanBadge');
    const productNameEl = document.getElementById('productName');
    const productImageEl = document.getElementById('productImage');

    const btnRescan = document.getElementById('btnRescan');
    const btnBackHome = document.getElementById('btnBackHome');

    // AR modal
    const arModal = document.getElementById('arModal');
    const arVideo = document.getElementById('arVideo');
    const btnAR = document.getElementById('btnAR');
    const btnCloseAR = document.getElementById('btnCloseAR');
    const btnStartAR = document.getElementById('btnStartAR');
    const arStatus = document.getElementById('arStatus');

    // =========================
    // 3) ìƒíƒœ
    // =========================
    let scanStream = null;
    let scanDetector = null;
    let scanRAF = null;
    let scanRunning = false;

    let arStream = null;

    // =========================
    // 4) ìœ í‹¸
    // =========================
    function lookupProduct(code){
      return PRODUCT_DB[String(code || "").trim()] || null;
    }

    function setScanStatus(text, bold){
      scanStatus.innerHTML = `ìƒíƒœ: <b>${bold || ""}</b>${text ? " Â· " + text : ""}`;
    }

    function updateEnvPill(){
      const supported = ('BarcodeDetector' in window);
      envPill.textContent = supported ? "ìë™ ìŠ¤ìº” ê°€ëŠ¥" : "ìˆ˜ë™ ì…ë ¥ ê¶Œì¥";
      scanTech.innerHTML = `ì¸ì‹: <b>${supported ? "ìë™ ê°€ëŠ¥" : "ìˆ˜ë™ ì…ë ¥"}</b>`;
    }

    function openModal(modal){
      modal.classList.add('open');
      modal.setAttribute('aria-hidden', 'false');
    }

    function closeModal(modal){
      modal.classList.remove('open');
      modal.setAttribute('aria-hidden', 'true');
    }

    function showResult(product, meta){
      viewEntry.classList.add('hide');
      viewResult.classList.remove('hide');

      // Hero
      productImageEl.src = product.product_image || productImageEl.src;
      productImageEl.alt = (product.product_name || "ì œí’ˆ") + " íŒ©ìƒ·";

      // product name pill (ì•ˆì— dot í¬í•¨ë¼ìˆì–´ì„œ textë§Œ êµì²´í•˜ë©´ dotë„ ë‚ ì•„ê°)
      // â†’ innerHTMLë¡œ dot ìœ ì§€
      productNameEl.innerHTML = `<span class="miniDot"></span>${product.product_name || ""}`;

      heroTitle.textContent = product.hero_title || "";
      heroSub.textContent = product.hero_sub || "";

      // key cards
      keyCards.innerHTML = "";
      (product.key_cards || []).forEach(c => {
        const el = document.createElement('div');
        el.className = "kcard";
        el.innerHTML = `
          <div class="khead">
            <div class="ico">${c.icon || "âœ¨"}</div>
            <div>${c.title || ""}</div>
          </div>
          <div class="kbody">${c.body || ""}</div>
        `;
        keyCards.appendChild(el);
      });

      // facts
      productFacts.innerHTML = "";
      (product.facts || []).forEach(f => {
        const li = document.createElement('li');
        li.className = "li";
        li.innerHTML = `<span>${f.k}</span><b>${f.v}</b>`;
        productFacts.appendChild(li);
      });

      targetLine.textContent = product.target_line || "";
      defenseCopy.innerHTML = product.defense_copy_html || "";

      scanBadge.textContent = meta?.method || "TEST";
      scanInfo.textContent = meta?.message || "ì œí’ˆì„ ì¸ì‹í–ˆìŠµë‹ˆë‹¤.";
    }

    function backHome(){
      viewResult.classList.add('hide');
      viewEntry.classList.remove('hide');
    }

    // =========================
    // 5) ìŠ¤ìº” (BarcodeDetector)
    // =========================
    function initScanDetector(){
      if(!('BarcodeDetector' in window)) return null;
      try{
        return new BarcodeDetector({ formats: ["ean_13","ean_8","code_128","qr_code"] });
      }catch(e){
        return null;
      }
    }

    async function startScanCamera(){
      const constraints = {
        video: {
          facingMode: { ideal: "environment" },
          width: { ideal: 1280 },
          height: { ideal: 720 }
        },
        audio: false
      };
      scanStream = await navigator.mediaDevices.getUserMedia(constraints);
      scanVideo.srcObject = scanStream;
      await scanVideo.play();
    }

    function stopScanCamera(){
      if(scanStream){
        scanStream.getTracks().forEach(t => t.stop());
        scanStream = null;
      }
      if(scanVideo){
        scanVideo.pause();
        scanVideo.srcObject = null;
      }
    }

    async function scanLoop(){
      if(!scanRunning || !scanDetector) return;
      try{
        const codes = await scanDetector.detect(scanVideo);
        if(codes && codes.length){
          const code = codes[0].rawValue;
          handleScanSuccess(code, "ì¹´ë©”ë¼(ìë™)");
          return;
        }
      }catch(e){}
      scanRAF = requestAnimationFrame(scanLoop);
    }

    async function startScan(){
      try{
        if(!navigator.mediaDevices?.getUserMedia){
          setScanStatus("ì´ ê¸°ê¸°ëŠ” ì¹´ë©”ë¼ë¥¼ ì§€ì›í•˜ì§€ ì•Šì•„ìš”.", "ì‹¤íŒ¨");
          return;
        }
        setScanStatus("ì¹´ë©”ë¼ ì¤€ë¹„ ì¤‘â€¦", "ì§„í–‰");
        await startScanCamera();

        scanDetector = initScanDetector();
        if(scanDetector){
          scanRunning = true;
          setScanStatus("ë°”ì½”ë“œë¥¼ í”„ë ˆì„ì— ë§ì¶°ì£¼ì„¸ìš”", "ìŠ¤ìº” ì¤‘");
          scanRAF = requestAnimationFrame(scanLoop);
        }else{
          setScanStatus("ìë™ ì¸ì‹ ë¯¸ì§€ì› â†’ ì•„ë˜ì— ì½”ë“œ ì…ë ¥", "ì•ˆë‚´");
        }
      }catch(err){
        setScanStatus("ì¹´ë©”ë¼ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.", "ì‹¤íŒ¨");
      }
    }

    function stopScan(){
      scanRunning = false;
      if(scanRAF) cancelAnimationFrame(scanRAF);
      scanRAF = null;
      scanDetector = null;
      stopScanCamera();
      setScanStatus("", "ëŒ€ê¸°");
    }

    function openScanModal(){
      openModal(scanModal);
      manualCode.value = "";
      setScanStatus("", "ëŒ€ê¸°");
      updateEnvPill();
    }

    function closeScanModal(){
      stopScan();
      closeModal(scanModal);
    }

    function handleScanSuccess(code, method){
      const product = lookupProduct(code);
      closeScanModal();

      if(product){
        showResult(product, { method, message: `ì œí’ˆì„ ì¸ì‹í–ˆìŠµë‹ˆë‹¤. (ì½”ë“œ: ${code})` });
      }else{
        alert(`ì¸ì‹ëœ ì½”ë“œ(${code})ê°€ í…ŒìŠ¤íŠ¸ DBì— ì—†ìŠµë‹ˆë‹¤.\nPRODUCT_DBì— ë°”ì½”ë“œë¥¼ ì¶”ê°€í•´ ì£¼ì„¸ìš”.`);
        backHome();
      }
    }

    // =========================
    // 6) AR (ì¹´ë©”ë¼ ì˜¤ë²„ë ˆì´)
    // =========================
    function setARStatus(text, bold){
      arStatus.innerHTML = `ìƒíƒœ: <b>${bold || ""}</b>${text ? " Â· " + text : ""}`;
    }

    async function startARCamera(){
      const constraints = {
        video: { facingMode: { ideal: "environment" }, width: { ideal: 1280 }, height: { ideal: 720 } },
        audio: false
      };
      arStream = await navigator.mediaDevices.getUserMedia(constraints);
      arVideo.srcObject = arStream;
      await arVideo.play();
    }

    function stopARCamera(){
      if(arStream){
        arStream.getTracks().forEach(t => t.stop());
        arStream = null;
      }
      if(arVideo){
        arVideo.pause();
        arVideo.srcObject = null;
      }
    }

    function openARModal(){
      openModal(arModal);
      setARStatus("", "ëŒ€ê¸°");
    }

    function closeARModal(){
      stopARCamera();
      closeModal(arModal);
      setARStatus("", "ëŒ€ê¸°");
    }

    async function startAR(){
      try{
        if(!navigator.mediaDevices?.getUserMedia){
          setARStatus("ì´ ê¸°ê¸°ëŠ” ì¹´ë©”ë¼ë¥¼ ì§€ì›í•˜ì§€ ì•Šì•„ìš”.", "ì‹¤íŒ¨");
          return;
        }
        setARStatus("ì¹´ë©”ë¼ ì¤€ë¹„ ì¤‘â€¦", "ì§„í–‰");
        await startARCamera();
        setARStatus("ì œí’ˆì„ í™”ë©´ì— í¬ê²Œ ì¡ì•„ì£¼ì„¸ìš”", "ì‹¤í–‰ ì¤‘");
      }catch(e){
        setARStatus("ì¹´ë©”ë¼ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.", "ì‹¤íŒ¨");
      }
    }

    // =========================
    // 7) ì´ë²¤íŠ¸
    // =========================
    btnOpenScan.addEventListener('click', openScanModal);
    btnGoManual.addEventListener('click', () => { openScanModal(); manualCode.focus(); setScanStatus("í…ŒìŠ¤íŠ¸ìš© ì½”ë“œ ì…ë ¥", "ì•ˆë‚´"); });

    btnCloseScan.addEventListener('click', closeScanModal);
    scanModal.addEventListener('click', (e) => { if(e.target === scanModal) closeScanModal(); });

    btnStart.addEventListener('click', startScan);

    btnUseManual.addEventListener('click', () => {
      const code = manualCode.value.trim();
      if(!code){
        alert("í…ŒìŠ¤íŠ¸ìš© ì½”ë“œë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”. ì˜ˆ: 1234567890123");
        return;
      }
      handleScanSuccess(code, "ìˆ˜ë™ ì…ë ¥");
    });

    btnRescan.addEventListener('click', openScanModal);
    btnBackHome.addEventListener('click', backHome);

    btnAR.addEventListener('click', openARModal);
    btnCloseAR.addEventListener('click', closeARModal);
    arModal.addEventListener('click', (e) => { if(e.target === arModal) closeARModal(); });
    btnStartAR.addEventListener('click', startAR);

    // ì´ˆê¸°
    updateEnvPill();

    // í…ŒìŠ¤íŠ¸ìš©: ì²˜ìŒì—” ìˆ˜ë™ì½”ë“œë¡œ ë°”ë¡œ ê²°ê³¼ ë³´ê³  ì‹¶ìœ¼ë©´ ì•„ë˜ í•œ ì¤„ ì£¼ì„ í•´ì œ
    // showResult(PRODUCT_DB["1234567890123"], { method: "TEST", message: "í…ŒìŠ¤íŠ¸ í™”ë©´" });
  </script>
</body>
</html>

