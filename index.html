<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ì œí’ˆ í´ë¦­ â†’ 360Â° ë Œì¦ˆ + ëˆˆê¹œë°•ì„ ì•ˆì°©</title>

  <style>
    :root{
      --bg:#f6f8fc;
      --surface:#ffffff;
      --text:#0b1220;
      --muted:#5b6475;
      --brand:#0b4aa2;
      --brand2:#1e78ff;
      --line:#e6e9f2;
      --shadow: 0 10px 28px rgba(16,24,40,0.10);
      --shadow2: 0 6px 16px rgba(16,24,40,0.08);
      --radius: 18px;
      --green:#18a85b;
      --green2:#0f8b49;
      --max: 760px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      background:
        radial-gradient(1200px 500px at 20% -10%, rgba(30,120,255,0.12), transparent 60%),
        radial-gradient(900px 450px at 90% 0%, rgba(11,74,162,0.10), transparent 55%),
        var(--bg);
      color:var(--text);
      font-family:-apple-system,BlinkMacSystemFont,"Apple SD Gothic Neo","Noto Sans KR","Malgun Gothic",Arial,sans-serif;
      line-height:1.35;
    }

    .wrap{ max-width: var(--max); margin:0 auto; padding: 18px 16px 44px; }

    header{
      position: sticky; top: 0; z-index: 5;
      padding: 12px 0 12px;
      backdrop-filter: blur(10px);
      background: rgba(246,248,252,0.72);
      border-bottom: 1px solid rgba(230,233,242,0.75);
    }
    .headRow{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
    .brandBox{ display:flex; flex-direction:column; gap:2px; min-width:0; }
    .brandBox .title{ font-weight:950; letter-spacing:-0.45px; font-size:16px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .brandBox .sub{ font-size:12px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

    .pill{
      font-size:12px; padding:8px 10px;
      border:1px solid var(--line);
      border-radius:999px;
      color:var(--muted);
      background: rgba(255,255,255,0.9);
      box-shadow: 0 2px 10px rgba(16,24,40,0.06);
      flex: 0 0 auto;
    }

    .card{
      background: var(--surface);
      border: 1px solid rgba(230,233,242,0.9);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: var(--shadow);
    }

    .listTitle{
      font-size:18px;
      font-weight:980;
      letter-spacing:-0.6px;
      margin: 8px 0 10px;
    }

    .productCard{
      border: 1px solid rgba(230,233,242,0.95);
      border-radius: 16px;
      padding: 14px;
      display:flex;
      gap:12px;
      align-items:center;
      box-shadow: var(--shadow2);
      background: rgba(255,255,255,0.96);
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .productCard:active{ transform: scale(0.99); }
    .productCard:hover{ box-shadow: 0 12px 26px rgba(16,24,40,0.10); }

    .pThumb{
      width: 86px;
      height: 52px;
      border-radius: 12px;
      border: 1px solid rgba(230,233,242,0.95);
      background:
        radial-gradient(120px 60px at 30% 30%, rgba(30,120,255,0.22), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,0.92), rgba(255,255,255,0.72));
      display:grid;
      place-items:center;
      font-weight:950;
      color: rgba(11,74,162,0.9);
      letter-spacing:-0.2px;
      flex: 0 0 auto;
      text-align:center;
      font-size:12px;
      line-height:1.05;
    }

    .pInfo{ min-width:0; flex:1; }
    .pName{ font-weight:980; letter-spacing:-0.4px; font-size:15px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .pDesc{ margin-top:4px; font-size:12px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .chips{ margin-top:8px; display:flex; gap:8px; flex-wrap:wrap; }
    .chip{
      font-size:12px;
      padding:7px 10px;
      border-radius: 999px;
      background: rgba(11,74,162,0.06);
      border: 1px solid rgba(11,74,162,0.10);
      color: rgba(11,74,162,0.95);
      font-weight: 900;
      letter-spacing:-0.2px;
    }

    .arrow{
      width: 34px; height: 34px;
      border-radius: 12px;
      border: 1px solid rgba(230,233,242,0.95);
      background: rgba(255,255,255,0.92);
      display:grid;
      place-items:center;
      color: rgba(11,74,162,0.9);
      font-weight: 950;
      box-shadow: var(--shadow2);
      flex: 0 0 auto;
    }

    .gap{ height: 12px; }

    /* ========== MODAL ========== */
    .modal{
      position: fixed; inset:0;
      background: rgba(0,0,0,0.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 16px;
      z-index: 50;
    }
    .modal.open{ display:flex; }

    .modalBox{
      width:100%;
      max-width: 680px;
      background:#fff;
      border-radius: var(--radius);
      overflow:hidden;
      border: 1px solid rgba(230,233,242,0.95);
      box-shadow: var(--shadow);
      transform: translateY(6px) scale(0.99);
      opacity: 0;
      transition: transform .18s ease, opacity .18s ease;
    }
    .modal.open .modalBox{
      transform: translateY(0) scale(1);
      opacity: 1;
    }

    .modalTop{
      padding: 12px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom: 1px solid rgba(230,233,242,0.95);
      background: rgba(255,255,255,0.92);
      backdrop-filter: blur(10px);
    }
    .modalTop .t{ font-weight: 980; letter-spacing:-0.3px; }

    .x{
      border:1px solid rgba(230,233,242,0.95);
      background:#fff;
      font-size:14px;
      font-weight:950;
      cursor:pointer;
      padding: 10px 12px;
      border-radius: 12px;
      box-shadow: var(--shadow2);
    }

    .stage{
      position: relative;
      width:100%;
      aspect-ratio: 3 / 4;
      background:
        radial-gradient(720px 360px at 50% 8%, rgba(30,120,255,0.22), transparent 62%),
        radial-gradient(660px 360px at 0% 40%, rgba(11,74,162,0.12), transparent 60%),
        linear-gradient(180deg, #1a2636 0%, #0f1726 100%);
      overflow:hidden;
      touch-action: none; /* 3D ë“œë˜ê·¸ê°€ ë¶€ë“œëŸ½ê²Œ */
    }

    /* ìƒë‹¨ ì œí’ˆëª… */
    .headerBar{
      position:absolute; left:10px; right:10px; top:10px;
      background: rgba(255,255,255,0.92);
      border: 1px solid rgba(230,233,242,0.9);
      border-radius: 16px;
      padding: 10px 12px;
      box-shadow: var(--shadow2);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      backdrop-filter: blur(10px);
      pointer-events:none;
    }
    .headerBar .name{
      font-weight:980; letter-spacing:-0.2px; font-size:13px;
      color: var(--text);
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }

    /* ìš°ì¸¡ ë²„íŠ¼ë“¤ */
    .points{
      position:absolute;
      right: 10px;
      top: 56px;
      display:flex;
      flex-direction:column;
      gap:10px;
      pointer-events:auto;
      z-index: 5;
    }
    .ptBtn{
      width: 46px; height: 46px;
      border-radius: 999px;
      border: 1px solid rgba(230,233,242,0.95);
      background: rgba(255,255,255,0.92);
      box-shadow: var(--shadow2);
      display:grid;
      place-items:center;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;
    }
    .ptBtn.active{
      border-color: rgba(11,74,162,0.35);
      box-shadow: 0 10px 24px rgba(11,74,162,0.18);
      transform: translateY(-1px);
    }
    .ptIcon{
      width: 28px; height: 28px;
      border-radius: 999px;
      display:grid;
      place-items:center;
      font-size: 12px;
      background: rgba(11,74,162,0.10);
      border: 1px solid rgba(11,74,162,0.16);
      font-weight: 950;
    }

    /* 3D ë Œë”ë§ ì˜ì—­ */
    #view3d{
      position:absolute;
      left: 50%;
      top: 41%;
      transform: translate(-50%,-50%);
      width: min(88vw, 520px);
      height: min(88vw, 520px);
      filter: drop-shadow(0 22px 30px rgba(0,0,0,0.22));
      z-index: 2;
      border-radius: 999px;
      overflow: visible;
    }
    canvas{ display:block; }

    /* â€œëˆˆ(ë§ˆìŠ¤í¬) + ëˆˆêº¼í’€â€ ì˜¤ë²„ë ˆì´ */
    .eyeOverlay{
      position:absolute;
      left: 50%;
      top: 41%;
      transform: translate(-50%,-50%);
      width: min(88vw, 520px);
      height: min(62vw, 360px);
      pointer-events:none;
      z-index: 3;
    }
    .eyeShape{
      position:absolute; inset:0;
      border-radius: 999px;
      background:
        radial-gradient(60% 80% at 50% 50%, rgba(255,255,255,0.08), rgba(255,255,255,0.00) 60%),
        radial-gradient(40% 50% at 50% 50%, rgba(30,120,255,0.08), transparent 70%);
      border: 1px solid rgba(255,255,255,0.14);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.06);
      clip-path: ellipse(48% 38% at 50% 50%);
    }
    .lidTop, .lidBottom{
      position:absolute;
      left: 0; right: 0;
      height: 52%;
      background: linear-gradient(180deg, rgba(15,23,38,0.98), rgba(15,23,38,0.60));
      filter: blur(0.2px);
      opacity: 0;
      transform: translateY(-18%);
      transition: opacity .18s ease, transform .18s ease;
    }
    .lidBottom{
      bottom:0;
      background: linear-gradient(0deg, rgba(15,23,38,0.98), rgba(15,23,38,0.60));
      transform: translateY(18%);
    }
    .blink .lidTop{ opacity: 1; transform: translateY(22%); }
    .blink .lidBottom{ opacity: 1; transform: translateY(-22%); }

    /* í•˜ë‹¨ ê·¸ë¦° íŒ¨ë„(ë” ì–‡ê²Œ) */
    .greenPanel{
      position:absolute;
      left:0; right:0;
      bottom: 60px;
      margin: 0 10px;
      background: linear-gradient(180deg, var(--green), var(--green2));
      color:#fff;
      border-radius: 14px;
      padding: 10px 14px 10px;
      box-shadow: var(--shadow);
      pointer-events:none;
      z-index: 4;
    }
    .greenTitle{
      font-weight:980;
      letter-spacing:-0.45px;
      font-size: 14px;
      margin:0 0 6px;
      line-height:1.15;
      text-align:center;
    }
    .greenBody{
      font-size: 12.5px;
      line-height:1.45;
      opacity: 0.96;
      text-align:center;
    }
    .greenSubBox{
      margin: 7px auto 0;
      max-width: 92%;
      background: rgba(0,0,0,0.16);
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: 10px;
      padding: 8px 10px;
      font-size: 12px;
      line-height:1.45;
      text-align:center;
      opacity:0.95;
    }

    .badgeRow{
      margin-top: 7px;
      display:flex;
      justify-content:center;
      pointer-events:none;
    }
    .badge{
      background: rgba(0,0,0,0.20);
      border: 1px solid rgba(255,255,255,0.20);
      padding: 8px 10px;
      border-radius: 999px;
      font-weight: 950;
      font-size: 12px;
      letter-spacing:-0.2px;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,0.08);
    }

    .modalBottom{
      padding: 12px 14px 14px;
      border-top: 1px solid rgba(230,233,242,0.95);
      display:grid;
      gap: 10px;
      background: rgba(255,255,255,0.98);
    }
    .status{
      font-size: 13px;
      color: var(--muted);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .status b{ color: var(--text); }

    .btn{
      width:100%;
      border:0;
      border-radius: 14px;
      padding: 13px 14px;
      font-size: 15px;
      font-weight: 950;
      background: linear-gradient(180deg, var(--brand2), var(--brand));
      color: #fff;
      cursor:pointer;
      box-shadow: 0 10px 22px rgba(11,74,162,0.22);
    }
    .btn:active{ transform: translateY(1px); }
    .btn.secondary{
      background: rgba(255,255,255,0.96);
      color: var(--text);
      border:1px solid var(--line);
      font-weight: 950;
      box-shadow: var(--shadow2);
    }

    .actionRow{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      align-items:stretch;
    }

    .miniHelp{ font-size:12px; color:var(--muted); line-height:1.45; }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="headRow">
        <div class="brandBox">
          <div class="title">ì•Œë¦¼í†¡ ëœë”© (í…ŒìŠ¤íŠ¸)</div>
          <div class="sub">ì œí’ˆ ì¹´ë“œ í´ë¦­ â†’ 360Â° ë Œì¦ˆ í”„ë¦¬ë·° + ëˆˆê¹œë°•ì„ ì•ˆì°©</div>
        </div>
        <div class="pill">ìŠ¤ìº”/AR ì—†ìŒ</div>
      </div>
    </header>

    <section>
      <div class="card">
        <div class="listTitle">ì•„íë¸ŒÂ® ì½˜íƒíŠ¸ë Œì¦ˆ</div>

        <div class="productCard" data-product="omax">
          <div class="pThumb">OASYS<br>MAX</div>
          <div class="pInfo">
            <div class="pName">ì•„íë¸Œ ì˜¤ì•„ì‹œìŠ¤ ë§¥ìŠ¤ ì›ë°ì´</div>
            <div class="pDesc">í´ë¦­í•˜ë©´ 360Â°ë¡œ ëŒë ¤ë³´ê³  â€œê¹œë°•ì„ ì•ˆì°©â€ì„ ì²´í—˜</div>
            <div class="chips">
              <div class="chip">#360íšŒì „</div>
              <div class="chip">#ëˆˆê¹œë°•ì„</div>
              <div class="chip">#ì•ˆì°©</div>
            </div>
          </div>
          <div class="arrow">â€º</div>
        </div>

        <div class="gap"></div>

        <div class="productCard" data-product="toric">
          <div class="pThumb">TORIC<br>DEMO</div>
          <div class="pInfo">
            <div class="pName">ë‚œì‹œ ë Œì¦ˆ(ë°ëª¨)</div>
            <div class="pDesc">í•«ìŠ¤íŒŸ 3ê°œ + ì‚¬ìš©/ê´€ë¦¬/ì£¼ì˜ì‚¬í•­ê¹Œì§€ í•œ í™”ë©´</div>
            <div class="chips">
              <div class="chip">#í•«ìŠ¤íŒŸ3</div>
              <div class="chip">#ì°©ìš©/ì œê±°</div>
              <div class="chip">#ê´€ë¦¬</div>
            </div>
          </div>
          <div class="arrow">â€º</div>
        </div>

        <div class="gap"></div>

        <div style="font-size:12px; color:var(--muted);">
          * ì§€ê¸ˆì€ â€œìš°ì•„í•œ ì¸í„°ë™ì…˜ í…ŒìŠ¤íŠ¸â€ìš©. ë¬¸êµ¬/ì´ë¯¸ì§€/í•«ìŠ¤íŒŸì€ ì œí’ˆë³„ë¡œ êµì²´í•˜ë©´ ë¼.
        </div>
      </div>
    </section>
  </div>

  <!-- ê²°ê³¼ ëª¨ë‹¬ -->
  <div class="modal" id="resultModal" aria-hidden="true">
    <div class="modalBox">
      <div class="modalTop">
        <div class="t">ê²°ê³¼</div>
        <button class="x" id="btnCloseResult">ë‹«ê¸°</button>
      </div>

      <div class="stage" id="stage">
        <div class="headerBar">
          <div class="name" id="productTop">ì•„íë¸Œ ì˜¤ì•„ì‹œìŠ¤ ë§¥ìŠ¤</div>
          <div class="name" style="font-weight:900; color: rgba(255,255,255,.0); font-size:12px;"></div>
        </div>

        <div class="points" id="points"></div>

        <!-- 3D -->
        <div id="view3d"></div>

        <!-- ëˆˆ/ëˆˆêº¼í’€ ì˜¤ë²„ë ˆì´ -->
        <div class="eyeOverlay" id="eyeOverlay">
          <div class="eyeShape"></div>
          <div class="lidTop"></div>
          <div class="lidBottom"></div>
        </div>

        <!-- ì •ë³´ íŒ¨ë„ -->
        <div class="greenPanel">
          <div class="greenTitle" id="greenTitle"></div>
          <div class="greenBody" id="greenBody"></div>
          <div class="badgeRow" id="badgeRow" style="display:none;">
            <div class="badge" id="badgeText"></div>
          </div>
          <div class="greenSubBox" id="greenSub"></div>
        </div>
      </div>

      <div class="modalBottom">
        <div class="status">
          <span id="resStatus">ìƒíƒœ: <b>ì‹¤í–‰ ì¤‘</b></span>
          <span>ì¡°ì‘: <b>ì†ê°€ë½ ë“œë˜ê·¸(360Â°)</b></span>
        </div>

        <div class="actionRow">
          <button class="btn secondary" id="btnBack">ëª©ë¡ìœ¼ë¡œ</button>
          <button class="btn" id="btnBlink">ëˆˆ ê¹œë°•ì„(ì•ˆì°©)</button>
        </div>

        <div class="miniHelp">
          * â€œëˆˆ ê¹œë°•ì„â€ì„ ëˆ„ë¥´ë©´ ëˆˆêº¼í’€ì´ ì‹¤ì œë¡œ ë‹«í˜”ë‹¤ ì—´ë¦¬ë©´ì„œ ë Œì¦ˆê°€ ì¤‘ì•™ìœ¼ë¡œ ìŠ¤ëƒ…(ì•ˆì°©)ë©ë‹ˆë‹¤.
        </div>
      </div>
    </div>
  </div>

  <!-- three.js -->
  <script type="module">
    import * as THREE from "https://unpkg.com/three@0.160.0/build/three.module.js";
    import { OrbitControls } from "https://unpkg.com/three@0.160.0/examples/jsm/controls/OrbitControls.js";

    // =========================
    // 1) ì´ë¯¸ì§€(ë„ˆê°€ ì¤€ ìŠ¤í¬ë¦°ìƒ· ê¸°ë°˜)
    //    - ì›í˜• ë§ˆìŠ¤í‚¹í•´ì„œ â€œë Œì¦ˆ í…ìŠ¤ì²˜â€ë¡œ ì‚¬ìš©
    // =========================
    const LENS_IMAGE_DATA_URI = `REPLACE_ME_DATA_URI`;

    // ====== ë„ˆê°€ ì¤€ ì´ë¯¸ì§€(ìŠ¤í¬ë¦°ìƒ·)ì—ì„œ ìë™ ì›í˜• ë§ˆìŠ¤í¬ í…ìŠ¤ì²˜ ë§Œë“¤ê¸° ======
    async function makeCircularTextureFromDataUri(dataUri){
      const img = new Image();
      img.crossOrigin = "anonymous";
      img.src = dataUri;
      await img.decode();

      // ìº”ë²„ìŠ¤ì— ì›í˜• í´ë¦½
      const size = 1024;
      const c = document.createElement("canvas");
      c.width = size; c.height = size;
      const ctx = c.getContext("2d");

      // ë°°ê²½ íˆ¬ëª…
      ctx.clearRect(0,0,size,size);

      // ì›í˜• clip
      ctx.save();
      ctx.beginPath();
      ctx.arc(size/2, size/2, size*0.46, 0, Math.PI*2);
      ctx.closePath();
      ctx.clip();

      // ì´ë¯¸ì§€ë¥¼ ì¤‘ì•™ì— ê½‰ ì°¨ê²Œ
      // (ìŠ¤í¬ë¦°ìƒ·ì´ë¼ ì—¬ë°±ì´ ìˆì„ ìˆ˜ ìˆì–´. ì¢€ ë” í¬ê²Œ ì¡ì•„ì„œ ë Œì¦ˆê°€ ê½‰ ì°¨ê²Œ ë³´ì´ë„ë¡)
      const scale = Math.max(size / img.width, size / img.height) * 1.15;
      const w = img.width * scale;
      const h = img.height * scale;
      ctx.globalAlpha = 0.95;
      ctx.drawImage(img, (size - w)/2, (size - h)/2, w, h);

      ctx.restore();

      // ë Œì¦ˆ ì™¸ê³½ ë§(ê³ ê¸‰ ëŠë‚Œ)
      ctx.save();
      ctx.strokeStyle = "rgba(255,255,255,0.35)";
      ctx.lineWidth = 6;
      ctx.beginPath();
      ctx.arc(size/2, size/2, size*0.46, 0, Math.PI*2);
      ctx.stroke();
      ctx.restore();

      const texture = new THREE.CanvasTexture(c);
      texture.colorSpace = THREE.SRGBColorSpace;
      texture.anisotropy = 8;
      texture.needsUpdate = true;
      return texture;
    }

    // =========================
    // 2) ì œí’ˆ/ì½˜í…ì¸ (í…ŒìŠ¤íŠ¸ìš©)
    // =========================
    const PRODUCTS = {
      omax: {
        name: "ì•„íë¸Œ ì˜¤ì•„ì‹œìŠ¤ ë§¥ìŠ¤ (í…ŒìŠ¤íŠ¸)",
        default: {
          title: "ì œí’ˆì„ 360Â°ë¡œ ëŒë ¤ë³´ê³  í•µì‹¬ í¬ì¸íŠ¸ë¥¼ í•œ ë²ˆì—",
          body: "ì†ê°€ë½ìœ¼ë¡œ ë“œë˜ê·¸í•˜ë©´ íšŒì „í•˜ê³ , â€œëˆˆ ê¹œë°•ì„â€ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë Œì¦ˆê°€ ì¤‘ì•™ìœ¼ë¡œ ì•ˆì°©ë©ë‹ˆë‹¤.",
          sub: "â€» ë¬¸êµ¬/ìˆ˜ì¹˜/ì£¼ì˜ì‚¬í•­ì€ ë‚´ë¶€ í™•ì •ë³¸ìœ¼ë¡œ êµì²´"
        },
        points: [
          { icon:"ğŸ’§", mode:"TEAR", title:"ì´‰ì´‰í•¨ í¬ì¸íŠ¸", body:"ìˆ˜ë¶„/ìŠµìœ¤ ê´€ë ¨ í•µì‹¬ì„ 1ì¤„ë¡œ", sub:"ì¶”í›„ êµì²´" },
          { icon:"123", mode:"MARK", title:"í‘œì‹/ë°©í–¥ ê°€ì´ë“œ", body:"ë’¤ì§‘í˜/ë°©í–¥ í™•ì¸ ê´€ë ¨", sub:"ì¶”í›„ êµì²´" },
          { icon:"ğŸ‘ï¸", mode:"BLINK", title:"ëˆˆ ê¹œë°•ì„(ì•ˆì°©)", body:"ê¹œë°•ì„ ëª¨ì…˜ê³¼ í•¨ê»˜ ë Œì¦ˆê°€ ì •ë ¬ë©ë‹ˆë‹¤.", sub:"ì²´í—˜ìš© ì¸í„°ë™ì…˜" }
        ],
        badge: "360Â° íšŒì „ + ì•ˆì°© ë°ëª¨"
      },
      toric: {
        name: "ë‚œì‹œ ë Œì¦ˆ(ë°ëª¨)",
        default: {
          title: "í•«ìŠ¤íŒŸ 3ê°œ + ì‚¬ìš©/ê´€ë¦¬/ì£¼ì˜ì‚¬í•­ì„ í•œ ë²ˆì—",
          body: "í•µì‹¬ í¬ì¸íŠ¸ 3ê°œë§Œ â€˜ê°€ë³ê²Œâ€™ ë³´ì—¬ì£¼ê³ , ì•„ë˜ì—ì„œ ì°©ìš©/ì œê±°/ê´€ë¦¬ê¹Œì§€ ì´ì–´ì§‘ë‹ˆë‹¤.",
          sub: "â€» ìƒì„¸ ì½˜í…ì¸ ëŠ” ë„ˆê°€ ì£¼ë©´ ê·¸ëŒ€ë¡œ ê½‚ì•„ì¤„ê²Œ"
        },
        points: [
          { icon:"ğŸ¯", mode:"HOT1", title:"í•«ìŠ¤íŒŸ 1", body:"í•œ ì¤„ ì„¤ëª…", sub:"ì¶”í›„ êµì²´" },
          { icon:"ğŸ¯", mode:"HOT2", title:"í•«ìŠ¤íŒŸ 2", body:"í•œ ì¤„ ì„¤ëª…", sub:"ì¶”í›„ êµì²´" },
          { icon:"ğŸ‘ï¸", mode:"BLINK", title:"ëˆˆ ê¹œë°•ì„(ì•ˆì°©)", body:"ê¹œë°•ì„ìœ¼ë¡œ ë Œì¦ˆê°€ ì•ˆì •í™”ë˜ëŠ” ì—°ì¶œ", sub:"ì²´í—˜ìš©" }
        ],
        badge: "í•«ìŠ¤íŒŸ 3ê°œ í…œí”Œë¦¿"
      }
    };

    // =========================
    // DOM
    // =========================
    const resultModal = document.getElementById("resultModal");
    const btnCloseResult = document.getElementById("btnCloseResult");
    const btnBack = document.getElementById("btnBack");
    const btnBlink = document.getElementById("btnBlink");

    const productTop = document.getElementById("productTop");
    const pointsEl = document.getElementById("points");

    const greenTitle = document.getElementById("greenTitle");
    const greenBody  = document.getElementById("greenBody");
    const greenSub   = document.getElementById("greenSub");

    const badgeRow = document.getElementById("badgeRow");
    const badgeText = document.getElementById("badgeText");

    const eyeOverlay = document.getElementById("eyeOverlay");
    const stage = document.getElementById("stage");
    const view3d = document.getElementById("view3d");

    function openModal(modal){
      modal.classList.add("open");
      modal.setAttribute("aria-hidden","false");
    }
    function closeModal(modal){
      modal.classList.remove("open");
      modal.setAttribute("aria-hidden","true");
    }

    btnCloseResult.addEventListener("click", ()=> closeModal(resultModal));
    resultModal.addEventListener("click", (e)=>{ if(e.target===resultModal) closeModal(resultModal); });
    btnBack.addEventListener("click", ()=> closeModal(resultModal));

    // =========================
    // 3D Setup
    // =========================
    let renderer, scene, camera, controls;
    let lensMesh, ringMesh;
    let textureReady = false;

    // â€œì•ˆì°©â€ ìƒíƒœê°’
    let settling = false;
    let settleT = 0;
    let targetRot = new THREE.Euler(0,0,0);
    let targetPos = new THREE.Vector3(0, 0, 0);

    function init3D(){
      scene = new THREE.Scene();

      const w = view3d.clientWidth;
      const h = view3d.clientHeight;

      camera = new THREE.PerspectiveCamera(35, w/h, 0.1, 100);
      camera.position.set(0, 0.2, 4.0);

      renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true });
      renderer.setSize(w, h);
      renderer.setPixelRatio(Math.min(window.devicePixelRatio || 1, 2));
      renderer.outputColorSpace = THREE.SRGBColorSpace;
      view3d.innerHTML = "";
      view3d.appendChild(renderer.domElement);

      // light
      const key = new THREE.DirectionalLight(0xffffff, 1.1);
      key.position.set(2,2,3);
      scene.add(key);

      const fill = new THREE.DirectionalLight(0xffffff, 0.55);
      fill.position.set(-2,1,2);
      scene.add(fill);

      const amb = new THREE.AmbientLight(0xffffff, 0.55);
      scene.add(amb);

      // controls (ì†ê°€ë½ 360Â° íšŒì „)
      controls = new OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.dampingFactor = 0.07;
      controls.enablePan = false;
      controls.minDistance = 2.7;
      controls.maxDistance = 6.0;
      controls.rotateSpeed = 0.65;
      controls.touches = { ONE: THREE.TOUCH.ROTATE, TWO: THREE.TOUCH.DOLLY_PAN };
      controls.target.set(0, 0, 0);

      // placeholder lens (texture load í›„ êµì²´)
      const geo = new THREE.CircleGeometry(1.55, 128);
      const mat = new THREE.MeshPhysicalMaterial({
        color: 0xffffff,
        transparent: true,
        opacity: 0.88,
        roughness: 0.15,
        metalness: 0.0,
        transmission: 0.55,
        thickness: 0.6,
        clearcoat: 1.0,
        clearcoatRoughness: 0.12
      });
      lensMesh = new THREE.Mesh(geo, mat);
      lensMesh.rotation.x = -0.15;
      lensMesh.position.set(0, 0, 0);
      scene.add(lensMesh);

      // subtle ring (ìš°ì•„í•œ ëŠë‚Œ)
      const ringGeo = new THREE.RingGeometry(1.52, 1.58, 128);
      const ringMat = new THREE.MeshBasicMaterial({ color: 0xffffff, transparent:true, opacity:0.22 });
      ringMesh = new THREE.Mesh(ringGeo, ringMat);
      ringMesh.rotation.x = -0.15;
      scene.add(ringMesh);

      window.addEventListener("resize", onResize);
    }

    function onResize(){
      if(!renderer || !camera) return;
      const w = view3d.clientWidth;
      const h = view3d.clientHeight;
      renderer.setSize(w,h);
      camera.aspect = w/h;
      camera.updateProjectionMatrix();
    }

    // =========================
    // Blink + settle animation
    // =========================
    function doBlinkAndSettle(){
      // ëˆˆêº¼í’€ â€œì‹¤ì œ ê¹œë°•ì„â€ ì—°ì¶œ
      eyeOverlay.classList.add("blink");
      setTimeout(()=> eyeOverlay.classList.remove("blink"), 220);

      // ë Œì¦ˆ ì•ˆì°©(ì„¼í„° ìŠ¤ëƒ… + ë¯¸ì„¸ íšŒì „ ì•ˆì •í™”)
      settling = true;
      settleT = 0;

      // í˜„ì¬ íšŒì „ì—ì„œ â€œê°€ê¹Œìš´ ì •ë ¬ ê°ë„â€ë¡œ ìŠ¤ëƒ… (ë°ëª¨ìš©: Yì¶•ì„ 0ì— ê°€ê¹Œìš´ ê°’ìœ¼ë¡œ)
      // ì‹¤ì œ ë‚œì‹œ ì•ˆì •í™” í‘œí˜„ì„ ì›í•˜ë©´: â€œì¶•â€ í‘œì‹œ + íŠ¹ì • ê°ë„ë¡œ ìŠ¤ëƒ… êµ¬í˜„ ê°€ëŠ¥
      targetRot.set(-0.15, 0, 0);
      targetPos.set(0, 0, 0);
    }

    // =========================
    // UI: í¬ì¸íŠ¸ ë²„íŠ¼
    // =========================
    function setPanel({title, body, sub, badge}){
      greenTitle.textContent = title || "";
      greenBody.textContent = body || "";
      greenSub.textContent = sub || "";
      if(badge){
        badgeRow.style.display = "flex";
        badgeText.textContent = badge;
      }else{
        badgeRow.style.display = "none";
      }
    }

    function renderPoints(product){
      pointsEl.innerHTML = "";
      product.points.forEach((p, idx)=>{
        const btn = document.createElement("div");
        btn.className = "ptBtn";
        btn.innerHTML = `<div class="ptIcon">${p.icon}</div>`;
        btn.addEventListener("click", ()=>{
          [...pointsEl.children].forEach((el,i)=>el.classList.toggle("active", i===idx));
          setPanel({ title:p.title, body:p.body, sub:p.sub, badge:product.badge });

          if(p.mode === "BLINK"){
            doBlinkAndSettle();
          }
        });
        pointsEl.appendChild(btn);
      });
    }

    // =========================
    // Open result
    // =========================
    let currentProduct = PRODUCTS.omax;

    async function openResult(key){
      currentProduct = PRODUCTS[key] || PRODUCTS.omax;
      productTop.textContent = currentProduct.name;

      renderPoints(currentProduct);
      setPanel({ ...currentProduct.default, badge: currentProduct.badge });

      openModal(resultModal);

      // 3D init once
      if(!renderer){
        init3D();

        // texture load + apply
        try{
          const tex = await makeCircularTextureFromDataUri(LENS_IMAGE_DATA_URI);
          lensMesh.material.map = tex;
          lensMesh.material.opacity = 0.92;
          lensMesh.material.needsUpdate = true;
          textureReady = true;
        }catch(e){
          console.warn("texture load failed:", e);
        }

        animate();
      }
    }

    document.querySelectorAll(".productCard").forEach(el=>{
      el.addEventListener("click", ()=>{
        openResult(el.getAttribute("data-product"));
      });
    });

    btnBlink.addEventListener("click", doBlinkAndSettle);

    // =========================
    // Render loop
    // =========================
    function easeOutCubic(t){ return 1 - Math.pow(1-t, 3); }

    function animate(){
      requestAnimationFrame(animate);
      if(!renderer) return;

      // ìë™ â€œì‚´ì•„ìˆìŒâ€ (ì•„ì£¼ ë¯¸ì„¸)
      if(!controls.dragging){
        lensMesh.rotation.y += 0.0011;
        ringMesh.rotation.y += 0.0011;
      }

      // ì•ˆì°© ì• ë‹ˆë©”ì´ì…˜
      if(settling){
        settleT += 0.035; // ì†ë„
        const t = Math.min(settleT, 1);
        const k = easeOutCubic(t);

        // íšŒì „ ì•ˆì •í™”(í˜„ì¬ ê°ë„ë¥¼ targetë¡œ ìˆ˜ë ´)
        lensMesh.rotation.x = lensMesh.rotation.x + (targetRot.x - lensMesh.rotation.x) * (0.08 + 0.22*k);
        lensMesh.rotation.y = lensMesh.rotation.y + (targetRot.y - lensMesh.rotation.y) * (0.08 + 0.22*k);
        lensMesh.rotation.z = lensMesh.rotation.z + (targetRot.z - lensMesh.rotation.z) * (0.08 + 0.22*k);

        // ì‚´ì§ ì•ìœ¼ë¡œ â€œì°©â€ ë“¤ì–´ê°€ëŠ” ëŠë‚Œ(ì¹´ë©”ë¼ ë°©í–¥ìœ¼ë¡œ)
        lensMesh.position.z = (0.10 * Math.sin(k * Math.PI));
        ringMesh.position.z = lensMesh.position.z;

        if(t >= 1){
          settling = false;
          lensMesh.position.z = 0;
          ringMesh.position.z = 0;
        }
      }

      controls.update();
      renderer.render(scene, camera);
    }

    // =========================
    // init + data-uri ì£¼ì…
    // =========================
    // âœ… ì—¬ê¸°ì„œë¶€í„° â€œì´ë¯¸ì§€ ë°ì´í„°URIâ€ë¥¼ ì‹¤ì œë¡œ ì±„ì›Œ ë„£ìŒ
    // (ì•„ë˜ ë¬¸ìì—´ì€ ìë™ìœ¼ë¡œ êµì²´ë¨)
  </script>

  <script>
    // =========================
    // âœ… ì´ë¯¸ì§€ ë°ì´í„° URI (ë„ˆê°€ ì˜¬ë¦° ë Œì¦ˆ ì´ë¯¸ì§€ ê¸°ë°˜)
    //    - ì´ ê°’ë§Œ ë°”ê¾¸ë©´ ë Œì¦ˆ ì™¸í˜•ì´ ë°”ë¡œ ë°”ë€œ
    // =========================
    window.__LENS_URI__ = `__INJECT_URI__`;
  </script>

  <script type="module">
    // ìœ„ ëª¨ë“ˆ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì“°ëŠ” REPLACE_ME_DATA_URIë¥¼ window.__LENS_URI__ë¡œ êµì²´í•˜ê¸° ìœ„í•´
    // ê°„ë‹¨íˆ ì „ì²´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë‹¤ì‹œ ë¡œë“œí•˜ëŠ” ëŒ€ì‹ ,
    // ê°€ì¥ ì•ˆì „í•˜ê²Œ: ìœ„ ì²« ëª¨ë“ˆ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì°¸ì¡°í•  ìˆ˜ ìˆê²Œ ì „ì—­ì„ ì„¸íŒ…í•œë‹¤.
    // (ëª¨ë“ˆ ê°„ ê³µìœ )
    // ì•„ë˜ëŠ” â€œì•„ë¬´ê²ƒë„ ì•ˆ í•´ë„â€ ë˜ì§€ë§Œ, í™•ì‹¤íˆ í•˜ë ¤ê³  ë„£ìŒ.
  </script>

  <script>
    // ëª¨ë“ˆ ìŠ¤í¬ë¦½íŠ¸ ì•ˆì˜ REPLACE_ME_DATA_URIë¥¼ ì‹¤ì œë¡œ ì£¼ì…í•˜ê¸° ìœ„í•´,
    // ìœ„ HTMLì„ ê·¸ëŒ€ë¡œ ì“°ë ¤ë©´ ì•„ë˜ í•œ ì¤„ì²˜ëŸ¼ â€œì†ìœ¼ë¡œâ€ ë°”ê¿”ì¤˜ë„ ë¨:
    // const LENS_IMAGE_DATA_URI = `data:image/jpeg;base64,.....`;
    //
    // ì§€ê¸ˆì€ ë‚´ê°€ ì•„ë˜ì— ì™„ì„±ë³¸ì„ ë°”ë¡œ ì œê³µí•  ê±°ë¼, ë„ˆëŠ” ìˆ˜ì •í•  í•„ìš” ì—†ì–´.
  </script>
</body>
</html>
